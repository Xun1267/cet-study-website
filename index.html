<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的计划 - 四六级备考仪表盘</title>
    <style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');

/* 时间轴专用变量 */

/* 时间轴容器 */
.timeline-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: var(--spacing-lg);
    background: var(--bg-primary);
    min-height: 100vh;
}

/* 顶部控制面板 */
.timeline-header {
    background: linear-gradient(135deg, var(--glass-bg), rgba(255, 255, 255, 0.1));
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-xl);
    margin-bottom: var(--spacing-xl);
    box-shadow: var(--shadow-lg);
    backdrop-filter: blur(10px);
}

.control-panel {
    width: 100%;
}

.control-main {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: var(--spacing-xl);
    align-items: start;
}

.section-title {
    font-size: var(--font-size-md);
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: var(--spacing-md);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.section-title::before {
    content: '';
    width: 4px;
    height: 20px;
    background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
    border-radius: var(--radius-sm);
}

/* 考试类型切换 */
.exam-type-switch {
    display: flex;
    gap: var(--spacing-sm);
}

.switch-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-md);
    border: 2px solid var(--border-color);
    background: var(--glass-bg);
    color: var(--text-secondary);
    font-size: var(--font-size-sm);
    font-weight: 600;
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all var(--transition-normal);
    min-width: 120px;
    backdrop-filter: blur(5px);
}

.switch-btn:hover {
    border-color: var(--primary-color);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.switch-btn.active {
    background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
    border-color: var(--primary-color);
    color: white;
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
}

.btn-icon {
    font-size: var(--font-size-xl);
}

.btn-text {
    font-size: var(--font-size-sm);
    font-weight: 600;
}

/* 分数选择器 */
.score-options {
    display: flex;
    gap: var(--spacing-sm);
}

.score-option {
    flex: 1;
    cursor: pointer;
}

.score-option input[type="radio"] {
    display: none;
}

.option-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-md);
    border: 2px solid var(--border-color);
    background: var(--glass-bg);
    border-radius: var(--radius-lg);
    transition: all var(--transition-normal);
    backdrop-filter: blur(5px);
}

.score-option:hover .option-content {
    border-color: var(--primary-color);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.score-option input[type="radio"]:checked + .option-content {
    background: linear-gradient(135deg, var(--success-color), #10b981);
    border-color: var(--success-color);
    color: white;
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
}

.score-value {
    font-size: var(--font-size-lg);
    font-weight: 700;
}

.score-label {
    font-size: var(--font-size-xs);
    font-weight: 500;
    opacity: 0.9;
}

/* 考试日期显示 */
.exam-date-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-lg);
    background: linear-gradient(135deg, var(--warning-color), #f59e0b);
    border-radius: var(--radius-lg);
    color: white;
    text-align: center;
    box-shadow: var(--shadow-md);
}

.exam-date-value {
    font-size: var(--font-size-lg);
    font-weight: 700;
}

.countdown-text {
    font-size: var(--font-size-sm);
    opacity: 0.9;
}

.countdown-text strong {
    font-size: var(--font-size-md);
    font-weight: 800;
}



.reminder-text {
    font-size: var(--font-size-sm);
    font-weight: 500;
}

.reminder-close {
    background: none;
    border: none;
    color: white;
    font-size: var(--font-size-lg);
    cursor: pointer;
    padding: var(--spacing-xs);
    border-radius: var(--radius-sm);
    transition: background-color var(--transition-fast);
}

.reminder-close:hover {
    background: rgba(255, 255, 255, 0.2);
}

/* 时间轴主要内容区域 */
.timeline-main {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xl);
}

/* 里程碑时间轴 - 横向布局 */
.milestone-timeline {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: var(--spacing-xl);
    box-shadow: var(--shadow-sm);
    width: 100%;
    overflow-x: auto;
}

.timeline-header {
    text-align: center;
    margin-bottom: var(--spacing-xl);
}

.timeline-title {
    font-size: var(--font-size-2xl);
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: var(--spacing-sm);
}

.timeline-subtitle {
    font-size: var(--font-size-base);
    color: var(--text-secondary);
    line-height: var(--line-height-relaxed);
}

.milestone-nodes {
    position: relative;
    padding: var(--spacing-lg) 0;
    display: flex;
    align-items: center;
    gap: var(--spacing-xl);
    min-width: max-content;
}

.milestone-nodes::before {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    top: 50%;
    height: 3px;
    background: linear-gradient(to right, var(--border-color), var(--primary-color), var(--border-color));
    transform: translateY(-50%);
    border-radius: var(--radius-sm);
}

.milestone-node {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    transition: all var(--transition-normal);
    flex-shrink: 0;
    z-index: 2;
}

.milestone-node:hover {
    transform: translateY(-4px);
}

.milestone-node:hover {
    transform: translateY(-2px);
}

.node-circle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--bg-primary);
    border: 3px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--font-size-xl);
    color: var(--text-secondary);
    transition: all var(--transition-normal);
    box-shadow: var(--shadow-md);
    z-index: 2;
    position: relative;
}

.milestone-node.current .node-circle {
    border-color: var(--primary-color);
    background: var(--primary-color);
    color: white;
    box-shadow: 0 0 0 4px rgb(37 99 235 / 0.2), var(--shadow-lg);
}

.milestone-node.completed .node-circle {
    border-color: var(--success-color);
    background: var(--success-color);
    color: white;
}

.milestone-node.selected .node-circle {
    border-color: var(--primary-color);
    background: var(--primary-color);
    color: white;
    transform: scale(1.1);
}

.node-label {
    margin-top: var(--spacing-sm);
    font-size: var(--font-size-sm);
    font-weight: 600;
    color: var(--text-primary);
    text-align: center;
    max-width: 120px;
    line-height: var(--line-height-tight);
}

.node-date {
    margin-top: var(--spacing-xs);
    font-size: var(--font-size-xs);
    color: var(--text-muted);
    text-align: center;
}

/* 视图切换按钮 */
.view-switch {
    display: flex;
    justify-content: center;
    margin-top: var(--spacing-xl);
    gap: var(--spacing-sm);
}

/* 学习计划容器 */
.study-plan-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: var(--spacing-xl);
}

/* 选择器面板 */
.selector-panel {
    display: flex;
    gap: var(--spacing-xl);
    background: var(--glass-bg);
    border-radius: var(--radius-xl);
    padding: var(--spacing-xl);
    margin-bottom: var(--spacing-xl);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-lg);
    justify-content: center;
    align-items: flex-start;
}

/* 当前阶段显示 */
.current-stage {
    background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
    border-radius: var(--radius-xl);
    padding: var(--spacing-xl);
    margin-bottom: var(--spacing-xl);
    text-align: center;
    color: white;
    box-shadow: var(--shadow-lg);
}

.stage-title {
    font-size: var(--font-size-xxl);
    font-weight: 700;
    margin-bottom: var(--spacing-md);
}

.stage-description {
    font-size: var(--font-size-lg);
    opacity: 0.9;
    margin: 0;
}

/* 计划展示区域 */
.plan-display {
    background: var(--glass-bg);
    border-radius: var(--radius-xl);
    padding: var(--spacing-xl);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-lg);
}

.plan-overview {
    max-width: 100%;
}

.plan-header {
    text-align: center;
    margin-bottom: var(--spacing-xl);
    padding-bottom: var(--spacing-lg);
    border-bottom: 1px solid var(--border-color);
}

.plan-name {
    font-size: var(--font-size-xxl);
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: var(--spacing-md);
    background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.plan-strategy {
    font-size: var(--font-size-lg);
    color: var(--text-secondary);
    line-height: 1.6;
}

.plan-details {
    display: grid;
    gap: var(--spacing-xl);
}

.time-info {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-lg);
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.daily-time, .weekly-goal {
    text-align: center;
}

.daily-time h4, .weekly-goal h4 {
    font-size: var(--font-size-md);
    color: var(--text-secondary);
    margin-bottom: var(--spacing-sm);
    font-weight: 600;
}

.time-value, .goal-value {
    font-size: var(--font-size-xl);
    font-weight: 700;
    color: var(--primary-color);
}

.time-allocation {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.time-allocation h4 {
    font-size: var(--font-size-lg);
    color: var(--text-primary);
    margin-bottom: var(--spacing-md);
    text-align: center;
}

.allocation-chart {
    display: grid;
    gap: var(--spacing-md);
}

.allocation-item {
    display: grid;
    grid-template-columns: 100px 1fr 60px;
    align-items: center;
    gap: var(--spacing-md);
}

.skill-name {
    font-size: var(--font-size-sm);
    font-weight: 600;
    color: var(--text-secondary);
}

.allocation-bar {
    height: 20px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-sm);
    overflow: hidden;
    position: relative;
}

.allocation-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
    border-radius: var(--radius-sm);
    transition: width var(--transition-normal);
}

.allocation-percentage {
    font-size: var(--font-size-sm);
    font-weight: 600;
    color: var(--text-primary);
    text-align: right;
}

.current-tasks {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.current-tasks h4 {
    font-size: var(--font-size-lg);
    color: var(--text-primary);
    margin-bottom: var(--spacing-md);
    text-align: center;
}

.task-list {
    display: grid;
    gap: var(--spacing-md);
}

.milestone-item {
    background: var(--glass-bg);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    border: 1px solid var(--border-color);
}

.milestone-item h5 {
    font-size: var(--font-size-md);
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: var(--spacing-sm);
}

.milestone-item p {
    font-size: var(--font-size-sm);
    color: var(--text-secondary);
    line-height: 1.5;
    margin: 0;
}

.overall-requirements {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.overall-requirements h4 {
    font-size: var(--font-size-lg);
    color: var(--text-primary);
    margin-bottom: var(--spacing-md);
    text-align: center;
}

.overall-requirements p {
    font-size: var(--font-size-md);
    color: var(--text-secondary);
    line-height: 1.6;
    margin: 0;
    text-align: center;
}

.loading-state {
    text-align: center;
    padding: var(--spacing-xxl);
    color: var(--text-muted);
    font-size: var(--font-size-lg);
}

/* 响应式设计 */
@media (max-width: 768px) {
    .selector-panel {
        flex-direction: column;
        gap: var(--spacing-lg);
    }
    
    .time-info {
        grid-template-columns: 1fr;
    }
    
    .allocation-item {
        grid-template-columns: 80px 1fr 50px;
        gap: var(--spacing-sm);
    }
}

.view-switch-btn {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-md) var(--spacing-lg);
    border: 2px solid var(--border-color);
    background: var(--glass-bg);
    color: var(--text-secondary);
    font-size: var(--font-size-sm);
    font-weight: 600;
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all var(--transition-normal);
    backdrop-filter: blur(5px);
    min-width: 140px;
    justify-content: center;
}

.view-switch-btn:hover {
    border-color: var(--primary-color);
    color: var(--text-primary);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.view-switch-btn.active {
    background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
    border-color: var(--primary-color);
    color: white;
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
}

/* 任务面板 */
.task-panel {
    background: var(--glass-bg);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    backdrop-filter: blur(10px);
    margin-top: var(--spacing-lg);
}

.task-panel-header {
    padding: var(--spacing-xl);
    border-bottom: 1px solid var(--border-color);
    background: linear-gradient(135deg, var(--glass-bg), var(--bg-secondary));
    backdrop-filter: blur(5px);
}

.selected-milestone {
    font-size: var(--font-size-xl);
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: var(--spacing-md);
    text-align: center;
    background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-sm);
    overflow: hidden;
    margin-bottom: var(--spacing-sm);
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
    border-radius: var(--radius-sm);
    transition: width var(--transition-normal);
    width: 0%;
}

.progress-text {
    font-size: var(--font-size-xs);
    color: var(--text-muted);
    text-align: right;
}

.module-tabs {
    display: flex;
    gap: var(--spacing-sm);
    padding: var(--spacing-md);
    background: var(--glass-bg);
    overflow-x: auto;
    justify-content: center;
    flex-wrap: wrap;
}

.tab-btn {
    padding: var(--spacing-md) var(--spacing-lg);
    border: 2px solid var(--border-color);
    background: var(--glass-bg);
    color: var(--text-secondary);
    font-size: var(--font-size-sm);
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-normal);
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    border-radius: var(--radius-lg);
    backdrop-filter: blur(5px);
    min-width: 100px;
    justify-content: center;
}

.tab-btn:hover {
    background: var(--bg-secondary);
    border-color: var(--primary-color);
    transform: translateY(-2px);
    box-shadow: var(--shadow-sm);
}

.tab-btn.active {
    background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
    border-color: var(--primary-color);
    color: white;
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
}

/* 里程碑描述 */
.milestone-description {
    font-size: var(--font-size-sm);
    color: var(--text-muted);
    margin-bottom: var(--spacing-sm);
    line-height: 1.5;
}

/* 学生计划信息面板 */
.plan-info {
    padding: var(--spacing-md);
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-color);
    font-size: var(--font-size-sm);
}

.plan-info h4 {
    color: var(--primary-color);
    font-size: var(--font-size-md);
    margin-bottom: var(--spacing-sm);
    font-weight: 600;
}

.plan-info .plan-item {
    margin-bottom: var(--spacing-xs);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.plan-info .plan-label {
    color: var(--text-secondary);
    font-weight: 500;
}

.plan-info .plan-value {
    color: var(--text-primary);
    font-weight: 600;
}

/* 快捷操作按钮 */
.quick-actions {
    padding: var(--spacing-md);
    background: var(--bg-tertiary);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    gap: var(--spacing-sm);
    flex-wrap: wrap;
}

.action-btn {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-xs) var(--spacing-sm);
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    color: var(--text-secondary);
    font-size: var(--font-size-xs);
    cursor: pointer;
    transition: all var(--transition-fast);
    white-space: nowrap;
}

.action-btn:hover {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
}

.action-btn svg {
    flex-shrink: 0;
    color: var(--text-primary);
}

.tab-btn.active {
    background: var(--bg-primary);
    color: var(--primary-color);
    border-bottom: 2px solid var(--primary-color);
}

.weight {
    font-size: var(--font-size-xs);
    background: var(--primary-color);
    color: white;
    padding: 2px 6px;
    border-radius: var(--radius-sm);
}

.task-list {
    max-height: 500px;
    overflow-y: auto;
    padding: var(--spacing-md);
}

.task-group {
    margin-bottom: var(--spacing-lg);
}

.task-group:last-child {
    margin-bottom: 0;
}

.task-group-title {
    font-size: var(--font-size-base);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-md);
    padding-bottom: var(--spacing-sm);
    border-bottom: 1px solid var(--border-light);
}

.task-item {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-sm);
    padding: var(--spacing-xs) var(--spacing-sm);
    border: 1px solid transparent;
    border-radius: var(--radius-sm);
    margin-bottom: var(--spacing-xs);
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.02);
}

.task-item:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-sm);
}

.task-item:last-child {
    margin-bottom: 0;
}

.task-checkbox {
    margin-top: 2px;
    width: 16px;
    height: 16px;
    accent-color: var(--primary-color);
}

.task-content {
    flex: 1;
}

.task-title {
    font-size: var(--font-size-sm);
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: var(--spacing-xs);
    line-height: var(--line-height-tight);
}

.task-description {
    font-size: var(--font-size-xs);
    color: var(--text-secondary);
    margin-bottom: var(--spacing-sm);
    line-height: var(--line-height-normal);
}

.task-meta {
    display: flex;
    gap: var(--spacing-md);
    font-size: var(--font-size-xs);
    color: var(--text-muted);
}

.task-meta span {
    display: flex;
    align-items: center;
    gap: 4px;
}

.empty-state {
    text-align: center;
    padding: var(--spacing-2xl);
    color: var(--text-muted);
}

/* 计划总览面板 */
.overview-panel {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: var(--spacing-xl);
    box-shadow: var(--shadow-sm);
    display: none;
}

.overview-panel.active {
    display: block;
}

.overview-header {
    margin-bottom: var(--spacing-lg);
}

.overview-title {
    font-size: var(--font-size-xl);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-md);
}

.overview-controls {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.overview-select {
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: var(--font-size-sm);
}

.weeks-overview {
    display: grid;
    gap: var(--spacing-md);
}

.week-card {
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    background: var(--bg-secondary);
}

.week-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-sm);
}

.week-title {
    font-size: var(--font-size-base);
    font-weight: 600;
    color: var(--text-primary);
}

.week-date {
    font-size: var(--font-size-xs);
    color: var(--text-muted);
}

.week-modules {
    display: flex;
    gap: var(--spacing-sm);
    flex-wrap: wrap;
}

.module-tag {
    padding: var(--spacing-xs) var(--spacing-sm);
    background: var(--primary-color);
    color: white;
    font-size: var(--font-size-xs);
    border-radius: var(--radius-sm);
}

/* 周度备考计划样式 */
.weekly-plan-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: var(--spacing-lg);
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-lg);
    min-height: 100vh;
}

.weekly-header {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.header-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-md);
}

.page-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0;
}

.week-navigation {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.nav-btn {
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: var(--radius-md);
    padding: var(--spacing-sm) var(--spacing-md);
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
}

.nav-btn:hover {
    background: var(--primary-hover);
    transform: translateY(-2px);
}

.nav-btn:disabled {
    background: var(--text-muted);
    cursor: not-allowed;
    transform: none;
}

.current-week-indicator {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--primary-color);
}

.control-panel {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 24px;
    align-items: end;
    margin-bottom: 32px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 20px;
    backdrop-filter: blur(10px);
}

.control-group {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
}

.control-group label {
    font-weight: 600;
    color: var(--text-primary);
    font-size: var(--font-size-sm);
}

.control-group select {
    padding: var(--spacing-sm) var(--spacing-md);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    background: white;
    font-size: var(--font-size-base);
    transition: border-color 0.3s ease;
}

.control-group select:focus {
    outline: none;
    border-color: var(--primary-color);
}

/* 周度计划选择器样式 */
.exam-selector, .target-selector {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 16px;
    background: transparent;
    border-radius: 16px;
    border: 2px solid rgba(99, 102, 241, 0.3);
    backdrop-filter: blur(15px);
}

.exam-selector label, .target-selector label {
    font-size: 16px;
    font-weight: 700;
    color: #ffffff;
    margin-bottom: 8px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    letter-spacing: 0.5px;
}

.exam-selector select, .target-selector select {
    padding: 14px 18px;
    border: 2px solid rgba(99, 102, 241, 0.4);
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(15px);
    color: #000000;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s ease;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.exam-selector select:hover, .target-selector select:hover {
    background: rgba(255, 255, 255, 1);
    border-color: rgba(99, 102, 241, 0.6);
    box-shadow: 0 6px 20px rgba(99, 102, 241, 0.2);
    transform: translateY(-1px);
}

.exam-selector select:focus, .target-selector select:focus {
    outline: none;
    background: rgba(255, 255, 255, 1);
    border-color: var(--accent-color);
    box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2), 0 8px 25px rgba(99, 102, 241, 0.15);
}

.exam-selector select option, .target-selector select option {
    background: rgba(255, 255, 255, 0.95);
    color: #000000;
    padding: 8px;
    font-size: 14px;
    font-weight: 500;
}

/* 确保选择器在不同浏览器中的兼容性 */
.exam-selector select, .target-selector select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: none;
    padding-right: 18px;
}

.weekly-content {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
}

.week-overview {
    padding: var(--spacing-lg);
    border-radius: var(--radius-lg);
    overflow: hidden;
    word-wrap: break-word;
}

.week-overview h3 {
    margin: 0 0 var(--spacing-md) 0;
    font-size: var(--font-size-xl);
    color: var(--text-primary);
    line-height: 1.3;
}

.week-info {
    margin-bottom: var(--spacing-lg);
}

.week-dates {
    font-size: var(--font-size-large);
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: var(--spacing-sm);
    line-height: 1.4;
}

.week-theme {
    font-size: var(--font-size-base);
    color: var(--text-primary);
    margin-bottom: var(--spacing-xs);
    line-height: 1.4;
    word-wrap: break-word;
}

.week-goal {
    font-size: var(--font-size-small);
    color: var(--text-secondary);
    line-height: 1.4;
    word-wrap: break-word;
}

.progress-summary {
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    padding-top: var(--spacing-md);
}

.progress-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-md);
}

.progress-item .label {
    font-size: var(--font-size-sm);
    color: var(--text-primary);
    min-width: 80px;
}

.progress-bar {
    flex: 1;
    height: 8px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-sm);
    overflow: hidden;
}

.progress-bar.mini {
    height: 4px;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
    border-radius: var(--radius-sm);
    transition: width 0.3s ease;
}

.percentage {
    font-size: var(--font-size-sm);
    font-weight: 600;
    color: var(--primary-color);
    min-width: 40px;
    text-align: right;
}

.stats-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--spacing-sm);
}

.stat {
    text-align: center;
    padding: var(--spacing-sm);
    background: transparent;
    border-radius: var(--radius-md);
}

.stat .value {
    display: block;
    font-size: var(--font-size-lg);
    font-weight: 700;
    color: var(--primary-color);
}

.stat .label {
    font-size: var(--font-size-xs);
    color: var(--text-muted);
    margin-top: var(--spacing-xs);
}

/* 周计划详情样式 */
.week-plan-details {
    margin-top: var(--spacing-lg);
}

.week-plan-content {
    padding: var(--spacing-lg);
    border-radius: var(--radius-lg);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.plan-header {
    margin-bottom: var(--spacing-lg);
    padding-bottom: var(--spacing-md);
    border-bottom: 2px solid rgba(255, 255, 255, 0.1);
}

.plan-header h3 {
    margin: 0;
    color: var(--primary-color);
    font-weight: 600;
    font-size: 1.5rem;
}

.plan-tasks {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
}

.task-category {
    background: rgba(255, 255, 255, 0.02);
    padding: var(--spacing-sm);
    border-radius: var(--radius-md);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.task-category h4 {
    display: none;
}

.category-tasks {
    list-style: none;
    padding: 0;
    margin: 0;
}

.category-tasks .task-item {
    padding: 4px 0;
    border: none;
    color: var(--text-primary);
    margin-bottom: 2px;
    font-size: var(--font-size-base);
    background: transparent !important;
    display: flex;
    align-items: center;
}

.category-tasks .task-item:last-child {
    border-bottom: none;
}

.task-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.task-list li {
    padding: var(--spacing-xs) 0;
    color: var(--text-primary);
    font-size: 0.95rem;
    line-height: 1.5;
    position: relative;
    padding-left: var(--spacing-md);
}

.task-list li:before {
    content: '•';
    color: var(--primary-color);
    position: absolute;
    left: 0;
    font-weight: bold;
}

.checkpoint {
    background: rgba(255, 193, 7, 0.1);
    border-left-color: var(--warning-color);
    margin-top: var(--spacing-md);
}

.checkpoint h4 {
    color: var(--warning-color);
}

.task-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm);
    margin-bottom: var(--spacing-xs);
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-md);
    font-size: var(--font-size-sm);
}

.task-checkbox {
    width: 16px;
    height: 16px;
    border-radius: 3px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    cursor: pointer;
    margin-right: 8px;
    accent-color: var(--primary-color);
    transition: all 0.3s ease;
    appearance: none;
    -webkit-appearance: none;
    pointer-events: auto;
    z-index: 10;
    position: relative;
}

.task-checkbox:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
}

.task-checkbox:checked {
    background: rgba(37, 99, 235, 0.3);
    border-color: var(--primary-color);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.task-checkbox:checked::after {
    content: '✓';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #ffffff;
    font-size: 12px;
    font-weight: bold;
    text-shadow: 0 0 3px rgba(37, 99, 235, 0.8);
    z-index: 1;
}

.task-checkbox.checked {
    background: rgba(37, 99, 235, 0.3);
    border-color: var(--primary-color);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    position: relative;
}

.task-checkbox.checked::after {
    content: '✓';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #ffffff;
    font-size: 12px;
    font-weight: bold;
    text-shadow: 0 0 3px rgba(37, 99, 235, 0.8);
    z-index: 1;
}

.task-text {
    flex: 1;
    color: var(--text-primary);
}

.task-text.completed {
    text-decoration: line-through;
    color: var(--text-muted);
}

.statistics-panel {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--spacing-md);
    padding: var(--spacing-lg);
    border-radius: var(--radius-lg);
}

.stat-card {
    text-align: center;
    padding: var(--spacing-lg);
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-lg);
    transition: transform 0.3s ease;
}

/* 移除悬浮动效 */
.stat-card:hover {
    /* transform: translateY(-4px); */
}

.stat-value {
    display: block;
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: var(--spacing-sm);
}

.stat-label {
    font-size: var(--font-size-sm);
    color: var(--text-primary);
    font-weight: 500;
}

/* .glass-effect 定义已移至统一位置 */

/* 响应式设计 */
@media (max-width: 1024px) {
    .timeline-main {
        grid-template-columns: 1fr;
        gap: var(--spacing-lg);
    }
    
    .task-panel {
        position: static;
    }
    
    .weekly-content {
        grid-template-columns: 1fr;
    }
    
    .control-panel {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
    }
    
    .statistics-panel {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .weekly-plan-container {
        padding: var(--spacing-md);
    }
    
    .header-top {
        flex-direction: column;
        gap: var(--spacing-md);
        text-align: center;
    }
    
    .daily-plans {
        grid-template-columns: 1fr;
    }
    
    .statistics-panel {
        grid-template-columns: 1fr;
    }
    
    .week-navigation {
        flex-wrap: wrap;
        justify-content: center;
    }
}

@media (max-width: 768px) {
    .timeline-container {
        padding: var(--spacing-md);
    }
    
    .control-row {
        flex-direction: column;
        align-items: stretch;
        gap: var(--spacing-md);
    }
    
    .control-group {
        justify-content: space-between;
    }
    
    .milestone-nodes::before {
        left: 30px;
    }
    
    .milestone-node {
        flex-direction: row;
        align-items: center;
        text-align: left;
        padding-left: 80px;
    }
    
    .node-circle {
        position: absolute;
        left: 0;
        width: 50px;
        height: 50px;
        font-size: var(--font-size-lg);
    }
    
    .node-label {
        margin-top: 0;
        margin-left: var(--spacing-md);
        max-width: none;
        text-align: left;
    }
    
    .node-date {
        margin-top: var(--spacing-xs);
        margin-left: var(--spacing-md);
        text-align: left;
    }
    
    .view-switch {
        flex-direction: column;
    }
    
    .module-tabs {
        flex-direction: column;
    }
    
    .task-meta {
        flex-direction: column;
        gap: var(--spacing-xs);
    }
}

@media (max-width: 480px) {
    .timeline-container {
        padding: var(--spacing-sm);
    }
    
    .top-controls {
        padding: var(--spacing-md);
    }
    
    .milestone-timeline {
        padding: var(--spacing-md);
    }
    
    .task-panel-header {
        padding: var(--spacing-md);
    }
    
    .task-list {
        padding: var(--spacing-sm);
        max-height: 400px;
    }
}

/* 进度统计 */
.progress-stats {
    padding: var(--spacing-md);
    border-top: 1px solid var(--border-color);
    background: var(--bg-secondary);
}

.stats-title {
    font-size: var(--font-size-sm);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-sm);
}

.module-progress {
    display: grid;
    gap: var(--spacing-xs);
}

.module-stat {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: var(--font-size-xs);
}

.module-name {
    color: var(--text-secondary);
}

.module-percentage {
    font-weight: 500;
    color: var(--primary-color);
}

/* 模态框样式 */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-normal);
}

.modal.show {
    opacity: 1;
    visibility: visible;
}

.modal-content {
    background: var(--bg-primary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-xl);
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    transform: scale(0.9);
    transition: transform var(--transition-normal);
}

.modal.show .modal-content {
    transform: scale(1);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-lg);
    padding-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--border-color);
}

.modal-title {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--text-primary);
}

.modal-close {
    background: none;
    border: none;
    font-size: var(--font-size-xl);
    color: var(--text-muted);
    cursor: pointer;
    padding: var(--spacing-xs);
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
}

.modal-close:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
}

.modal-body {
    margin-bottom: var(--spacing-lg);
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-sm);
    padding-top: var(--spacing-md);
    border-top: 1px solid var(--border-color);
}

/* 表单样式 */
.form-group {
    margin-bottom: var(--spacing-md);
}

.form-label {
    display: block;
    font-size: var(--font-size-sm);
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: var(--spacing-xs);
}

.form-input {
    width: 100%;
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: var(--font-size-sm);
    transition: border-color var(--transition-fast);
}

.form-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
}

.form-select {
    width: 100%;
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: var(--font-size-sm);
    cursor: pointer;
}

.form-textarea {
    width: 100%;
    min-height: 100px;
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: var(--font-size-sm);
    resize: vertical;
    font-family: inherit;
}

.form-checkbox {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-sm);
}

.form-checkbox input {
    width: 16px;
    height: 16px;
    accent-color: var(--primary-color);
}

.form-checkbox label {
    font-size: var(--font-size-sm);
    color: var(--text-primary);
    cursor: pointer;
}

/* 按钮样式 */
.btn {
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid transparent;
    border-radius: var(--radius-md);
    font-size: var(--font-size-sm);
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition-fast);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-xs);
    text-decoration: none;
}

.btn-primary {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.btn-primary:hover {
    background: var(--primary-dark);
    border-color: var(--primary-dark);
}

.btn-secondary {
    background: var(--bg-secondary);
    color: var(--text-primary);
    border-color: var(--border-color);
}

.btn-secondary:hover {
    background: var(--bg-tertiary);
    border-color: var(--text-secondary);
}

.btn-success {
    background: var(--success-color);
    color: white;
    border-color: var(--success-color);
}

.btn-success:hover {
    background: #059669;
    border-color: #059669;
}

.btn-warning {
    background: var(--warning-color);
    color: white;
    border-color: var(--warning-color);
}

.btn-warning:hover {
    background: #d97706;
    border-color: #d97706;
}

.btn-danger {
    background: var(--danger-color);
    color: white;
    border-color: var(--danger-color);
}

.btn-danger:hover {
    background: #dc2626;
    border-color: #dc2626;
}

.btn-sm {
    padding: var(--spacing-xs) var(--spacing-sm);
    font-size: var(--font-size-xs);
}

.btn-lg {
    padding: var(--spacing-md) var(--spacing-lg);
    font-size: var(--font-size-base);
}

/* 浮动操作按钮 */
.floating-actions {
    position: fixed;
    bottom: var(--spacing-xl);
    right: var(--spacing-xl);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
    z-index: 100;
}

.floating-btn {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    border: none;
}

/* 模态框样式 */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
}

.modal.show {
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease-out;
}

.modal-content {
    background: var(--bg-primary);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    max-width: 90vw;
    max-height: 90vh;
    overflow: hidden;
    animation: slideIn 0.3s ease-out;
}

.modal-header {
    padding: var(--spacing-lg);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--bg-secondary);
}

.modal-title {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.modal-close {
    background: none;
    border: none;
    font-size: 24px;
    color: var(--text-muted);
    cursor: pointer;
    padding: var(--spacing-xs);
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
}

.modal-close:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
}

.modal-body {
    padding: var(--spacing-lg);
    max-height: 70vh;
    overflow-y: auto;
}

/* 每周课表样式 */
.schedule-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.schedule-table th,
.schedule-table td {
    padding: var(--spacing-sm);
    text-align: left;
    border-bottom: 1px solid var(--border-color);
    font-size: var(--font-size-sm);
}

.schedule-table th {
    background: var(--bg-secondary);
    font-weight: 600;
    color: var(--text-primary);
}

.schedule-table td {
    color: var(--text-secondary);
    line-height: 1.5;
}

/* 关键方法样式 */
.method-section {
    margin-bottom: var(--spacing-lg);
}

.method-section h4 {
    color: var(--primary-color);
    font-size: var(--font-size-md);
    margin-bottom: var(--spacing-sm);
    font-weight: 600;
}

.method-section p {
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: var(--spacing-sm);
}

.method-section ul {
    margin-left: var(--spacing-md);
    color: var(--text-secondary);
}

.method-section li {
    margin-bottom: 4px;
    line-height: 1.5;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.floating-btn {
    background: var(--primary-color);
    color: white;
    font-size: var(--font-size-lg);
    cursor: pointer;
    box-shadow: var(--shadow-lg);
    transition: all var(--transition-normal);
    display: flex;
    align-items: center;
    justify-content: center;
}

.floating-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 10px 10px -5px rgb(0 0 0 / 0.04);
}

.floating-btn:active {
    transform: translateY(0);
}

/* 提醒设置 */
.reminder-settings {
    display: grid;
    gap: var(--spacing-md);
}

.setting-group {
    padding: var(--spacing-md);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-secondary);
}

.setting-title {
    font-size: var(--font-size-sm);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-sm);
}

.setting-description {
    font-size: var(--font-size-xs);
    color: var(--text-secondary);
    margin-bottom: var(--spacing-sm);
}

/* 动画效果 */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideIn {
    from {
        transform: translateX(-100%);
    }
    to {
        transform: translateX(0);
    }
}

@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

.fade-in {
    animation: fadeIn var(--transition-normal) ease-out;
}

.slide-in {
    animation: slideIn var(--transition-normal) ease-out;
}

.pulse {
    animation: pulse 2s infinite;
}

/* 工具提示 */
.tooltip {
    position: relative;
    display: inline-block;
}

.tooltip::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--text-primary);
    color: white;
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-xs);
    white-space: nowrap;
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-fast);
    z-index: 1000;
}

.tooltip:hover::after {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) translateY(-4px);
}

/* 加载状态 */
.loading {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
}

.loading-spinner {
    width: 16px;
    height: 16px;
    border: 2px solid var(--border-color);
    border-top: 2px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* 状态指示器 */
.status-indicator {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: var(--font-size-xs);
}

.status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--text-muted);
}

.status-dot.success {
    background: var(--success-color);
}

.status-dot.warning {
    background: var(--warning-color);
}

.status-dot.danger {
    background: var(--danger-color);
}

.status-dot.info {
    background: var(--info-color);
}

/* 徽章 */
.badge {
    display: inline-flex;
    align-items: center;
    padding: 2px 8px;
    font-size: var(--font-size-xs);
    font-weight: 500;
    border-radius: var(--radius-sm);
    background: var(--bg-tertiary);
    color: var(--text-secondary);
}

.badge.primary {
    background: var(--primary-color);
    color: white;
}

.badge.success {
    background: var(--success-color);
    color: white;
}

.badge.warning {
    background: var(--warning-color);
    color: white;
}

.badge.danger {
    background: var(--danger-color);
    color: white;
}

/* 卡片样式 */
.card {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    box-shadow: var(--shadow-sm);
}

.card-header {
    margin-bottom: var(--spacing-md);
    padding-bottom: var(--spacing-md);
    border-bottom: 1px solid var(--border-light);
}

.card-title {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-xs);
}

.card-subtitle {
    font-size: var(--font-size-sm);
    color: var(--text-secondary);
}

.card-body {
    margin-bottom: var(--spacing-md);
}

.card-footer {
    padding-top: var(--spacing-md);
    border-top: 1px solid var(--border-light);
}

/* 列表样式 */
.list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.list-item {
    padding: var(--spacing-sm) var(--spacing-md);
    border-bottom: 1px solid var(--border-light);
    transition: background-color var(--transition-fast);
}

.list-item:hover {
    background: var(--bg-secondary);
}

.list-item:last-child {
    border-bottom: none;
}

.list-item-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.list-item-title {
    font-size: var(--font-size-sm);
    font-weight: 500;
    color: var(--text-primary);
}

.list-item-subtitle {
    font-size: var(--font-size-xs);
    color: var(--text-secondary);
    margin-top: var(--spacing-xs);
}

/* 分隔线 */
.divider {
    height: 1px;
    background: var(--border-color);
    margin: var(--spacing-md) 0;
}

.divider.vertical {
    width: 1px;
    height: auto;
    margin: 0 var(--spacing-md);
}

/* 文本样式 */
.text-primary {
    color: var(--text-primary);
}

.text-secondary {
    color: var(--text-secondary);
}

.text-muted {
    color: var(--text-muted);
}

.text-success {
    color: var(--success-color);
}

.text-warning {
    color: var(--warning-color);
}

.text-danger {
    color: var(--danger-color);
}

.text-info {
    color: var(--info-color);
}

.text-center {
    text-align: center;
}

.text-left {
    text-align: left;
}

.text-right {
    text-align: right;
}

.font-weight-normal {
    font-weight: 400;
}

.font-weight-medium {
    font-weight: 500;
}

.font-weight-semibold {
    font-weight: 600;
}

.font-weight-bold {
    font-weight: 700;
}

/* 间距工具类 */
.m-0 { margin: 0; }
.m-1 { margin: var(--spacing-xs); }
.m-2 { margin: var(--spacing-sm); }
.m-3 { margin: var(--spacing-md); }
.m-4 { margin: var(--spacing-lg); }
.m-5 { margin: var(--spacing-xl); }

.mt-0 { margin-top: 0; }
.mt-1 { margin-top: var(--spacing-xs); }
.mt-2 { margin-top: var(--spacing-sm); }
.mt-3 { margin-top: var(--spacing-md); }
.mt-4 { margin-top: var(--spacing-lg); }
.mt-5 { margin-top: var(--spacing-xl); }

.mb-0 { margin-bottom: 0; }
.mb-1 { margin-bottom: var(--spacing-xs); }
.mb-2 { margin-bottom: var(--spacing-sm); }
.mb-3 { margin-bottom: var(--spacing-md); }
.mb-4 { margin-bottom: var(--spacing-lg); }
.mb-5 { margin-bottom: var(--spacing-xl); }

.ml-0 { margin-left: 0; }
.ml-1 { margin-left: var(--spacing-xs); }
.ml-2 { margin-left: var(--spacing-sm); }
.ml-3 { margin-left: var(--spacing-md); }
.ml-4 { margin-left: var(--spacing-lg); }
.ml-5 { margin-left: var(--spacing-xl); }

.mr-0 { margin-right: 0; }
.mr-1 { margin-right: var(--spacing-xs); }
.mr-2 { margin-right: var(--spacing-sm); }
.mr-3 { margin-right: var(--spacing-md); }
.mr-4 { margin-right: var(--spacing-lg); }
.mr-5 { margin-right: var(--spacing-xl); }

.p-0 { padding: 0; }
.p-1 { padding: var(--spacing-xs); }
.p-2 { padding: var(--spacing-sm); }
.p-3 { padding: var(--spacing-md); }
.p-4 { padding: var(--spacing-lg); }
.p-5 { padding: var(--spacing-xl); }

.pt-0 { padding-top: 0; }
.pt-1 { padding-top: var(--spacing-xs); }
.pt-2 { padding-top: var(--spacing-sm); }
.pt-3 { padding-top: var(--spacing-md); }
.pt-4 { padding-top: var(--spacing-lg); }
.pt-5 { padding-top: var(--spacing-xl); }

.pb-0 { padding-bottom: 0; }
.pb-1 { padding-bottom: var(--spacing-xs); }
.pb-2 { padding-bottom: var(--spacing-sm); }
.pb-3 { padding-bottom: var(--spacing-md); }
.pb-4 { padding-bottom: var(--spacing-lg); }
.pb-5 { padding-bottom: var(--spacing-xl); }

.pl-0 { padding-left: 0; }
.pl-1 { padding-left: var(--spacing-xs); }
.pl-2 { padding-left: var(--spacing-sm); }
.pl-3 { padding-left: var(--spacing-md); }
.pl-4 { padding-left: var(--spacing-lg); }
.pl-5 { padding-left: var(--spacing-xl); }

.pr-0 { padding-right: 0; }
.pr-1 { padding-right: var(--spacing-xs); }
.pr-2 { padding-right: var(--spacing-sm); }
.pr-3 { padding-right: var(--spacing-md); }
.pr-4 { padding-right: var(--spacing-lg); }
.pr-5 { padding-right: var(--spacing-xl); }

/* 显示/隐藏工具类 */
.d-none { display: none; }
.d-block { display: block; }
.d-inline { display: inline; }
.d-inline-block { display: inline-block; }
.d-flex { display: flex; }
.d-grid { display: grid; }

/* Flexbox 工具类 */
.flex-row { flex-direction: row; }
.flex-column { flex-direction: column; }
.flex-wrap { flex-wrap: wrap; }
.flex-nowrap { flex-wrap: nowrap; }
.justify-start { justify-content: flex-start; }
.justify-center { justify-content: center; }
.justify-end { justify-content: flex-end; }
.justify-between { justify-content: space-between; }
.justify-around { justify-content: space-around; }
.align-start { align-items: flex-start; }
.align-center { align-items: center; }
.align-end { align-items: flex-end; }
.align-stretch { align-items: stretch; }

/* 位置工具类 */
.position-static { position: static; }
.position-relative { position: relative; }
.position-absolute { position: absolute; }
.position-fixed { position: fixed; }
.position-sticky { position: sticky; }

/* 溢出工具类 */
.overflow-hidden { overflow: hidden; }
.overflow-auto { overflow: auto; }
.overflow-scroll { overflow: scroll; }
.overflow-visible { overflow: visible; }

/* 圆角工具类 */
.rounded-none { border-radius: 0; }
.rounded-sm { border-radius: var(--radius-sm); }
.rounded { border-radius: var(--radius-md); }
.rounded-lg { border-radius: var(--radius-lg); }
.rounded-xl { border-radius: var(--radius-xl); }
.rounded-full { border-radius: 50%; }

/* 阴影工具类 */
.shadow-none { box-shadow: none; }
.shadow-sm { box-shadow: var(--shadow-sm); }
.shadow { box-shadow: var(--shadow-md); }
.shadow-lg { box-shadow: var(--shadow-lg); }

/* 过渡工具类 */
.transition-none { transition: none; }
.transition-fast { transition: all var(--transition-fast); }
.transition { transition: all var(--transition-normal); }
.transition-slow { transition: all var(--transition-slow); }

/* 光标工具类 */
.cursor-auto { cursor: auto; }
.cursor-pointer { cursor: pointer; }
.cursor-not-allowed { cursor: not-allowed; }
.cursor-grab { cursor: grab; }
.cursor-grabbing { cursor: grabbing; }

/* 用户选择工具类 */
.select-none { user-select: none; }
.select-text { user-select: text; }
.select-all { user-select: all; }
.select-auto { user-select: auto; }

/* 指针事件工具类 */
.pointer-events-none { pointer-events: none; }
.pointer-events-auto { pointer-events: auto; }

/* 可见性工具类 */
.visible { visibility: visible; }
.invisible { visibility: hidden; }

/* 透明度工具类 */
.opacity-0 { opacity: 0; }
.opacity-25 { opacity: 0.25; }
.opacity-50 { opacity: 0.5; }
.opacity-75 { opacity: 0.75; }
.opacity-100 { opacity: 1; }

/* Z-index 工具类 */

/* --- 全局样式与字体 (无变化) --- */
        :root {
            --sidebar-width: 260px; --main-bg: #1a1a2e; --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2); --text-color: #EAECEE; --text-color-darker: #B2BABB;
            --accent-color: #4CAF50; --accent-color-hover: #66BB6A; --accent-text: #2E7D32; 
            --success-color: #28a745; --review-color: #FFC107; --learn-color: #2196F3; --border-radius: 15px;
            
            /* 响应式字体基线 (min 20px) */
            --font-size-sm: clamp(16px, 1.2vw, 18px); /* Small text for buttons and inputs */
            --font-size-base: clamp(20px, 1.5vw, 24px); /* Base for body text */
            --font-size-small: clamp(20px, 1.2vw, 22px); /* Small text, now >= 20px */
            --font-size-large: clamp(22px, 1.8vw, 28px); /* Large text */
            --font-size-xl: clamp(26px, 2.0vw, 30px); /* Extra large text */
            --font-size-title: clamp(24px, 2.2vw, 32px); /* Card titles etc. */
            --font-size-heading: clamp(28px, 2.8vw, 38px); /* Main headings */
            
            /* 间距变量 */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            
            /* 圆角变量 */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            
            /* 时间轴专用变量 */
            --primary-color: #2563eb; --primary-light: #3b82f6; --primary-dark: #1d4ed8;
            --secondary-color: #64748b; --warning-color: #f59e0b; --danger-color: #ef4444; --info-color: #06b6d4;
            --text-primary: #e2e8f0; --text-secondary: #94a3b8; --text-muted: #64748b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans SC', sans-serif; background-image: linear-gradient(to right top, #5a8c43, #68974d, #77a158, #85ac62, #93b76d);
            background-size: 400% 400%; color: var(--text-color); overflow-x: hidden;
            font-size: var(--font-size-base); line-height: 1.6;
        }
        
        /* 桌面端保留温和的背景动画 */
        @media (min-width: 769px) {
            body {
                animation: gradientBG 25s ease infinite;
            }
        }
        
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .glass-effect {
            background: var(--glass-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border); border-radius: var(--border-radius); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
        }

        /* --- 汉堡菜单按钮 --- */
        .hamburger-menu {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .hamburger-menu:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.05);
        }
        .hamburger-icon {
            width: 24px;
            height: 18px;
            position: relative;
        }
        .hamburger-icon span {
            display: block;
            height: 2px;
            width: 100%;
            background: var(--text-color);
            border-radius: 1px;
            position: absolute;
            transition: all 0.3s ease;
        }
        .hamburger-icon span:nth-child(1) { top: 0; }
        .hamburger-icon span:nth-child(2) { top: 8px; }
        .hamburger-icon span:nth-child(3) { top: 16px; }
        
        /* 汉堡菜单激活状态 */
        .hamburger-menu.active .hamburger-icon span:nth-child(1) {
            transform: rotate(45deg);
            top: 8px;
        }
        .hamburger-menu.active .hamburger-icon span:nth-child(2) {
            opacity: 0;
        }
        .hamburger-menu.active .hamburger-icon span:nth-child(3) {
            transform: rotate(-45deg);
            top: 8px;
        }
        
        /* --- 遮罩层 --- */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .sidebar-overlay.active {
            display: block;
            opacity: 1;
        }

        /* --- 侧边栏 (微调激活状态) --- */
        .sidebar { 
            width: var(--sidebar-width); 
            height: 100vh; 
            position: fixed; 
            left: 0; 
            top: 0; 
            padding: 28px 18px; 
            display: flex; 
            flex-direction: column; 
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
            z-index: 1000;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            overflow-x: hidden;
        }
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }
        .sidebar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        .sidebar .logo { text-align: center; margin-bottom: 45px; }
        .sidebar .logo h1 { font-size: var(--font-size-heading); font-weight: 700; letter-spacing: 1px; }
        .sidebar .logo p { font-size: var(--font-size-base); color: var(--text-color-darker); }
        .sidebar nav ul { list-style: none; flex-grow: 1; padding: 0; }
        .sidebar nav li { margin-bottom: 24px; /* 增加间距避免遮挡 */ }
        .sidebar nav a { 
            display: flex; 
            align-items: center; 
            padding: 18px 20px; /* 增加内边距 */
            text-decoration: none; 
            color: var(--text-color); 
            border-radius: 12px; /* 增加圆角 */
            font-weight: 500; 
            transition: all 0.3s ease; 
            cursor: pointer; 
            font-size: var(--font-size-base);
            min-height: 24px; /* 确保最小高度 */
            box-sizing: border-box;
        }
        .sidebar nav a svg { width: 24px; height: 24px; margin-right: 20px; flex-shrink: 0; }
        .sidebar nav a:hover { 
            background: var(--glass-bg); 
            transform: translateX(4px); /* 添加悬停动效 */
        }
        .sidebar nav a.active { 
            background: var(--accent-color); 
            color: #fff; 
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
            transform: translateX(4px);
        }

        /* --- 主内容区域 (无变化) --- */
        .main-content { 
            margin-left: var(--sidebar-width); 
            flex-grow: 1; 
            padding: 30px; 
            min-height: 100vh; 
            width: calc(100% - var(--sidebar-width));
            max-width: 100%;
            box-sizing: border-box;
        }
        .dashboard-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 35px; 
            width: 100%; 
        }
        .grid-item { padding: 35px; animation: fadeInFromBottom 0.5s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInFromBottom { to { opacity: 1; transform: translateY(0); } }
        .grid-item:nth-child(1) { animation-delay: 0.1s; }
        .grid-item:nth-child(2) { animation-delay: 0.2s; }
        .grid-item:nth-child(3) { animation-delay: 0.3s; }
        .card-title { font-size: var(--font-size-title); font-weight: 500; margin-bottom: 20px; display: flex; align-items: center; }
        .card-title svg { width: 22px; height: 22px; margin-right: 10px; color: var(--accent-color-hover); }

        /* --- 【新】页面切换样式 --- */
        .view { display: none; }
        .view.active { display: block; }
        .view.active-grid { display: grid; } /* 保持仪表盘的 grid 布局 */

        /* --- 【更新】今日任务卡片样式 --- */
        .task-list ul { 
            list-style: none; 
            max-height: 200px; 
            overflow-y: auto; 
            padding: var(--spacing-sm);
            margin: 0;
        }
        .task-list li { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            margin-bottom: var(--spacing-xs); 
            padding: var(--spacing-sm) var(--spacing-md); 
            border-radius: var(--radius-md); 
            transition: background 0.3s ease;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .task-list li:hover { 
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
        }
        .task-list input[type="checkbox"] { display: none; }
        .task-list label { 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            flex-grow: 1;
            min-height: 24px;
        }
        .task-list .custom-checkbox { 
            width: 20px; 
            height: 20px; 
            border: 2px solid var(--glass-border); 
            border-radius: var(--radius-sm); 
            margin-right: var(--spacing-md); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            transition: all 0.3s; 
            flex-shrink: 0;
        }
        .task-list .custom-checkbox svg { 
            width: 14px; 
            height: 14px; 
            color: white; 
            opacity: 0; 
            transform: scale(0.5); 
            transition: all 0.3s;
        }
        .task-list input[type="checkbox"]:checked + label .custom-checkbox { 
            background-color: var(--success-color); 
            border-color: var(--success-color);
        }
        .task-list input[type="checkbox"]:checked + label .custom-checkbox svg { 
            opacity: 1; 
            transform: scale(1);
        }
        .task-list .task-text { 
            transition: all 0.3s;
            line-height: 1.4;
            word-wrap: break-word;
            flex: 1;
        }
        .task-list input[type="checkbox"]:checked + label .task-text { 
            text-decoration: line-through; 
            color: var(--text-color-darker);
        }
        .delete-task { 
             background: rgba(255, 255, 255, 0.1); 
             border: 1px solid rgba(255, 255, 255, 0.3); 
             color: white; 
             cursor: pointer; 
             opacity: 0.8; 
             transition: all 0.3s ease; 
             border-radius: var(--radius-sm);
             padding: var(--spacing-xs) var(--spacing-sm);
             font-size: 14px;
             font-weight: bold;
             min-width: 24px;
             height: 24px;
             display: flex;
             align-items: center;
             justify-content: center;
         }
         .task-list li:hover .delete-task { 
             opacity: 1; 
             background: rgba(255, 255, 255, 0.2);
             border-color: rgba(255, 255, 255, 0.5);
             transform: scale(1.1);
         }
         .delete-task:hover {
             background: rgba(255, 255, 255, 0.3) !important;
             border-color: white !important;
             color: white !important;
         }
        #add-task-form { 
            display: flex; 
            margin-top: var(--spacing-lg);
            gap: var(--spacing-sm);
            align-items: center;
            flex-wrap: wrap;
        }
        @media (max-width: 768px) {
            #add-task-form {
                flex-direction: column;
                gap: var(--spacing-md);
            }
            #new-task-input {
                width: 100%;
            }
            #add-task-btn {
                width: 100%;
                padding: var(--spacing-md) var(--spacing-lg);
            }
        }
        #new-task-input { 
            flex-grow: 1; 
            background: var(--glass-bg); 
            border: 1px solid var(--glass-border); 
            border-radius: var(--radius-md); 
            padding: var(--spacing-sm) var(--spacing-md); 
            color: var(--text-color); 
            outline: none;
            font-size: var(--font-size-sm);
        }
        #add-task-btn { 
            background: var(--accent-color); 
            border: none; 
            color: white; 
            padding: var(--spacing-sm) var(--spacing-lg); 
            border-radius: var(--radius-md); 
            cursor: pointer; 
            transition: background 0.3s;
            font-size: var(--font-size-sm);
            font-weight: 500;
            min-width: 80px;
            white-space: nowrap;
            flex-shrink: 0;
        }
        #add-task-btn:hover { background: var(--accent-color-hover); }


        /* --- 【新】词汇中心样式 --- */
        .pdf-card { padding: 35px; text-align: center; }
        .pdf-card svg.file-icon { width: 60px; height: 60px; color: var(--accent-text); margin-bottom: 15px; }
        .pdf-card h4 { font-size: var(--font-size-large); margin-bottom: 10px; }
        .pdf-card p { font-size: var(--font-size-base); color: var(--text-color-darker); margin-bottom: 25px; min-height: 40px; }
        .pdf-actions { display: flex; justify-content: center; gap: 15px; }
        .pdf-actions .btn { padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 500; transition: all 0.3s; font-size: var(--font-size-base); }
        .pdf-actions .btn-preview { background: var(--accent-color); color: white; border: 1px solid var(--accent-color); }
        .pdf-actions .btn-preview:hover { background: var(--accent-color-hover); }
        .pdf-actions .btn-download { background: transparent; color: var(--text-color); border: 1px solid var(--glass-border); }
        .pdf-actions .btn-download:hover { background: var(--glass-bg); }



        /* --- 【新】词汇打卡表样式 --- */
        .checkin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .week-selector { display: flex; gap: 10px; align-items: center; }
        .week-nav-btn { background: var(--glass-bg); border: 1px solid var(--glass-border); color: var(--text-color); padding: 8px 15px; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        /* 保留周导航按钮的颜色变化，但移除其他动效 */
.week-nav-btn:hover { background: var(--accent-color); }
        .week-info { font-size: 16px; font-weight: 500; margin: 0 15px; }
        
        .checkin-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .checkin-table th, .checkin-table td { padding: 16px; text-align: center; border: 1px solid var(--glass-border); }
        .checkin-table td { font-size: clamp(20px, 1.8vw, 22px); }
        .checkin-table th { background: var(--glass-bg); font-weight: 500; font-size: clamp(20px, 1.8vw, 22px); }
        .checkin-table .day-header { background: rgba(76, 175, 80, 0.12); font-weight: 600; }
        
        .time-slot { margin-bottom: 10px; }
        .time-slot:last-child { margin-bottom: 0; }
        .time-label { font-size: 14px; color: var(--text-color-darker); margin-bottom: 8px; font-weight: 500; }
        
        .checkin-actions { display: flex; gap: 12px; justify-content: center; }
        .checkin-btn {
            padding: 12px 24px;
            font-size: clamp(20px, 1.8vw, 22px);
            border-radius: 12px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 80px;
            position: relative;
            overflow: hidden;
        }
        .checkin-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s ease, height 0.3s ease;
        }
        .checkin-btn:active::before {
            width: 120px;
            height: 120px;
        }
        .checkin-btn.review { background: rgba(255, 193, 7, 0.15); color: var(--review-color); border: 1px solid rgba(255, 193, 7, 0.25); }
        .checkin-btn.review.completed { background: var(--review-color); color: #111; border: 1px solid var(--review-color); }
        .checkin-btn.learn { background: rgba(33, 150, 243, 0.15); color: var(--learn-color); border: 1px solid rgba(33, 150, 243, 0.25); }
        .checkin-btn.learn.completed { background: var(--learn-color); color: white; border: 1px solid var(--learn-color); }
        .checkin-btn:hover:not(.completed) { 
            transform: translateY(-2px) scale(1.05); 
            box-shadow: 0 6px 16px rgba(0,0,0,0.15); 
        }
        .checkin-btn:active {
            transform: translateY(0) scale(0.98);
            transition: all 0.1s ease;
        }
        
        /* 编辑图标按钮样式 */
        .edit-icon-btn {
            background: transparent;
            border: none;
            color: var(--text-color-darker);
            cursor: pointer;
            padding: 6px;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.2s ease;
            opacity: 0.7;
            min-width: auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .edit-icon-btn:hover {
            background: rgba(255,255,255,0.1);
            opacity: 1;
            transform: scale(1.1);
        }
        
        /* 按钮容器样式 */
        .btn-with-edit {
            margin-bottom: 8px;
        }
        .btn-with-edit:last-child {
            margin-bottom: 0;
        }
        
        .week-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 25px; margin-top: 20px; }
        .stat-card { padding: 15px; text-align: center; border-radius: 10px; background: var(--glass-bg); }
        .stat-number { font-size: 24px; font-weight: 700; color: var(--accent-text); }
        .stat-label { font-size: 12px; color: var(--text-color-darker); margin-top: 5px; }
        
        /* --- 大屏幕优化 --- */
        @media (min-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (min-width: 1600px) {
            .dashboard-grid {
                grid-template-columns: repeat(3, 1fr);
                max-width: 1400px;
            }
        }

        /* --- 响应式设计 (无变化) --- */
        @media (max-width: 992px) {
            .hamburger-menu { display: block; }
            .sidebar { 
                transform: translateX(-100%); 
                z-index: 1000;
                width: min(280px, 85vw);
                box-shadow: 4px 0 20px rgba(0, 0, 0, 0.15);
            }
            .sidebar.open { 
                transform: translateX(0);
                box-shadow: 4px 0 20px rgba(0, 0, 0, 0.25);
            }
            .main-content { 
                margin-left: 0; 
                padding-top: 80px;
                transition: filter 0.3s ease;
                width: 100%;
                max-width: 100%;
            }
            .main-content.sidebar-open {
                filter: blur(2px);
            }
        }
        
        /* --- 移动端优化 --- */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr !important;
                gap: 20px;
                padding: 0 15px;
            }
            
            .main-content {
                padding: 20px 10px;
            }
            
            .grid-item {
                padding: 20px;
            }
            
            /* 确保所有容器在移动端纵向排列 */
            .view {
                padding: 0 10px;
            }
            
            /* 历史回顾页面移动端优化 */
            .history-stats-grid {
                grid-template-columns: 1fr !important;
                gap: 15px;
            }
            
            /* 资源库页面移动端优化 */
            .resource-section {
                margin-bottom: 20px;
                padding: 15px;
            }
            
            /* 考试时间轴页面移动端优化 */
            .control-panel {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .exam-selector,
            .target-selector {
                width: 100%;
            }
            
            .exam-selector select,
            .target-selector select {
                width: 100%;
                padding: 12px;
                font-size: 16px;
            }
            
            .week-navigation {
                justify-content: center;
                gap: 10px;
            }
            
            .nav-btn {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .current-week {
                font-size: 16px;
                padding: 0 15px;
            }
            
            /* 词汇打卡表移动端优化 */
            .checkin-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .week-selector {
                justify-content: center;
            }
            
            /* 历史回顾页面移动端优化 */
            .history-header {
                padding: 15px !important;
                text-align: center;
            }
            
            .history-header h2 {
                font-size: 20px !important;
            }
            
            .history-controls {
                padding: 15px !important;
            }
            
            .history-controls > div {
                flex-direction: column !important;
                align-items: stretch !important;
                gap: 15px !important;
            }
            
            .history-controls > div > div {
                flex-direction: column !important;
                gap: 10px !important;
            }
            
            .history-controls select {
                width: 100%;
                padding: 12px !important;
                font-size: 16px;
            }
            
            .history-chart-container,
            .history-data-container {
                padding: 15px !important;
            }
            
            /* 真题练习页面移动端优化 */
            .zhenti-header {
                padding: 15px !important;
            }
            
            .zhenti-header > div {
                flex-direction: column !important;
                gap: 15px !important;
                text-align: center;
            }
            
            .zhenti-header h2 {
                font-size: 20px !important;
            }
            
            #open-zhenti-external {
                width: 100%;
                justify-content: center !important;
                padding: 15px 20px !important;
                font-size: 16px !important;
            }
            
            .zhenti-content {
                height: calc(100vh - 280px) !important;
            }
            
            /* 修复汉堡菜单与问候语文字遮挡问题 */
            .greeting-top {
                margin-left: 70px !important;
                padding-right: 20px !important;
            }
            
            .greeting-top h2 {
                font-size: 18px !important;
                line-height: 1.4 !important;
            }
        }
        
        @media (max-width: 480px) {
            .dashboard-grid {
                gap: 15px;
                padding: 0 10px;
            }
            
            .main-content {
                padding: 15px 5px;
            }
            
            .grid-item {
                padding: 15px;
            }
            
            .card-title {
                font-size: 18px;
            }
        }

        /* 新增：主页问候与介绍样式 */
        .greeting-top { margin-bottom: 18px; position: relative; }
        .greeting-top h2 { font-size: var(--font-size-heading); font-weight: 600; letter-spacing: 0.5px; }
        .greeting-top h2 span { color: var(--accent-text); }
        
        /* 四六级考试倒计时内联样式 */
        .exam-countdown-inline {
            font-size: 14px;
            color: var(--accent-text);
            font-weight: 500;
            margin-left: 8px;
        }
        .exam-countdown-inline #cet-title {
            color: var(--primary-color);
            font-weight: 600;
        }
        .exam-countdown-inline #cet-days {
            color: #e11d48;
            font-weight: 700;
            font-size: 16px;
        }
        
        /* 响应式适配 */
        @media (max-width: 768px) {
            .exam-countdown-inline {
                font-size: 12px;
                display: block;
                margin-left: 0;
                margin-top: 5px;
            }
            .exam-countdown-inline #cet-days {
                font-size: 14px;
            }
        }

        .intro-section { display: flex; justify-content: flex-start; margin: 10px 0 26px; width: 100%; }
        .dashboard-grid .intro-section { grid-column: 1 / -1; }
        .intro-card { max-width: 980px; width: 100%; padding: 22px 26px; line-height: 1.9; margin-left: 0; }
        .intro-card h4 { margin: 12px 0 6px; font-size: var(--font-size-large); color: var(--accent-text); }
        .intro-card p { color: var(--text-color); font-size: var(--font-size-base); margin: 8px 0; }

        /* --- 水印样式 --- */
        .watermark {
            position: fixed;
            bottom: 15px;
            left: 15px;
            z-index: 1001;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.3);
            text-align: left;
            pointer-events: none; /* 确保水印不影响下层元素的交互 */
        }
        .watermark p {
            margin: 0;
            line-height: 1.4;
        }

        /* 毛玻璃基础效果 */
        .glass-effect {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.16);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 14px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.08);
        }

        /* 删除按钮毛玻璃特效样式 */
        .delete-task-btn {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.16);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-left: 8px;
        }
        .delete-task-btn:hover {
            background: rgba(255, 59, 48, 0.2);
            border-color: rgba(255, 59, 48, 0.4);
            color: #ff3b30;
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(255, 59, 48, 0.2);
        }
        .delete-task-btn:active {
            transform: scale(0.95);
        }

        /* --- 【新增】资源库样式 --- */
        .resource-section {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .resource-section:last-child {
            margin-bottom: 0;
        }
        .resource-item {
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-height: 80px;
        }
        .resource-info h5 {
            margin: 0 0 8px 0;
            font-size: var(--font-size-large);
            color: var(--text-color);
            font-weight: 600;
        }
        .resource-info p {
            margin: 0;
            color: var(--text-color-darker);
            font-size: var(--font-size-base);
            line-height: 1.5;
        }
        .resource-actions {
            flex-shrink: 0;
            align-self: flex-start;
        }
        .resource-actions .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: var(--font-size-base);
        }
        .resource-actions .btn-download {
            background: var(--glass-bg);
            color: var(--text-color);
            border: 1px solid var(--glass-border);
        }
        .resource-actions .btn-download:hover {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        /* 响应式适配 */
        @media (max-width: 768px) {
            .resource-actions {
                width: 100%;
            }
            .resource-actions .btn {
                width: 100%;
                justify-content: center;
            }
        }
    
/* ============== 【新增】学习反馈模块样式 ============== */
.feedback-prompt { color: var(--text-color-darker); font-size: 14px; line-height: 1.6; margin-bottom: 8px; display: none; }
.feedback-prompt.active { display: block; }
.feedback-action-btn { 
    margin-top: 10px; 
    padding: 12px 20px; 
    background: var(--glass-bg); 
    backdrop-filter: blur(10px); 
    -webkit-backdrop-filter: blur(10px); 
    border: 1px solid var(--glass-border); 
    border-radius: 14px; 
    color: var(--text-color); 
    cursor: pointer; 
    transition: all 0.3s ease; 
    font-weight: 600; 
    box-shadow: 0 8px 24px rgba(0,0,0,0.08);
}
.feedback-action-btn:hover { 
    background: rgba(255,255,255,0.15); 
    transform: translateY(-2px); 
    box-shadow: 0 12px 32px rgba(0,0,0,0.12); 
    border-color: rgba(255,255,255,0.3);
}

/* 模态框容器 */
.feedback-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.55); display: none; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(4px); animation: fadeIn 0.25s ease; }
.feedback-modal.open { display: flex; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* 模态框内容 */
.feedback-content { width: min(820px, 92vw); max-height: 86vh; overflow: hidden; background: rgba(255,255,255,0.06); border: 1px solid var(--glass-border); border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.35); backdrop-filter: blur(12px); transform: translateY(20px); animation: slideUp 0.35s ease forwards; }
@keyframes slideUp { to { transform: translateY(0); } }

.feedback-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; border-bottom: 1px solid var(--glass-border); background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0)); }
.feedback-header h2 { font-size: 20px; margin: 0; }
.feedback-header .close-feedback { background: transparent; border: none; color: var(--text-color); font-size: 24px; cursor: pointer; padding: 4px 8px; border-radius: 8px; transition: background 0.2s ease; }
.feedback-header .close-feedback:hover { background: rgba(255,255,255,0.08); }

#feedback-form { padding: 14px 20px 20px; overflow: auto; max-height: calc(86vh - 60px); }
.feedback-section { margin-bottom: 16px; padding: 12px; border-radius: 14px; border: 1px dashed var(--glass-border); background: rgba(255,255,255,0.04); }
.feedback-section h3 { margin: 0 0 10px; font-size: 16px; }

/* 任务完成情况区域 */
.task-completion-list { display: grid; grid-template-columns: 1fr; gap: 15px; }
.task-completion-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; border-radius: 10px; background: rgba(0,0,0,0.18); border: 1px solid var(--glass-border); }
.task-completion-item .left { display: flex; align-items: center; gap: 10px; }
.task-completion-item input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--success-color); }

/* 滑块样式 */
.slider-group { margin-bottom: 12px; }
.slider-label { display: block; margin-bottom: 6px; color: var(--text-color); font-weight: 600; }
.slider-container { display: grid; grid-template-columns: 20px 1fr 20px 40px; align-items: center; gap: 10px; }
.slider { -webkit-appearance: none; appearance: none; width: 100%; height: 6px; border-radius: 10px; background: linear-gradient(90deg, rgba(59,130,246,0.6), rgba(59,130,246,0.2)); outline: none; }
.slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 18px; height: 18px; background: #fff; border: 2px solid var(--accent-color); border-radius: 50%; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.25); transition: transform 0.15s ease; }
.slider::-webkit-slider-thumb:hover { transform: scale(1.06); }
.slider-value { justify-self: end; font-weight: 700; color: var(--accent-color); }

/* 文本域、单选样式 */
.textarea-group textarea { width: 100%; min-height: 70px; border-radius: 12px; background: rgba(0,0,0,0.18); border: 1px solid var(--glass-border); padding: 10px 12px; color: var(--text-color); resize: vertical; }
.radio-group .radio-options { display: grid; grid-template-columns: 1fr; gap: 8px; }
.radio-option { display: flex; align-items: center; gap: 8px; padding: 10px 12px; border-radius: 10px; background: rgba(0,0,0,0.18); border: 1px solid var(--glass-border); }
.radio-option input[type="radio"] { accent-color: var(--accent-color); }

/* 提交按钮 */
.feedback-submit { width: 100%; padding: 12px 16px; border: none; border-radius: 12px; background: linear-gradient(135deg, var(--accent-color), #7aa7ff); color: #fff; font-weight: 700; cursor: pointer; box-shadow: 0 10px 30px rgba(59,130,246,0.35); transition: transform 0.2s ease, box-shadow 0.2s ease; }
.feedback-submit:hover { transform: translateY(-1px); box-shadow: 0 16px 36px rgba(59,130,246,0.45); }

@media (min-width: 720px) {
  .task-completion-list { grid-template-columns: 1fr 1fr; }
}

/* ======================= 闪记卡样式 ======================= */

/* 闪记卡模态框 */
.flashcard-modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    backdrop-filter: blur(4px);
    animation: fadeIn 0.25s ease;
}

.flashcard-modal.open {
    display: flex;
}

.flashcard-modal-content {
    width: min(500px, 90vw);
    max-height: 80vh;
    overflow: hidden;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 16px;
    backdrop-filter: blur(12px);
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}

.flashcard-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 25px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    background: linear-gradient(180deg, rgba(255,255,255,0.1), transparent);
}

.flashcard-modal-header h2 {
    margin: 0;
    font-size: 20px;
    color: #fff;
    font-weight: 600;
}

.close-flashcard-modal {
    background: transparent;
    border: none;
    color: #fff;
    font-size: 24px;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 6px;
    transition: background 0.2s ease;
}

.close-flashcard-modal:hover {
    background: rgba(255,255,255,0.1);
}

/* 表单样式 */
#flashcard-form {
    padding: 25px;
    overflow-y: auto;
    max-height: calc(80vh - 80px);
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: #fff;
    font-weight: 500;
    font-size: 14px;
}

.form-group textarea,
.form-group select,
.form-group input {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 10px;
    background: rgba(255,255,255,0.1);
    color: #fff;
    font-size: 14px;
    outline: none;
    transition: all 0.3s ease;
}

.form-group textarea {
    min-height: 80px;
    resize: vertical;
    font-family: inherit;
}

.form-group textarea:focus,
.form-group select:focus,
.form-group input:focus {
    border-color: var(--accent-color);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.form-group textarea::placeholder,
.form-group input::placeholder {
    color: rgba(255,255,255,0.6);
}

.form-group select option {
    background: #2a2a2a;
    color: #fff;
}

.radio-group {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.radio-option {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 15px;
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 10px;
    background: rgba(255,255,255,0.05);
    cursor: pointer;
    transition: all 0.3s ease;
}

.radio-option:hover {
    background: rgba(255,255,255,0.1);
    border-color: rgba(255,255,255,0.3);
}

.radio-option input[type="radio"] {
    width: auto;
    margin: 0;
    accent-color: var(--accent-color);
}

.form-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    margin-top: 25px;
    padding-top: 20px;
    border-top: 1px solid rgba(255,255,255,0.1);
}

.btn-cancel,
.btn-save {
    padding: 12px 20px;
    border: none;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-cancel {
    background: rgba(255,255,255,0.1);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.2);
}

.btn-cancel:hover {
    background: rgba(255,255,255,0.15);
}

.btn-save {
    background: var(--accent-color);
    color: white;
    border: 1px solid var(--accent-color);
}

.btn-save:hover {
    background: var(--accent-color-hover);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

/* 按钮通用样式 */
.btn {
    padding: 10px 16px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
}

.btn-primary {
    background: var(--accent-color);
    color: white;
    border: 1px solid var(--accent-color);
}

.btn-primary:hover {
    background: var(--accent-color-hover);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.btn-success {
    background: var(--success-color);
    color: white;
    border: 1px solid var(--success-color);
}

.btn-success:hover {
    background: #22c55e;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
}

.btn-secondary {
    background: rgba(255,255,255,0.1);
    color: var(--text-color);
    border: 1px solid rgba(255,255,255,0.2);
}

.btn-secondary:hover {
    background: rgba(255,255,255,0.15);
}

/* 侧边栏头部动作按钮 */
.header-actions {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.header-actions .btn {
    font-size: 12px;
    padding: 8px 12px;
}

/* 空列表样式 */
.empty-list {
    text-align: center;
    padding: 40px 20px;
    color: rgba(255,255,255,0.6);
    font-size: 14px;
}

/* 卡片预览样式 */
.card-preview {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.card-front-preview {
    color: #fff;
    font-weight: 600;
    font-size: 14px;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.card-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
    color: rgba(255, 255, 255, 0.6);
}

.card-category {
    padding: 2px 8px;
    border-radius: 12px;
    background: rgba(255,255,255,0.1);
    font-size: 10px;
}

.card-difficulty {
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 500;
}

.card-difficulty.easy { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
.card-difficulty.medium { background: rgba(249, 115, 22, 0.2); color: #f97316; }
.card-difficulty.hard { background: rgba(239, 68, 68, 0.2); color: #ef4444; }

/* 卡片操作按钮 */
.card-actions {
    display: flex;
    gap: 8px;
    margin-top: 10px;
}

.btn-study,
.btn-delete {
    padding: 6px 12px;
    border: none;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-study {
    background: var(--accent-color);
    color: white;
    flex: 1;
}

.btn-study:hover {
    background: var(--accent-color-hover);
    transform: translateY(-1px);
}

.btn-delete {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.3);
}

.btn-delete:hover {
    background: rgba(239, 68, 68, 0.3);
    border-color: #ef4444;
}

/* 闪记卡容器 */
.flashcard-container {
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}

/* 闪记卡头部 */
.flashcard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 30px;
    margin-bottom: 20px;
    border-radius: 16px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.flashcard-title {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 24px;
    font-weight: 700;
    color: #fff;
    margin: 0;
}

.flashcard-title svg {
    color: var(--accent-color);
}

.flashcard-stats {
    display: flex;
    gap: 30px;
}

.stat-item {
    text-align: center;
}

.stat-label {
    display: block;
    font-size: 12px;
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 4px;
}

.stat-value {
    display: block;
    font-size: 20px;
    font-weight: 700;
    color: var(--accent-color);
}

/* 闪记卡主体 */
.flashcard-main {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 20px;
    height: calc(100vh - 200px);
    min-height: 600px;
}

/* 左侧边栏 */
.flashcard-sidebar {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 16px;
    padding: 20px;
    display: flex;
    flex-direction: column;
}

.sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.sidebar-header h3 {
    color: #fff;
    font-size: 18px;
    font-weight: 600;
    margin: 0;
}

.card-filters {
    margin-bottom: 20px;
}

.filter-select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    font-size: 14px;
}

.filter-select option {
    background: #2a2a2a;
    color: #fff;
}

.card-list {
    flex: 1;
    overflow-y: auto;
}

.card-item {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.card-item:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: var(--accent-color);
    transform: translateY(-2px);
}

.card-item.active {
    background: rgba(59, 130, 246, 0.2);
    border-color: var(--accent-color);
}

.card-item-front {
    color: #fff;
    font-weight: 600;
    margin-bottom: 8px;
    font-size: 14px;
    line-height: 1.4;
    display: -webkit-box;
    /* 设置行数限制,实现多浏览器兼容 */
    -webkit-line-clamp: 2; /* Safari */
    line-clamp: 2; /* 标准属性 */
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.card-item-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
    color: rgba(255, 255, 255, 0.6);
}

.card-status {
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 500;
}

.card-status.new { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
.card-status.learning { background: rgba(249, 115, 22, 0.2); color: #f97316; }
.card-status.review { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
.card-status.mastered { background: rgba(168, 85, 247, 0.2); color: #a855f7; }

/* 学习区域 */
.flashcard-study-area {
    display: flex;
    flex-direction: column;
    position: relative;
}

/* 空状态 */
.empty-state {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
}

.empty-content {
    text-align: center;
    padding: 60px 40px;
    border-radius: 16px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.empty-content svg {
    color: rgba(255, 255, 255, 0.4);
    margin-bottom: 20px;
}

.empty-content h3 {
    color: #fff;
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 12px;
}

.empty-content p {
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 24px;
    font-size: 14px;
}

/* 开始学习提示 */
.start-learning-prompt {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* 学习模式 */
.study-mode {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

/* 进度条 */
.study-progress {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    padding: 16px 20px;
}

.progress-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    color: #fff;
    font-size: 14px;
    font-weight: 500;
}

.progress-bar {
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent-color), #7aa7ff);
    border-radius: 4px;
    transition: width 0.3s ease;
    width: 0%;
}

/* 3D卡片容器 */
.card-3d-container {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    perspective: 1000px;
    min-height: 400px;
}

.flashcard-3d {
    width: 100%;
    max-width: 500px;
    height: 300px;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s ease;
    cursor: pointer;
}

.flashcard-3d.flipped {
    transform: rotateY(180deg);
}

.card-face {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 30px;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.card-front {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
    border: 2px solid rgba(255, 255, 255, 0.2);
    color: #fff;
}

.card-back {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.1));
    border: 2px solid rgba(59, 130, 246, 0.3);
    color: #fff;
    transform: rotateY(180deg);
}

.card-content {
    font-size: clamp(14px, 1.1vw, 18px);
    line-height: 1.6;
    max-height: 100%;
    overflow-y: auto;
    width: 100%;
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
}

.card-front .card-content {
    font-weight: 600;
    font-size: clamp(16px, 1.2vw, 20px);
}

/* 控制按钮 */
.study-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    padding: 20px;
}

.difficulty-buttons {
    display: flex;
    gap: 12px;
}

.btn-difficulty {
    padding: 10px 16px;
    border: none;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-hard {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
}

.btn-hard:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
}

.btn-medium {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: white;
}

.btn-medium:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
}

.btn-easy {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
}

.btn-easy:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
}

/* 响应式设计 */
@media (max-width: 768px) {
    .flashcard-main {
        grid-template-columns: 1fr;
        height: auto;
    }
    
    .flashcard-sidebar {
        order: 2;
        height: 300px;
    }
    
    .flashcard-study-area {
        order: 1;
        min-height: 500px;
    }
    
    .flashcard-header {
        flex-direction: column;
        gap: 20px;
        text-align: center;
    }
    
    .flashcard-stats {
        gap: 20px;
    }
    
    .card-3d-container {
        min-height: 300px;
    }
    
    .flashcard-3d {
        height: 250px;
    }
}


    /* ============== PDF预览模态框样式 ============== */
    .pdf-preview-modal {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.8);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1001;
        backdrop-filter: blur(4px);
        animation: fadeIn 0.25s ease;
    }
    .pdf-preview-modal.open { display: flex; }
    .pdf-preview-content {
        width: min(95vw, 1200px);
        height: min(90vh, 800px);
        background: rgba(255,255,255,0.06);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.35);
        backdrop-filter: blur(12px);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }
    .pdf-preview-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        background: rgba(0,0,0,0.35);
        border-bottom: 1px solid var(--glass-border);
    }
    .pdf-preview-header h2 { margin: 0; font-size: 16px; color: #fff; }
    .close-pdf-preview { background: transparent; border: none; color: #fff; font-size: 24px; cursor: pointer; }
    .pdf-preview-body { flex: 1; background: #111; }

/* ======================= 新建闪记卡模态框样式 ======================= */

/* 模态框背景 */
.flashcard-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
}

/* 模态框内容 */
.flashcard-modal-content {
    position: relative;
    background: var(--card-bg);
    margin: 5% auto;
    padding: 0;
    border-radius: 16px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

@keyframes slideInRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

@keyframes slideOutRight {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
}

/* 模态框头部 */
.flashcard-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    border-bottom: 1px solid var(--border-color);
    background: linear-gradient(135deg, var(--accent-color), #7aa7ff);
    border-radius: 16px 16px 0 0;
    color: white;
}

.flashcard-modal-header h2 {
    margin: 0;
    font-size: 1.2rem;
    font-weight: 600;
}

.close-flashcard-modal {
    background: none;
    border: none;
    font-size: 24px;
    color: white;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background-color 0.2s ease;
}

.close-flashcard-modal:hover {
    background-color: rgba(255, 255, 255, 0.2);
}

/* 表单样式 */
#flashcard-form {
    padding: 24px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--text-color);
    font-size: 0.9rem;
}

.form-group textarea,
.form-group select,
.form-group input[type="date"] {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    background: var(--input-bg, var(--card-bg));
    color: var(--text-color);
    font-size: 0.9rem;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
    resize: vertical;
    min-height: 80px;
}

.form-group textarea:focus,
.form-group select:focus,
.form-group input[type="date"]:focus {
    outline: none;
    border-color: var(--accent-color);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.form-group select {
    min-height: auto;
    height: 44px;
}

/* 单选按钮组 */
.radio-group {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.radio-option {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    padding: 8px 0;
    transition: color 0.2s ease;
}

.radio-option:hover {
    color: var(--accent-color);
}

.radio-custom {
    width: 18px;
    height: 18px;
    border: 2px solid var(--border-color);
    border-radius: 50%;
    position: relative;
    transition: border-color 0.2s ease;
}

.radio-option input[type="radio"] {
    display: none;
}

.radio-option input[type="radio"]:checked + .radio-custom {
    border-color: var(--accent-color);
}

.radio-option input[type="radio"]:checked + .radio-custom::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 8px;
    height: 8px;
    background: var(--accent-color);
    border-radius: 50%;
}

/* 表单操作按钮 */
.form-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
}

.btn-cancel,
.btn-save {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.9rem;
}

.btn-cancel {
    background: var(--secondary-bg, #f3f4f6);
    color: var(--text-secondary, #6b7280);
}

.btn-cancel:hover {
    background: var(--border-color);
}

.btn-save {
    background: linear-gradient(135deg, var(--accent-color), #7aa7ff);
    color: white;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.btn-save:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
}

/* 通用按钮样式 */
.btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    border: none;
    border-radius: 8px;
    font-weight: 500;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    background: var(--glass-bg);
    color: var(--text-color);
    border: 1px solid var(--glass-border);
}

.btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.btn-primary {
    background: linear-gradient(135deg, var(--accent-color), #7aa7ff);
    color: white;
    border: 1px solid var(--accent-color);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.btn-primary:hover {
    background: linear-gradient(135deg, var(--accent-color-hover), #6b96ff);
    box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
    transform: translateY(-1px);
}

/* 响应式设计 */
@media (max-width: 768px) {
    .flashcard-modal-content {
        width: 95%;
        margin: 10% auto;
    }
    
    .flashcard-modal-header,
    #flashcard-form {
        padding: 16px 20px;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .btn-cancel,
    .btn-save {
        width: 100%;
    }
}

/* === 工具类：替换内联样式 === */
/* 显示/隐藏工具类 */
.is-hidden { display: none !important; }
.is-visible { display: block !important; }
.is-invisible { visibility: hidden !important; }
.opacity-0 { opacity: 0 !important; }
.opacity-60 { opacity: 0.6 !important; }
.opacity-85 { opacity: 0.85 !important; }

/* 布局工具类 */
.d-flex { display: flex !important; }
.d-grid { display: grid !important; }
.d-inline-block { display: inline-block !important; }
.d-none { display: none !important; }
.d-block { display: block !important; }
.flex-column { flex-direction: column !important; }
.flex-wrap { flex-wrap: wrap !important; }
.flex-1 { flex: 1 !important; }
.line-height-15 { line-height: 1.5 !important; }
.line-height-16 { line-height: 1.6 !important; }
.webkit-line-clamp-2 { display: -webkit-box !important; -webkit-line-clamp: 2 !important; -webkit-box-orient: vertical !important; }
.webkit-line-clamp-3 { display: -webkit-box !important; -webkit-line-clamp: 3 !important; -webkit-box-orient: vertical !important; }
.align-items-center { align-items: center !important; }
.align-items-flex-start { align-items: flex-start !important; }
.align-items-start { align-items: flex-start !important; }
.justify-content-center { justify-content: center !important; }
.justify-content-space-between { justify-content: space-between !important; }
.justify-content-between { justify-content: space-between !important; }
.justify-content-space-between { justify-content: space-between !important; }
.text-align-center { text-align: center !important; }
.text-align-left { text-align: left !important; }
.font-weight-600 { font-weight: 600 !important; }
.font-weight-700 { font-weight: 700 !important; }

/* 定位工具类 */
.position-fixed { position: fixed !important; }
.top-10 { top: 10px !important; }
.right-10 { right: 10px !important; }
.z-index-10 { z-index: 10 !important; }
.position-absolute { position: absolute !important; }
.position-relative { position: relative !important; }
.inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
.top-50 { top: 50% !important; }
.left-50 { left: 50% !important; }
.transform-center { transform: translate(-50%, -50%) !important; }

/* 间距工具类 */
.gap-5 { gap: 5px !important; }
.gap-6 { gap: 6px !important; }
.gap-8 { gap: 8px !important; }
.gap-10 { gap: 10px !important; }
.gap-12 { gap: 12px !important; }
.gap-15 { gap: 15px !important; }
.gap-18 { gap: 18px !important; }
.gap-25 { gap: 25px !important; }
.gap-30 { gap: 30px !important; }
.mt-8 { margin-top: 8px !important; }
.mt-10 { margin-top: 10px !important; }
.mt-15 { margin-top: 15px !important; }
.mt-18 { margin-top: 18px !important; }
.mt-5 { margin-top: 5px !important; }
.mt-20 { margin-top: 20px !important; }
.ml-8 { margin-left: 8px !important; }
.mb-5 { margin-bottom: 5px !important; }
.mb-8 { margin-bottom: 8px !important; }
.mb-15 { margin-bottom: 15px !important; }
.mb-16 { margin-bottom: 16px !important; }
.mb-20 { margin-bottom: 20px !important; }
.mb-10 { margin-bottom: 10px !important; }
.mb-0 { margin-bottom: 0 !important; }
.mb-25 { margin-bottom: 25px !important; }
.mb-30 { margin-bottom: 30px !important; }
.mt-120 { margin-top: 120px !important; }
.ml-10 { margin-left: 10px !important; }
.p-0 { padding: 0 !important; }
.p-12 { padding: 12px !important; }
.p-15 { padding: 15px !important; }
.p-16 { padding: 16px !important; }
.p-20 { padding: 20px !important; }
.p-40 { padding: 40px !important; }
.p-40-20 { padding: 40px 20px !important; }
.p-8-16 { padding: 8px 16px !important; }
.m-5-0-0-0 { margin: 5px 0 0 0 !important; }
.m-0 { margin: 0 !important; }
.m-0-0-15-0 { margin: 0 0 15px 0 !important; }
.my-3 { margin-top: 3px !important; margin-bottom: 3px !important; }
.my-5 { margin-top: 5px !important; margin-bottom: 5px !important; }

/* 网格工具类 */
.grid-cols-2 { grid-template-columns: 1fr 1fr !important; }
.grid-cols-auto-fit { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) !important; }
.grid-column-full { grid-column: 1 / -1 !important; }

/* 尺寸工具类 */
.w-full { width: 100% !important; }
.h-full { height: 100% !important; }
.min-h-200 { min-height: 200px !important; }
.min-h-360 { min-height: 360px !important; }
.h-180 { height: 180px !important; }
.w-48 { width: 48px !important; }
.h-48 { height: 48px !important; }
.h-300 { height: 300px !important; }
.h-calc-100vh-220px { height: calc(100vh - 220px) !important; }
.h-500 { height: 500px !important; }
.max-h-80vh { max-height: 80vh !important; }
.max-h-200 { max-height: 200px !important; }
.w-min-600-90vw { width: min(600px, 90vw) !important; }
.w-min-720 { width: min(720px, 92vw) !important; }
.w-min-920 { width: min(920px, 92vw) !important; }

/* 背景和边框工具类 */
.bg-overlay { background: rgba(0,0,0,0.45) !important; }
.bg-dark-overlay { background: rgba(0,0,0,0.7) !important; }
.bg-white-overlay { background: rgba(255,255,255,0.1) !important; }
.bg-gray { background: #6c757d !important; }
.bg-black-07 { background: rgba(0,0,0,0.7) !important; }
.bg-accent { background: var(--accent-color) !important; }
.bg-white-05 { background: rgba(255,255,255,0.05) !important; }
.bg-white-005 { background: rgba(255,255,255,0.05) !important; }
.bg-transparent { background: transparent !important; }
.backdrop-blur { backdrop-filter: blur(8px) !important; }
.border-none { border: none !important; }
.outline-none { outline: none !important; }
.border-glass { border: 1px solid var(--glass-border) !important; }
.border-bottom-glass { border-bottom: 1px solid var(--glass-border) !important; }
.border-radius-6 { border-radius: 6px !important; }
.border-radius-8 { border-radius: 8px !important; }
.border-radius-12 { border-radius: 12px !important; }
.border-radius-16 { border-radius: 16px !important; }
.border-collapse { border-collapse: collapse !important; }

/* Z-index工具类 */
.z-1000 { z-index: 1000 !important; }
.z-1001 { z-index: 1001 !important; }

/* 字体工具类 */
.font-size-12 { font-size: 12px !important; }
.font-size-13 { font-size: 13px !important; }
.font-size-small { font-size: var(--font-size-small) !important; }
.font-size-14 { font-size: 14px !important; }
.font-size-16 { font-size: 16px !important; }
.font-size-18 { font-size: 18px !important; }
.font-size-24 { font-size: 24px !important; }
.font-size-28 { font-size: 28px !important; }
.font-size-base { font-size: var(--font-size-base) !important; }
.font-size-large { font-size: var(--font-size-large) !important; }
.font-size-clamp-16-22 { font-size: clamp(16px, 1.8vw, 22px) !important; }
.font-size-clamp-12-15 { font-size: clamp(12px, 1.2vw, 15px) !important; }
.font-size-clamp-14-18 { font-size: clamp(14px, 1.1vw, 18px) !important; }
.font-size-clamp-12-16 { font-size: clamp(12px, 1vw, 16px) !important; }
.font-size-large { font-size: var(--font-size-large) !important; }
.font-size-small { font-size: var(--font-size-small) !important; }

/* 颜色工具类 */
.text-accent { color: var(--accent-color) !important; }
.text-white { color: white !important; }
.text-color { color: var(--text-color) !important; }
.text-color-darker { color: var(--text-color-darker) !important; }
.text-darker { color: var(--text-color-darker) !important; }
.text-error { color: var(--error-color) !important; }
.text-success { color: var(--success-color) !important; }
.text-warning { color: var(--warning-color) !important; }
.text-green { color: #10b981 !important; }
.text-info { color: var(--info-color) !important; }

/* 按钮样式工具类 */
.btn-flex { display: flex; align-items: center; gap: 6px; }
.btn-flex-8 { display: flex; align-items: center; gap: 8px; }
.btn-padding-5-10 { padding: 5px 10px !important; }
.btn-padding-8-12 { padding: 8px 12px !important; }
.btn-padding-8-16 { padding: 8px 16px !important; }
.btn-padding-12-20 { padding: 12px 20px !important; }

/* 交互工具类 */
.cursor-pointer { cursor: pointer !important; }
.transition-all { transition: all 0.3s ease !important; }
.opacity-06 { opacity: 0.6 !important; }
.opacity-085 { opacity: 0.85 !important; }
.opacity-08 { opacity: 0.8 !important; }
.text-decoration-none { text-decoration: none !important; }
.display-inline-block { display: inline-block !important; }
.text-align-center { text-align: center !important; }
.overflow-hidden { overflow: hidden !important; }
.overflow-auto { overflow: auto !important; }
.overflow-y-auto { overflow-y: auto !important; }
.overflow-x-auto { overflow-x: auto !important; }
.position-relative { position: relative !important; }
.position-absolute { position: absolute !important; }
.position-fixed { position: fixed !important; }
.top-10 { top: 10px !important; }
.right-10 { right: 10px !important; }
.inset-0 { inset: 0 !important; }
.z-10 { z-index: 10 !important; }
.gap-6 { gap: 6px !important; }

</style>
</head>
<body>

    <!-- ======================= 汉堡菜单按钮 ======================= -->
    <div class="hamburger-menu" id="hamburger-menu">
        <div class="hamburger-icon">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>

    <!-- ======================= 遮罩层 ======================= -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <!-- ======================= 侧边栏导航 ======================= -->
    <aside class="sidebar glass-effect">
        <div class="logo">
            <h1 class="platform-name">四六级<br>备考平台</h1>
        </div>
        <nav>
            <ul>
                <li><a class="nav-link active" data-view="dashboard-view">
                    <svg xmlns="http://www.w.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>我的计划</a></li>
                <li><a class="nav-link" data-view="vocab-view">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20v2H6.5A2.5 2.5 0 0 1 4 19.5v0Z"/><path d="M4 5h16"/><path d="M4 12h16"/><path d="M4 8h16"/><path d="M4 16h16"/></svg>词汇中心</a></li>
                <li><a class="nav-link" data-view="checkin-view">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>词汇打卡表</a></li>
                <li><a class="nav-link" data-view="training-view"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>专项训练</a></li>
                <li><a class="nav-link" data-view="history-view"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/><path d="M12 7v5l4 2"/></svg>历史回顾</a></li>
                <li><a class="nav-link" data-view="zhenti-view"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10,9 9,9 8,9"/></svg>真题在线</a></li>
                <li><a class="nav-link" data-view="resource-view"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>资源库</a></li>
                <li><a class="nav-link" data-view="flashcard-view"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>闪记卡</a></li>
                <li><a class="nav-link" data-view="timeline-view"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>考试时间轴</a></li>

            </ul>
        </nav>
        
        <!-- 用户昵称区域 -->
        <div class="user-nickname glass-effect mt-20 p-15 text-align-center border-radius-12">
            <div id="nickname-display" class="font-size-large font-weight-600 text-color cursor-pointer transition-all" onclick="editNickname()">
                备考小能手
            </div>
            <p class="font-size-small text-darker m-5-0-0-0">点击编辑昵称</p>
        </div>

    </aside>

    <!-- ======================= 主内容区域 ======================= -->
    <main class="main-content">
        <!-- 顶部问候 -->
        <div class="greeting-top">
            <h2>你好，<span id="greet-name">备考小能手</span><span class="exam-countdown-inline" id="cet-countdown">，距离<span id="cet-title">四六级考试</span>还有<span id="cet-days">--</span>天</span></h2>
        </div>

        <!-- 【视图1】仪表盘 -->
        <div id="dashboard-view" class="view active-grid dashboard-grid">
            <!-- --- 【更新】今日任务 --- -->
            <div class="grid-item glass-effect">
                <h3 class="card-title"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>今日任务</h3>
                <div class="task-list">
                    <ul id="task-list-ul">
                        <!-- 任务将由JS动态添加 -->
                    </ul>
                </div>
                <form id="add-task-form">
                    <input type="text" id="new-task-input" placeholder="添加新任务..." autocomplete="off">
                    <button type="submit" id="add-task-btn">添加</button>
                </form>
            </div>

            <!-- 【新增】每日学习反馈卡片 -->
            <div class="grid-item glass-effect">
                <h3 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2h-4M9 11V9a3 3 0 1 1 6 0v2M9 11h6"/><path d="M12 15v2"/></svg>
                    每日学习反馈
                </h3>
                <div id="feedback-status-area">
                    <!-- 完成前提示 -->
                    <div id="feedback-before" class="feedback-prompt active">
                        <p>📝 今天的学习如何？</p>
                        <p class="text-darker font-size-small mb-15">通过反思总结，让每天的进步都被看见</p>
                    </div>
                    
                    <!-- 完成后提示 -->
                    <div id="feedback-after" class="feedback-prompt">
                        <p>✅ 今日反馈已完成</p>
                        <p class="text-darker font-size-small mb-15">感谢你的坚持！明天见</p>
                    </div>
                </div>
                
                <button id="feedback-btn" class="feedback-action-btn">
                    <span id="feedback-btn-text">开始反馈</span>
                </button>
                
                <!-- 简要统计显示 -->
                <div id="feedback-stats" class="mt-15 is-hidden">
                    <div class="d-flex justify-content-between text-darker font-size-small">
                        <span>专注度: <span id="stat-focus">-</span>/5</span>
                        <span>积极性: <span id="stat-motivation">-</span>/5</span>
                        <span>任务完成: <span id="stat-task-completion">-</span>%</span>
                    </div>
                </div>
            </div>

            <!-- 【新增】学习反馈趋势图 -->
            <div class="grid-item glass-effect">
                <h3 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                    学习状态趋势
                </h3>
                <p class="text-darker font-size-small mb-15">7天专注度和积极性变化曲线</p>
                
                <!-- 图表容器 -->
                <div class="position-relative h-180 mt-15">
                    <canvas id="feedback-chart" class="w-full h-full"></canvas>
                </div>
                
                <!-- 图表下方简要统计 -->
                <div class="mt-15 d-grid grid-cols-2 gap-10 font-size-small text-darker">
                    <div class="text-align-center">
                        <div class="font-weight-600 text-accent" id="avg-focus">-</div>
                        <div>平均专注度</div>
                    </div>
                    <div class="text-align-center">
                        <div class="font-weight-600 text-green" id="avg-motivation">-</div>
                        <div>平均积极性</div>
                    </div>
                </div>
            </div>

            <!-- 中部毛玻璃介绍（位于今日任务下方） -->
            <section class="intro-section">
                <div class="intro-card glass-effect">
                    <h4>欢迎来到这里！</h4>
                    <p>我们深知，备考四六级最令人沮丧的，不是单词有多难背，而是付出的努力仿佛石沉大海，不知道自己究竟在哪，离目标还有多远。</p>
                    <p>在开始备考前，我们首先需要理解一个核心问题：英语考试的本质是什么？它并非孤立的知识点考察，而是一门语言能力的综合体现。语言学习是一个长期积累、形成惯性的过程。只有当你将英语学习内化为一种稳定、持续的习惯时，才能在考场压力下发挥出应有的水平。因此，我们的备考思路，始于对语言本身的respect，致力于为你构建一个健康、可持续的学习生态。</p>
                    
                    <h4>1. 基石：将词汇学习，内化为一种高效的惯性</h4>
                    <p>词汇是英语世界最基本的通行证。但传统的死记硬背只会带来挫败感。我们必须 recognizes，背单词的本质是对抗遗忘，而这个需要形成一个科学的习惯。我们推崇的，是基于“艾宾浩斯遗忘曲线”的复习机制：让“复习”与“学习”这两个环节永远并行。你每天的任务不仅是认识新词，更重要的是在遗忘发生前，及时、高频地重温旧识。通过这种方式，词汇学习不再是一场痛苦攻坚战，而是融入你日常的、可积累的稳定惯性。</p>
                    
                    <h4>2. 核心：在实战应用中，理解语言的内在逻辑</h4>
                    <p>掌握了词汇，我们便需要通过听说读写译的练习，去理解英语作为一门语言的真实样貌和内在逻辑。每一个专项训练，都不是为了孤立地“刷题”，而是为了加深你对语言的感知力。例如，精听训练是为了让你捕捉信息的流动，限时阅读是为了让你适应英文的叙事节奏，而写作与翻译则是训练你用英语的逻辑去组织和表达思想。我们强调方法的有效性，旨在帮助你从“认识单词”跨越到“理解语篇”，真正做到学以致用。</p>
                    
                    <h4>3. 灵魂：通过精准反馈，清晰你的能力边界</h4>
                    <p>许多学生直到走进考场，都对自己“能考多少分”缺乏清晰的认知。这是因为他们对自己学习程度的掌握是模糊的、凭感觉的。学习一门语言的过程，也是个人理解能力边界被不断试探、不断清晰化的过程。 而系统性的反馈，就是帮助你主动描绘这个边界的工具。我们的反馈机制（每日反思、每周复盘、考后诊断）并非简单的对错记录，而是引导你进行深度思考的探针：我为什么会在这里卡住？我的困难是源于知识盲区还是技能缺陷？通过持续的自我审视，你能及时调整学习的航向，变被动的“完成任务”为主动的“解决问题”，最终带着自己对能力的清晰认知，自信地走向考场。</p>
                    
                    <h4>总结</h4>
                    <p>总结而言，我们的方法论是一条清晰的路径： 从建立词汇惯性出发，通过实战理解语言，最终依靠反馈看清自己。我们相信，最好的备考，是让你在提升分数的同时，也真正提升语言能力，并掌握一套终身受益的学习方法。</p>
                </div>
            </section>
        </div>

        <!-- 【视图2】词汇中心 -->
        <div id="vocab-view" class="view dashboard-grid active-grid">
            <div class="grid-item glass-effect pdf-card">
                <svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
                <h4>考试大纲</h4>
                <p>官方发布的完整词汇列表，备考必备的基础资料。</p>
                <div class="pdf-actions">
                    <a href="https://pan.quark.cn/s/125713bd9691" target="_blank" class="btn btn-download">网盘下载</a>
                </div>
            </div>
            <div class="grid-item glass-effect pdf-card">
                <svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="m10.3 16.3 1.4-1.4 1.4 1.4"/><path d="M12 19v-6"/></svg>
                <h4>四级词汇闪过</h4>
                <p>高效的词根词缀记忆法书籍，快速扩大你的词汇量。</p>
                <div class="pdf-actions">
                    <a href="https://pan.quark.cn/s/94d414336c31" target="_blank" class="btn btn-download">网盘下载</a>
                </div>
            </div>
            <div class="grid-item glass-effect pdf-card">
                <svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
                <h4>六级词汇闪过</h4>
                <p>全国大学英语六级考试考纲词汇，高效记忆法书籍。</p>
                <div class="pdf-actions">
                    <a href="https://pan.quark.cn/s/a7a4fc5d9df4" target="_blank" class="btn btn-download">网盘下载</a>
                </div>
            </div>
        </div>

        <!-- 【视图3】考试时间轴 -->
        <div id="timeline-view" class="view">
            <div class="weekly-plan-container">
                <!-- 顶部控制面板 -->
                <div class="control-panel glass-effect">
                    <div class="exam-selector">
                        <label>考试类型：</label>
                        <select id="weeklyExamType">
                            <option value="cet4">英语四级</option>
                            <option value="cet6">英语六级</option>
                        </select>
                    </div>
                    <div class="target-selector">
                        <label>目标分数：</label>
                        <select id="weeklyTargetScore">
                            <option value="425">425分（及格）</option>
                            <option value="500">500分（良好）</option>
                            <option value="600">600分（高分）</option>
                        </select>
                    </div>
                    <div class="week-navigation">
                        <button class="nav-btn" id="prev-week-btn">← 上周</button>
                        <span class="current-week" id="current-week-display">第1周</span>
                        <button class="nav-btn" id="next-week-btn">下周 →</button>
                    </div>
                </div>
                    
                <!-- 周计划主体 -->
                <div class="weekly-content">
                    <!-- 左侧：周概览 -->
                    <div class="week-overview glass-effect">
                        <h3>本周概览</h3>
                        <div class="week-info">
                            <div class="week-dates" id="week-dates">9/15 - 9/21</div>
                            <div class="week-theme" id="week-theme">基础词汇积累</div>
                            <div class="week-goal" id="week-goal">掌握200个核心词汇</div>
                        </div>
                        

                    </div>

                    <!-- 右侧：周计划详情 -->
                    <div class="week-plan-details">
                        <div class="week-plan-content glass-effect">
                            <h3 class="plan-title" id="week-plan-title">Week 1 (9/15–9/21) 打基础1</h3>
                            <div class="week-tasks-list" id="week-plan-tasks">
                                <!-- 动态生成周计划任务 -->
                            </div>
                            <div class="week-checkpoints-list" id="week-plan-checkpoints">
                                <!-- 动态生成本周检查点/总结 -->
                            </div>
                        </div>
                    </div>
                </div>


            </div>


        </div>
        </div>

        <!-- 【视图4】词汇打卡表（双轮复习） -->
        <div id="checkin-view" class="view">
            <div class="checkin-header">
                <h3 class="card-title mb-0">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                    词汇打卡表（双轮复习）
                </h3>
                <div class="week-selector">
                    <button class="week-nav-btn" id="prev-week">上周</button>
                    <div class="week-info" id="week-info">第 1 周</div>
                    <button class="week-nav-btn" id="next-week">下周</button>
                </div>
            </div>

            <table class="checkin-table glass-effect">
                <thead>
                    <tr>
                        <th>日期</th>
                        <th>上午（复习/学习）</th>
                        <th>晚上（复习/学习）</th>
                    </tr>
                </thead>
                <tbody id="checkin-tbody">
                    <!-- 由脚本动态渲染一周（7天） -->
                </tbody>
            </table>

            <div class="week-stats">
                <div class="stat-card glass-effect">
                    <div class="stat-number" id="stat-total">0</div>
                    <div class="stat-label">本周总打卡（次）</div>
                </div>
                <div class="stat-card glass-effect">
                    <div class="stat-number" id="stat-review">0</div>
                    <div class="stat-label">复习完成（次）</div>
                </div>
                <div class="stat-card glass-effect">
                    <div class="stat-number" id="stat-learn">0</div>
                    <div class="stat-label">学习完成（次）</div>
                </div>
                <div class="stat-card glass-effect">
                    <div class="stat-number" id="stat-days">0/7</div>
                    <div class="stat-label">达成打卡的天数</div>
                </div>
            </div>

            <!-- 折线图容器 -->
            <div class="glass-effect mt-20 p-15 border-radius-12">
                <canvas id="checkin-chart" height="120"></canvas>
            </div>
        </div>

        <!-- 【视图5】专项训练视图 -->
        <div id="training-view" class="view dashboard-grid">
            <!-- 听力训练板块 -->
            <div class="grid-item glass-effect">
                <div class="d-flex justify-content-between align-items-center mb-15">
                    <h3 class="card-title m-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        听力训练
                    </h3>
                    <button 
                        id="open-listening-external"
                        class="btn-padding-8-16 bg-accent text-white border-none border-radius-6 cursor-pointer font-size-14 btn-flex"
                        title="在新标签页中打开">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                            <polyline points="15,3 21,3 21,9"/>
                            <line x1="10" y1="14" x2="21" y2="3"/>
                        </svg>
                        新窗口打开
                    </button>
                </div>
                <p class="text-darker mb-15">VOA 慢速英语 - 专业的听力练习平台</p>
                
                <!-- iframe 容器 -->
                <div class="position-relative w-full h-500 border-radius-8 overflow-hidden border-glass">
                    <div class="position-absolute top-10 right-10 z-10">
                        <button 
                            onclick="window.open('https://www.21voa.com/special_english/', '_blank')"
                            class="btn-padding-8-12 bg-dark-overlay text-white border-none border-radius-6 cursor-pointer font-size-12 btn-flex"
                            title="在新标签页中打开">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                                <polyline points="15,3 21,3 21,9"/>
                                <line x1="10" y1="14" x2="21" y2="3"/>
                            </svg>
                            新窗口
                        </button>
                    </div>
                    <iframe 
                        src="https://www.21voa.com/special_english/" 
                        frameborder="0" 
                        class="w-full h-full"
                        title="VOA 听力练习"
                        onload="this.style.opacity='1'"
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                    </iframe>
                    
                    <!-- 备用提示 -->
                    <div class="is-hidden position-absolute top-50 left-50 transform-center text-align-center text-color">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-15 opacity-06"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                        <p class="m-0 text-darker">无法加载听力练习页面</p>
                        <a href="https://www.21voa.com/special_english/" target="_blank" class="text-accent text-decoration-none font-size-base mt-10 d-inline-block">
                            点击此处在新窗口打开 →
                        </a>
                    </div>
                </div>
            </div>

            <!-- 阅读训练板块 -->
            <div class="grid-item glass-effect d-flex flex-column align-items-center justify-content-center min-h-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-15 opacity-06"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
                <h3 class="card-title mb-8">阅读训练</h3>
                <p class="text-color-darker text-align-center m-0">施工中...</p>
                <p class="text-color-darker font-size-small text-align-center mt-5">敬请期待阅读理解专项练习</p>
            </div>

            <!-- 翻译训练板块 -->
            <div class="grid-item glass-effect d-flex flex-column align-items-center justify-content-center min-h-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-15 opacity-06"><path d="M5 8l6 6"/><path d="M4 14l6-6 2-3"/><path d="M2 5h12"/><path d="M7 2h1"/><path d="M22 22l-5-10-5 10"/><path d="M14 18h6"/></svg>
                <h3 class="card-title mb-8">翻译训练</h3>
                <p class="text-color-darker text-align-center m-0">施工中...</p>
                <p class="text-color-darker font-size-small text-align-center mt-5">敬请期待翻译专项练习</p>
            </div>

            <!-- 写作训练板块 -->
            <div class="grid-item glass-effect">
                <div class="d-flex justify-content-between align-items-center mb-15">
                    <h3 class="card-title m-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>
                        写作训练
                    </h3>
                    <button 
                        id="open-writing-external"
                        class="btn-padding-8-16 bg-accent text-white border-none border-radius-6 cursor-pointer font-size-14 btn-flex"
                        title="在新标签页中打开">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                            <polyline points="15,3 21,3 21,9"/>
                            <line x1="10" y1="14" x2="21" y2="3"/>
                        </svg>
                        新窗口打开
                    </button>
                </div>
                <p class="text-color-darker mb-15">批改网 - 专业的英语写作练习与批改平台</p>
                
                <!-- iframe 容器 -->
                <div class="position-relative w-full h-500 border-radius-8 overflow-hidden border-glass">
                    <div class="position-absolute top-10 right-10 z-10">
                        <button 
                            onclick="window.open('https://www.pigai.org/', '_blank')"
                            class="btn-padding-8-12 bg-dark-overlay text-white border-none border-radius-6 cursor-pointer font-size-12 btn-flex"
                            title="在新标签页中打开">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                                <polyline points="15,3 21,3 21,9"/>
                                <line x1="10" y1="14" x2="21" y2="3"/>
                            </svg>
                            新窗口
                        </button>
                    </div>
                    <iframe 
                        src="https://www.pigai.org/" 
                        frameborder="0" 
                        class="w-full h-full"
                        title="批改网写作练习"
                        onload="this.style.opacity='1'"
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                    </iframe>
                    
                    <!-- 备用提示 -->
                    <div class="is-hidden position-absolute top-50 left-50 transform-center text-align-center text-color">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-15 opacity-06"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                        <p class="m-0 text-color-darker">无法加载写作练习页面</p>
                        <a href="https://www.pigai.org/" target="_blank" class="text-accent text-decoration-none font-size-base mt-10 display-inline-block">
                            点击此处在新窗口打开 →
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 【视图5】历史回顾视图 -->
        <div id="history-view" class="view">
            <!-- 历史回顾头部 -->
            <div class="history-header glass-effect mb-20 p-20 border-radius-12">
                <h2 class="m-0 mb-10 font-size-24 text-color">📊 学习历史回顾</h2>
                <p class="m-0 text-color-darker font-size-16">查看您的学习轨迹，分析进步趋势</p>
            </div>

            <!-- 快速统计卡片 -->
            <div class="history-stats-grid d-grid grid-cols-auto-fit gap-25 mb-25">
                <div class="stat-card glass-effect p-20 border-radius-12 text-align-center">
                    <div class="stat-number font-size-28 font-weight-700 text-accent mb-5" id="total-days">0</div>
                    <div class="stat-label text-color-darker font-size-14">总学习天数</div>
                </div>
                <div class="stat-card glass-effect p-20 border-radius-12 text-align-center">
                    <div class="stat-number font-size-28 font-weight-700 text-success mb-5" id="avg-completion">0%</div>
                    <div class="stat-label text-color-darker font-size-14">平均完成率</div>
                </div>
                <div class="stat-card glass-effect p-20 border-radius-12 text-align-center">
                    <div class="stat-number font-size-28 font-weight-700 text-warning mb-5" id="streak-days">0</div>
                    <div class="stat-label text-color-darker font-size-14">连续学习天数</div>
                </div>
                <div class="stat-card glass-effect p-20 border-radius-12 text-align-center">
                    <div class="stat-number font-size-28 font-weight-700 text-info mb-5" id="avg-focus">0</div>
                    <div class="stat-label text-color-darker font-size-14">平均专注度</div>
                </div>
            </div>

            <!-- 筛选和控制面板 -->
            <div class="history-controls glass-effect mb-20 p-20 border-radius-12">
                <div class="d-flex flex-wrap gap-15 align-items-center justify-content-between">
                    <div class="d-flex gap-15 align-items-center flex-wrap">
                        <div>
                            <label class="d-block mb-5 text-color font-size-14">日期范围</label>
                            <select id="date-range-select" class="btn-padding-8-12 border-radius-8 bg-dark-overlay border-glass text-color">
                                <option value="7">最近7天</option>
                                <option value="30" selected>最近30天</option>
                                <option value="90">最近90天</option>
                                <option value="all">全部</option>
                            </select>
                        </div>
                        <div>
                            <label class="d-block mb-5 text-color font-size-14">数据类型</label>
                            <select id="data-type-select" class="btn-padding-8-12 border-radius-8 bg-dark-overlay border-glass text-color">
                                <option value="all" selected>全部数据</option>
                                <option value="tasks">任务完成</option>
                                <option value="feedback">学习反馈</option>
                                <option value="checkin">词汇打卡</option>
                            </select>
                        </div>
                    </div>
                    <div class="d-flex gap-10">
                        <button id="refresh-history" class="btn-secondary btn-padding-8-16 border-radius-8 bg-white-overlay border-glass text-color cursor-pointer">🔄 刷新</button>
                        <button id="export-history" class="btn-primary btn-padding-8-16 border-radius-8 bg-accent border-none text-white cursor-pointer">📊 导出</button>
                            <button id="test-history" class="btn-secondary btn-padding-8-16 border-radius-8 bg-gray border-none text-white cursor-pointer ml-8">🧪 测试</button>
                    </div>
                </div>
            </div>

            <!-- 历史趋势图表 -->
            <div class="history-chart-container glass-effect mb-20 p-20 border-radius-12">
                <h3 class="m-0-0-15-0 text-color font-size-18">📈 学习趋势分析</h3>
                <div class="position-relative h-300">
                    <canvas id="history-trend-chart"></canvas>
                </div>
            </div>

            <!-- 历史数据列表 -->
            <div class="history-data-container glass-effect p-20 border-radius-12">
                <div class="d-flex justify-content-space-between align-items-center mb-15">
                    <h3 class="m-0 text-color font-size-18">📋 历史记录详情</h3>
                    <div class="d-flex gap-10 align-items-center">
                        <span id="data-count" class="text-color-darker font-size-14">共 0 条记录</span>
                        <div class="d-flex gap-5">
                            <button id="prev-page" class="btn-secondary btn-padding-5-10 border-radius-6 bg-white-overlay border-glass text-color cursor-pointer">‹</button>
                            <span id="page-info" class="text-color font-size-14 btn-padding-5-10">1/1</span>
                            <button id="next-page" class="btn-secondary btn-padding-5-10 border-radius-6 bg-white-overlay border-glass text-color cursor-pointer">›</button>
                        </div>
                    </div>
                </div>
                
                <!-- 数据表格 -->
                <div class="history-table-wrapper overflow-x-auto">
                    <table id="history-data-table" class="w-full border-collapse">
                        <thead>
                            <tr class="bg-white-005 border-bottom-glass">
                                <th class="p-12 text-align-left text-color font-weight-600">日期</th>
                                <th class="p-12 text-align-left text-color font-weight-600">任务完成率</th>
                                <th class="p-12 text-align-left text-color font-weight-600">专注度</th>
                                <th class="p-12 text-align-left text-color font-weight-600">积极性</th>
                                <th class="p-12 text-align-left text-color font-weight-600">词汇打卡</th>
                                <th class="p-12 text-align-left text-color font-weight-600">操作</th>
                            </tr>
                        </thead>
                        <tbody id="history-table-body">
                            <!-- 动态生成的历史数据行 -->
                        </tbody>
                    </table>
                </div>
                
                <!-- 空状态 -->
                <div id="empty-state" class="empty-state d-none text-align-center p-40 text-darker">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-15 opacity-06"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                    <p class="m-0 font-size-16">暂无历史数据</p>
                    <p class="mt-5 font-size-14">开始您的学习之旅，记录每一天的进步！</p>
                </div>
            </div>
        </div>

        <!-- ======================= 真题在线页面 ======================= -->
        <div id="zhenti-view" class="view">
            <div class="zhenti-header glass-effect mb-20 p-20 border-radius-12">
                <div class="d-flex justify-content-space-between align-items-center">
                    <div>
                        <h2 class="m-0 mb-10 font-size-24 text-color">📝 真题在线</h2>
                        <p class="m-0 text-color-darker font-size-16">在线练习历年真题，提升应试能力</p>
                    </div>
                    <button 
                        id="open-zhenti-external" 
                        class="btn-padding-12-20 bg-accent text-white border-none border-radius-8 cursor-pointer font-size-14 d-flex align-items-center gap-8 transition-all"
                        onmouseover="this.style.background='var(--accent-hover)'"
                        onmouseout="this.style.background='var(--accent-color)'">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                            <polyline points="15,3 21,3 21,9"/>
                            <line x1="10" y1="14" x2="21" y2="3"/>
                        </svg>
                        新窗口打开
                    </button>
                </div>
            </div>
            
            <div class="zhenti-content glass-effect p-0 border-radius-12 h-calc-100vh-220px overflow-hidden position-relative">
                <div class="position-absolute top-10 right-10 z-index-10">
                    <button 
                        onclick="window.open('https://zhenti.burningvocabulary.cn/', '_blank')"
                        class="btn-padding-8-12 bg-black-07 text-white border-none border-radius-6 cursor-pointer font-size-12 d-flex align-items-center gap-6"
                        title="在新标签页中打开">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                            <polyline points="15,3 21,3 21,9"/>
                            <line x1="10" y1="14" x2="21" y2="3"/>
                        </svg>
                        新窗口
                    </button>
                </div>
                <iframe 
                    id="zhenti-iframe" 
                    src="https://zhenti.burningvocabulary.cn/" 
                    class="w-full h-full border-none border-radius-12"
                    frameborder="0"
                    allowfullscreen>
                </iframe>
            </div>
        </div>

        <!-- 【视图7】资源库 -->
        <div id="resource-view" class="view dashboard-grid">
            <div class="grid-item glass-effect grid-column-full">
                <h3 class="card-title">📚 学习资源库</h3>
                <p class="text-color-darker mb-30">精选优质学习资源，助力四六级备考</p>
            </div>

            <!-- 我是瑞思拜网课资源 -->
            <div class="grid-item glass-effect">
                <h3 class="card-title">🎓 我是瑞思拜网课资源</h3>
                <p class="text-color-darker mb-20">专业的四六级网课资源，系统化学习方案</p>
                
                <div class="resource-section">
                    <h4 class="text-accent mb-15 font-size-large">📖 四级资源</h4>
                    <div class="resource-item">
                        <div class="resource-info">
                            <h5>四级全套网课资源</h5>
                            <p>包含听力、阅读、写作、翻译全模块教学视频及配套资料</p>
                        </div>
                        <div class="resource-actions">
                            <a href="https://pan.baidu.com/s/1QqNWPPu7Wm7MxujZzmaGog?pwd=1111" target="_blank" class="btn btn-download">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7,10 12,15 17,10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                百度网盘下载
                            </a>
                        </div>
                    </div>
                </div>

                <div class="resource-section">
                    <h4 class="text-accent mb-15 font-size-large">📚 六级资源</h4>
                    <div class="resource-item">
                        <div class="resource-info">
                            <h5>六级全套网课资源</h5>
                            <p>包含听力、阅读、写作、翻译全模块教学视频及配套资料</p>
                        </div>
                        <div class="resource-actions">
                            <a href="https://pan.baidu.com/s/1INXa-HKcjfjKmSsBq8xVJA?pwd=1111" target="_blank" class="btn btn-download">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7,10 12,15 17,10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                百度网盘下载
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 更多资源卡片预留位置 -->
            <div class="grid-item glass-effect">
                <h3 class="card-title">🔄 更多资源</h3>
                <p class="text-darker text-align-center p-40-20">更多优质学习资源正在整理中...</p>
            </div>
        </div>

        <!-- 【视图8】闪记卡 -->
        <div id="flashcard-view" class="view">
            <div class="flashcard-container">
                <!-- 闪记卡头部 -->
                <div class="flashcard-header glass-effect">
                    <h2 class="flashcard-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                            <line x1="8" y1="21" x2="16" y2="21"/>
                            <line x1="12" y1="17" x2="12" y2="21"/>
                        </svg>
                        闪记卡学习
                    </h2>
                    <div class="flashcard-stats">
                        <div class="stat-item">
                            <span class="stat-label">今日学习</span>
                            <span class="stat-value" id="today-studied">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">总卡片</span>
                            <span class="stat-value" id="total-cards">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">掌握度</span>
                            <span class="stat-value" id="mastery-rate">0%</span>
                        </div>
                    </div>
                </div>

                <!-- 闪记卡主体区域 -->
                <div class="flashcard-main">
                    <!-- 左侧：卡片管理 -->
                    <div class="flashcard-sidebar glass-effect">
                        <div class="sidebar-header">
                            <h3>卡片管理</h3>
                            <div class="header-actions">
                                <button class="btn btn-primary" id="add-card-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="12" y1="5" x2="12" y2="19"/>
                                        <line x1="5" y1="12" x2="19" y2="12"/>
                                    </svg>
                                    新建卡片
                                </button>
                                <button class="btn btn-success" id="start-study-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polygon points="5,3 19,12 5,21"/>
                                    </svg>
                                    开始学习
                                </button>
                            </div>
                        </div>
                        
                        <div class="card-filters">
                            <select id="card-filter" class="filter-select">
                                <option value="all">全部卡片</option>
                                <option value="new">新卡片</option>
                                <option value="learning">学习中</option>
                                <option value="review">复习中</option>
                                <option value="mastered">已掌握</option>
                            </select>
                        </div>
                        
                        <div class="card-list" id="card-list">
                            <!-- 卡片列表将由JavaScript动态生成 -->
                        </div>
                    </div>

                    <!-- 右侧：学习区域 -->
                    <div class="flashcard-study-area">
                        <!-- 空状态（当无卡片时） -->
                        <div class="empty-state d-none" id="empty-state">
                            <div class="empty-content glass-effect">
                                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                                    <line x1="8" y1="21" x2="16" y2="21"/>
                                    <line x1="12" y1="17" x2="12" y2="21"/>
                                </svg>
                                <h3>开始创建你的第一张闪记卡</h3>
                                <p>点击左侧"新建卡片"按钮，创建你的学习卡片</p>
                                <button class="btn btn-primary" onclick="document.getElementById('add-card-btn').click()">
                                    立即创建
                                </button>
                            </div>
                        </div>

                        <!-- 卡片网格显示区域已移除，用户点击开始学习直接进入全屏模式 -->

                        <!-- 学习模式 -->
                        <div class="study-mode d-none" id="study-mode">
                            <!-- 进度条 -->
                            <div class="study-progress glass-effect">
                                <div class="progress-info">
                                    <span>学习进度</span>
                                    <span id="progress-text">0/0</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progress-fill"></div>
                                </div>
                            </div>

                            <!-- 3D卡片 -->
            <div class="card-3d-container" style="display: none !important;">
                <div class="flashcard-3d" id="flashcard-3d">
                    <div class="card-face card-front">
                        <div class="card-content" id="card-front-content">
                            <!-- 正面内容 -->
                        </div>
                    </div>
                    <div class="card-face card-back">
                        <div class="card-content" id="card-back-content">
                            <!-- 背面内容 -->
                        </div>
                    </div>
                </div>
            </div>

                            <!-- 控制按钮 -->
                            <div class="study-controls">
                                <button class="btn btn-secondary" id="flip-card-btn" style="display: none !important;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                        <path d="M3 3v5h5"/>
                        <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/>
                        <path d="M21 21v-5h-5"/>
                    </svg>
                    翻转卡片
                </button>
                                
                                <div class="difficulty-buttons d-none" id="difficulty-buttons">
                                    <button class="btn btn-difficulty btn-hard" data-difficulty="hard">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"/>
                                            <line x1="15" y1="9" x2="9" y2="15"/>
                                            <line x1="9" y1="9" x2="15" y2="15"/>
                                        </svg>
                                        困难
                                    </button>
                                    <button class="btn btn-difficulty btn-medium" data-difficulty="medium">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"/>
                                            <line x1="12" y1="8" x2="12" y2="12"/>
                                            <circle cx="12" cy="16" r="1"/>
                                        </svg>
                                        一般
                                    </button>
                                    <button class="btn btn-difficulty btn-easy" data-difficulty="easy">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"/>
                                            <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
                                            <line x1="9" y1="9" x2="9.01" y2="9"/>
                                            <line x1="15" y1="9" x2="15.01" y2="9"/>
                                        </svg>
                                        简单
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>



    <!-- ======================= PDF预览模态框 ======================= -->
    <div id="pdf-preview-modal" class="pdf-preview-modal">
        <div class="pdf-preview-content">
            <div class="pdf-preview-header">
                <h2 id="pdf-preview-title">PDF预览</h2>
                <button class="close-pdf-preview" onclick="closePdfPreview()">&times;</button>
            </div>
            <div class="pdf-preview-body">
                <iframe id="pdf-preview-iframe" src="" class="w-full h-full border-none"></iframe>
            </div>
        </div>
    </div>

    <!-- ======================= 【新增】学习反馈模态框 ======================= -->
    <div id="feedback-modal" class="feedback-modal">
        <div class="feedback-content">
            <div class="feedback-header">
                <h2>📝 每日学习反馈</h2>
                <button class="close-feedback">&times;</button>
            </div>

            <form id="feedback-form">
                <!-- 第1部分：任务完成情况 -->
                <div class="feedback-section">
                    <h3 data-section="1">今日任务完成情况</h3>
                    <div id="task-completion-area" class="task-completion-list">
                        <!-- 动态生成任务列表 -->
                    </div>
                </div>

                <!-- 第2部分：学习状态评估 -->
                <div class="feedback-section">
                    <h3 data-section="2">今日学习状态评估</h3>
                    <div class="slider-group">
                        <label class="slider-label">专注度 (Focus):</label>
                        <div class="slider-container">
                            <span>1</span>
                            <input type="range" id="focus-slider" class="slider" min="1" max="5" value="3">
                            <span>5</span>
                            <div class="slider-value" id="focus-value">3</div>
                        </div>
                    </div>
                    <div class="slider-group">
                        <label class="slider-label">积极性 (Motivation):</label>
                        <div class="slider-container">
                            <span>1</span>
                            <input type="range" id="motivation-slider" class="slider" min="1" max="5" value="3">
                            <span>5</span>
                            <div class="slider-value" id="motivation-value">3</div>
                        </div>
                    </div>
                </div>

                <!-- 第3部分：过程反思 -->
                <div class="feedback-section">
                    <h3 data-section="3">过程反思</h3>
                    <div class="textarea-group">
                        <label>今日亮点 (Highlight):</label>
                        <textarea id="highlight" placeholder="今天学习中，哪个环节让你最有成就感？哪怕只是一个小小的进步。"></textarea>
                    </div>
                    <div class="textarea-group">
                        <label>最大挑战 (Challenge):</label>
                        <textarea id="challenge" placeholder="今天遇到的最大困难是什么？它出现在哪个任务中？"></textarea>
                    </div>
                    <div class="radio-group">
                        <label>原因分析 (Why):</label>
                        <div class="radio-options">
                            <label class="radio-option">
                                <input type="radio" name="cause" value="vocabulary">
                                <span class="radio-custom"></span>
                                单词不认识
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="cause" value="grammar">
                                <span class="radio-custom"></span>
                                语法/长难句结构不清
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="cause" value="knowledge">
                                <span class="radio-custom"></span>
                                知识点没掌握
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="cause" value="attention">
                                <span class="radio-custom"></span>
                                注意力不集中/疲劳
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="cause" value="time">
                                <span class="radio-custom"></span>
                                时间紧张
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="cause" value="other">
                                <span class="radio-custom"></span>
                                其他：<input type="text" id="cause-other" placeholder="请描述..." class="ml-10 flex-1 bg-transparent border-none text-color outline-none">
                            </label>
                        </div>
                    </div>
                    <div class="textarea-group">
                        <label>明日对策 (Action):</label>
                        <textarea id="action" placeholder="针对这个困难，明天你可以做一个什么样的微小改进？"></textarea>
                    </div>
                </div>

                <!-- 第4部分：情绪管理 -->
                <div class="feedback-section">
                    <h3 data-section="4">情绪管理</h3>
                    <div class="radio-group">
                        <label>启动时刻: 今天是否有过"不想学"的念头？你是如何克服并开始的？</label>
                        <div class="radio-options">
                            <label class="radio-option">
                                <input type="radio" name="startup" value="good-state">
                                <span class="radio-custom"></span>
                                没有这种念头，状态很好
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="startup" value="15min-method">
                                <span class="radio-custom"></span>
                                运用了"先学15分钟"的方法
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="startup" value="switch-task">
                                <span class="radio-custom"></span>
                                换了一个自己喜欢的学习任务先开始
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="startup" value="rest-first">
                                <span class="radio-custom"></span>
                                休息了一会儿再开始
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="startup" value="not-started">
                                <span class="radio-custom"></span>
                                最终没有开始，需要警惕
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="startup" value="other">
                                <span class="radio-custom"></span>
                                其他：<input type="text" id="startup-other" placeholder="请描述..." class="ml-10 flex-1 bg-transparent border-none text-color outline-none">
                            </label>
                        </div>
                    </div>
                </div>

                <!-- 提交按钮 -->
                <button type="submit" class="feedback-submit">完成反馈</button>
            </form>
        </div>
    </div>
    
    <!-- ======================= 【新增】新建闪记卡模态框 ======================= -->
    <div id="flashcard-modal" class="flashcard-modal">
        <div class="flashcard-modal-content">
            <div class="flashcard-modal-header">
                <h2>📝 新建闪记卡</h2>
                <button class="close-flashcard-modal">&times;</button>
            </div>
            
            <form id="flashcard-form">
                <div class="form-group">
                    <label for="card-front">正面内容</label>
                    <textarea id="card-front" placeholder="输入卡片正面内容..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="card-back">背面内容</label>
                    <textarea id="card-back" placeholder="输入卡片背面内容..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="card-category">分类</label>
                    <select id="card-category">
                        <option value="vocabulary">词汇</option>
                        <option value="grammar">语法</option>
                        <option value="reading">阅读</option>
                        <option value="listening">听力</option>
                        <option value="writing">写作</option>
                        <option value="other">其他</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="card-difficulty">难度</label>
                    <select id="card-difficulty">
                        <option value="easy">简单</option>
                        <option value="medium">中等</option>
                        <option value="hard">困难</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>复习模式</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="review-mode" value="daily" checked>
                            <span class="radio-custom"></span>
                            每日复习
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="review-mode" value="scheduled">
                            <span class="radio-custom"></span>
                            指定日期
                        </label>
                    </div>
                </div>
                
                <div class="form-group d-none" id="schedule-date-group">
                    <label for="schedule-date">指定复习日期</label>
                    <input type="date" id="schedule-date">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-cancel">取消</button>
                    <button type="submit" class="btn-save">保存卡片</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 轻量图表库：Chart.js CDN（多备用源） -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js" onerror="loadChartJSFallback()"></script>
        <script>
            // Chart.js 备用加载方案
            function loadChartJSFallback() {
                console.warn('主CDN加载失败，尝试备用CDN');
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js';
                script.onerror = function() {
                    console.error('Chart.js加载失败，图表功能将使用降级显示');
                };
                document.head.appendChild(script);
            }
            
            // 检测Chart.js是否加载成功
            window.addEventListener('load', function() {
                setTimeout(function() {
                    if (typeof Chart === 'undefined') {
                        console.warn('Chart.js未成功加载，图表将使用降级显示');
                    } else {
                        console.log('Chart.js加载成功');
                    }
                }, 1000);
            });
        </script>
    <!-- Excel导出库：SheetJS CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Excel导出器和集成测试文件已移除 -->
    <script>
        // ======================= 词汇编辑模态框功能（已移除） =======================
        // 提示：原 openVocabEditModal/closeVocabEditModal/saveVocabEdit 以及相关状态已删除

        function editNickname() {
            const current = localStorage.getItem('nickname') || '备考小能手';
            const name = prompt('请输入你的昵称：', current);
            if (name !== null) {
                const trimmed = name.trim();
                if (trimmed.length === 0) return; // 空值不处理
                localStorage.setItem('nickname', trimmed);
                // 同步更新侧边栏昵称
                const el = document.getElementById('nickname-display');
                if (el) el.textContent = trimmed;
                // 同步更新顶部问候
                const greetEl = document.getElementById('greet-name');
                if (greetEl) greetEl.textContent = trimmed;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {

            // 初始化昵称（侧边栏与顶部问候）
            const nicknameEl = document.getElementById('nickname-display');
            const greetNameEl = document.getElementById('greet-name');
            const savedNickname = localStorage.getItem('nickname') || '备考小能手';
            if (nicknameEl) nicknameEl.textContent = savedNickname;
            if (greetNameEl) greetNameEl.textContent = savedNickname;

            // --- 移动端侧栏控制 ---
            const hamburgerMenu = document.getElementById('hamburger-menu');
            const sidebar = document.querySelector('.sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');

            // 切换侧栏显示状态
            function toggleSidebar() {
                const isOpen = sidebar.classList.contains('open');
                if (isOpen) {
                    closeSidebar();
                } else {
                    openSidebar();
                }
            }

            // 打开侧栏
            function openSidebar() {
                sidebar.classList.add('open');
                sidebarOverlay.classList.add('active');
                hamburgerMenu.classList.add('active');
                document.querySelector('.main-content').classList.add('sidebar-open');
                document.body.style.overflow = 'hidden'; // 防止背景滚动
            }

            // 关闭侧栏
            function closeSidebar() {
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('active');
                hamburgerMenu.classList.remove('active');
                document.querySelector('.main-content').classList.remove('sidebar-open');
                document.body.style.overflow = ''; // 恢复滚动
            }

            // 汉堡菜单点击事件
            if (hamburgerMenu) {
                hamburgerMenu.addEventListener('click', toggleSidebar);
            }

            // 遮罩层点击关闭侧栏
            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', closeSidebar);
            }

            // 侧栏导航点击后自动关闭（移动端）
            const navLinks = document.querySelectorAll('.sidebar .nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 992) {
                        closeSidebar();
                    }
                });
            });

            // 窗口大小改变时处理侧栏状态
            window.addEventListener('resize', () => {
                if (window.innerWidth > 992) {
                    closeSidebar(); // 大屏幕时确保侧栏状态正常
                }
            });

            // --- 模块4: 词汇打卡表（双轮复习）---
            const checkinTbody = document.getElementById('checkin-tbody');
            const weekInfo = document.getElementById('week-info');
            const checkinPrevWeekBtn = document.getElementById('prev-week');
            const checkinNextWeekBtn = document.getElementById('next-week');

            const statTotal = document.getElementById('stat-total');
            const statReview = document.getElementById('stat-review');
            const statLearn = document.getElementById('stat-learn');
            const statDays = document.getElementById('stat-days');

            const DAY_LABELS = ['周一','周二','周三','周四','周五','周六','周日'];
            const SLOT_LABELS = ['上午','晚上'];
            const ACTIONS = ['review','learn']; // 复习/学习



            // 数据结构：按周索引存储（相对第1周），每周7天，每天2个时段，每个时段2个动作
            // 形如：data[weekIndex][dayIndex][slotIndex][action]
            let checkinData = JSON.parse(localStorage.getItem('checkinData')) || {};
            let currentWeek = parseInt(localStorage.getItem('currentWeek')) || 1;

            function getWeekKey(week) { return `week_${week}`; }

            function ensureWeek(week) {
                const key = getWeekKey(week);
                if (!checkinData[key]) {
                    checkinData[key] = Array.from({length:7}, () => (
                        Array.from({length:2}, () => ({ review: false, learn: false }))
                    ));
                }
            }

            // 获取当前日期的月份第几周
            function getWeekOfMonth(week) {
                const now = new Date();
                const currentYear = now.getFullYear();
                const currentMonth = now.getMonth();
                
                // 获取当月第一天
                const firstDay = new Date(currentYear, currentMonth, 1);
                // 获取当月第一天是星期几（0=周日，1=周一...）
                const firstDayOfWeek = firstDay.getDay() === 0 ? 7 : firstDay.getDay(); // 转换为周一=1的格式
                
                // 计算第一周的偏移
                const offset = firstDayOfWeek - 1;
                
                // 计算目标周的开始日期
                const targetDate = new Date(firstDay);
                targetDate.setDate(1 + (week - 1) * 7 - offset);
                
                const targetMonth = targetDate.getMonth() + 1; // 月份从0开始，所以+1
                const targetYear = targetDate.getFullYear();
                
                // 如果跨月了，显示对应月份
                if (targetMonth !== currentMonth + 1 || targetYear !== currentYear) {
                    return `${targetYear}年${targetMonth}月第${Math.ceil((targetDate.getDate() + offset) / 7)}周`;
                } else {
                    return `${currentMonth + 1}月第${week}周`;
                }
            }

            function renderWeek(week) {
                ensureWeek(week);
                const weekKey = getWeekKey(week);
                const weekArr = checkinData[weekKey];
                checkinTbody.innerHTML = '';
                weekInfo.textContent = getWeekOfMonth(week);

                weekArr.forEach((day, dayIdx) => {
                    const tr = document.createElement('tr');
                    const dateTd = document.createElement('td');
                    dateTd.className = 'day-header';
                    dateTd.textContent = DAY_LABELS[dayIdx];
                    tr.appendChild(dateTd);

                    // 上午/晚上两列
                    SLOT_LABELS.forEach((slotLabel, slotIdx) => {
                        const td = document.createElement('td');
                        const slotData = day[slotIdx];
                        const container = document.createElement('div');
                        container.className = 'time-slot';

                        const timeLabel = document.createElement('div');
                        timeLabel.className = 'time-label';
                        timeLabel.textContent = slotLabel;

                        const actions = document.createElement('div');
                        actions.className = 'checkin-actions';

                        // 两个按钮：复习/学习
                        ACTIONS.forEach(action => {
                            const btn = document.createElement('button');
                            btn.className = `checkin-btn ${action} ${slotData[action] ? 'completed' : ''}`;
                            btn.textContent = (action === 'review' ? '复习' : '学习');
                            btn.title = '点击打卡';
                            
                            // 单击打卡
                            btn.addEventListener('click', () => {
                                slotData[action] = !slotData[action];
                                saveData();
                                renderWeek(currentWeek);
                            });
                            
                            actions.appendChild(btn);
                        });
                        
                        // 编辑功能已移除（原：铅笔编辑按钮）

                        container.appendChild(timeLabel);
                        container.appendChild(actions);

                        // 展示内容区域
                        const contentDiv = document.createElement('div');
                        contentDiv.style.marginTop = '8px';
                        contentDiv.style.fontSize = '12px';
                        contentDiv.style.color = 'var(--text-color-darker)';
                        const r = slotData.reviewText ? `复习：${slotData.reviewText}` : '';
                        const l = slotData.learnText ? `学习：${slotData.learnText}` : '';
                        contentDiv.textContent = [r, l].filter(Boolean).join(' ｜ ');
                        container.appendChild(contentDiv);

                        td.appendChild(container);
                        tr.appendChild(td);
                    });
                    checkinTbody.appendChild(tr);
                });

                updateStats();
            }

            function updateStats() {
                const weekKey = getWeekKey(currentWeek);
                const weekArr = checkinData[weekKey];
                let total = 0, review = 0, learn = 0, daysReached = 0;

                const reviewDaily = Array(7).fill(0);
                const learnDaily = Array(7).fill(0);

                weekArr.forEach((day, dIdx) => {
                    let dayCount = 0;
                    day.forEach(slot => {
                        if (slot.review) { review++; total++; dayCount++; }
                        if (slot.learn)  { learn++;  total++; dayCount++; }
                    });
                    if (dayCount >= 2) { daysReached++; }

                    // 每日统计：上午、晚上最多各1次，因此复习/学习的每日计数在0-2之间
                    reviewDaily[dIdx] = day.filter(s => s.review).length;
                    learnDaily[dIdx]  = day.filter(s => s.learn).length;
                });

                statTotal.textContent = total;
                statReview.textContent = review;
                statLearn.textContent = learn;
                statDays.textContent = `${daysReached}/7`;

                // 绘制/更新折线图（增强移动端兼容性）
                const ctx = document.getElementById('checkin-chart');
                if (ctx && typeof Chart !== 'undefined') {
                    try {
                        if (!window._checkinLineChart) {
                            window._checkinLineChart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: DAY_LABELS,
                                datasets: [
                                    {
                                        label: '复习',
                                        data: reviewDaily,
                                        borderColor: getComputedStyle(document.documentElement).getPropertyValue('--review-color').trim(),
                                        backgroundColor: 'rgba(255, 193, 7, 0.15)',
                                        tension: 0.35,
                                        fill: true,
                                        pointRadius: 3,
                                        pointHoverRadius: 5
                                    },
                                    {
                                        label: '学习',
                                        data: learnDaily,
                                        borderColor: getComputedStyle(document.documentElement).getPropertyValue('--learn-color').trim(),
                                        backgroundColor: 'rgba(33, 150, 243, 0.15)',
                                        tension: 0.35,
                                        fill: true,
                                        pointRadius: 3,
                                        pointHoverRadius: 5
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { 
                                        labels: { 
                                            color: getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim() || '#e0e6f1',
                                            font: { size: 20 }
                                        } 
                                    }
                                },
                                scales: {
                                    x: { 
                                        ticks: { 
                                            color: getComputedStyle(document.documentElement).getPropertyValue('--text-color-darker').trim() || '#a5afc6',
                                            font: { size: 20 }
                                        }, 
                                        grid: { color: 'rgba(255,255,255,0.06)' }
                                    },
                                    y: { 
                                        beginAtZero: true, 
                                        suggestedMax: 2, 
                                        ticks: { 
                                            stepSize: 1, 
                                            color: getComputedStyle(document.documentElement).getPropertyValue('--text-color-darker').trim() || '#a5afc6',
                                            font: { size: 20 }
                                        }, 
                                        grid: { color: 'rgba(255,255,255,0.06)' }
                                    }
                                }
                            }
                        });
                        } else {
                            window._checkinLineChart.data.datasets[0].data = reviewDaily;
                            window._checkinLineChart.data.datasets[1].data = learnDaily;
                            window._checkinLineChart.update();
                        }
                    } catch (error) {
                        console.error('词汇打卡表图表渲染错误:', error);
                        // 降级处理：显示文本统计
                        const fallbackText = document.createElement('div');
                        fallbackText.innerHTML = `
                            <div class="text-align-center p-20 text-color">
                                <p>📊 本周统计</p>
                                <p>复习: ${reviewDaily.join(', ')}</p>
                                <p>学习: ${learnDaily.join(', ')}</p>
                            </div>
                        `;
                        ctx.parentNode.replaceChild(fallbackText, ctx);
                    }
                } else {
                    console.warn('Chart.js未加载或canvas元素未找到');
                }
            }

            function saveData() {
                localStorage.setItem('checkinData', JSON.stringify(checkinData));
                localStorage.setItem('currentWeek', currentWeek);
            }

            checkinPrevWeekBtn.addEventListener('click', () => { if (currentWeek > 1) { currentWeek--; saveData(); renderWeek(currentWeek); } });
            checkinNextWeekBtn.addEventListener('click', () => { currentWeek++; saveData(); renderWeek(currentWeek); });

            // 初始渲染（保持其他模块之后执行）
            renderWeek(currentWeek);


            // --- 模块6: 历史回顾功能 ---
            let historyDataManager = null;
            let currentHistoryPage = 1;
            const historyPageSize = 10;
            let currentDateRange = '30';
            let currentDataType = 'all';
            let historyTrendChart = null;

            // 初始化历史回顾功能
            async function initHistoryView() {
                try {
                    // 动态导入历史数据管理器
                    const { HistoryDataManager } = await import('js/utils/HistoryDataManager.js');
                    historyDataManager = new HistoryDataManager();
                    
                    // 加载统计数据
                    await loadHistoryStats();
                    
                    // 加载趋势图表
                    await loadHistoryChart();
                    
                    // 加载历史数据列表
                    await loadHistoryData();
                    
                } catch (error) {
                    console.error('初始化历史回顾功能失败:', error);
                    showHistoryError('初始化失败，请刷新页面重试');
                }
            }

            // 加载统计数据
            async function loadHistoryStats() {
                try {
                    const stats = await historyDataManager.getStatistics();
                    
                    document.getElementById('total-days').textContent = stats.overview.totalDays || 0;
                    document.getElementById('avg-completion').textContent = `${Math.round(stats.overview.avgTaskCompletion || 0)}%`;
                    document.getElementById('streak-days').textContent = stats.patterns.longestStreak || 0;
                    document.getElementById('avg-focus').textContent = Math.round(stats.overview.avgFocus || 0);
                    
                } catch (error) {
                    console.error('加载统计数据失败:', error);
                }
            }

            // 加载趋势图表
            async function loadHistoryChart() {
                try {
                    const endDate = new Date();
                    const startDate = new Date();
                    
                    if (currentDateRange === 'all') {
                        startDate.setFullYear(startDate.getFullYear() - 1); // 最多显示1年
                    } else {
                        startDate.setDate(startDate.getDate() - parseInt(currentDateRange));
                    }
                    
                    const dateRange = await historyDataManager.getDateRangeData(
                        startDate.toISOString().split('T')[0],
                        endDate.toISOString().split('T')[0],
                        { fillGaps: true }
                    );
                    
                    renderHistoryChart(dateRange);
                    
                } catch (error) {
                    console.error('加载趋势图表失败:', error);
                }
            }

            // 渲染历史趋势图表（增强移动端兼容性）
            function renderHistoryChart(data) {
                const ctx = document.getElementById('history-trend-chart');
                if (!ctx) return;
                
                if (typeof Chart === 'undefined') {
                    console.warn('Chart.js未加载，使用降级显示');
                    // 降级处理：显示文本统计
                    const fallbackText = document.createElement('div');
                    fallbackText.innerHTML = `
                        <div class="text-align-center p-20 text-color">
                            <p>📈 学习趋势分析</p>
                            <p>最近${data.length}天数据已记录</p>
                            <p>平均任务完成率: ${Math.round(data.reduce((sum, item) => sum + (item.taskCompletion || 0), 0) / data.length)}%</p>
                        </div>
                    `;
                    ctx.parentNode.replaceChild(fallbackText, ctx);
                    return;
                }
                
                try {
                    const labels = data.map(item => {
                        const date = new Date(item.date);
                        return `${date.getMonth() + 1}/${date.getDate()}`;
                    });
                    
                    const taskCompletionData = data.map(item => item.taskCompletion || 0);
                    const focusData = data.map(item => item.focus || 0);
                    const motivationData = data.map(item => item.motivation || 0);
                    
                    if (historyTrendChart) {
                        historyTrendChart.destroy();
                    }
                    
                    historyTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: '任务完成率 (%)',
                                data: taskCompletionData,
                                borderColor: getComputedStyle(document.documentElement).getPropertyValue('--accent-color').trim(),
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.4,
                                fill: true,
                                pointRadius: 3,
                                pointHoverRadius: 6
                            },
                            {
                                label: '专注度',
                                data: focusData,
                                borderColor: getComputedStyle(document.documentElement).getPropertyValue('--success-color').trim(),
                                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                tension: 0.4,
                                fill: false,
                                pointRadius: 3,
                                pointHoverRadius: 6
                            },
                            {
                                label: '积极性',
                                data: motivationData,
                                borderColor: getComputedStyle(document.documentElement).getPropertyValue('--warning-color').trim(),
                                backgroundColor: 'rgba(251, 191, 36, 0.1)',
                                tension: 0.4,
                                fill: false,
                                pointRadius: 3,
                                pointHoverRadius: 6
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim(),
                                    font: { size: 12 }
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderColor: 'rgba(255, 255, 255, 0.2)',
                                borderWidth: 1
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-color-darker').trim(),
                                    font: { size: 11 }
                                },
                                grid: { color: 'rgba(255,255,255,0.06)' }
                            },
                            y: {
                                beginAtZero: true,
                                suggestedMax: 100,
                                ticks: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-color-darker').trim(),
                                    font: { size: 11 }
                                },
                                grid: { color: 'rgba(255,255,255,0.06)' }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        },
                        onClick: (event, elements) => {
                            if (elements.length > 0) {
                                const elementIndex = elements[0].index;
                                const clickedDate = data[elementIndex]?.date;
                                if (clickedDate) {
                                    window.viewHistoryDetail(clickedDate);
                                }
                            }
                        },
                        onHover: (event, elements) => {
                            event.native.target.style.cursor = elements.length > 0 ? 'pointer' : 'default';
                        }
                    }
                });
                } catch (error) {
                    console.error('历史趋势图表渲染错误:', error);
                    // 降级处理：显示文本统计
                    const fallbackText = document.createElement('div');
                    fallbackText.innerHTML = `
                        <div class="text-align-center p-20 text-color">
                            <p>📈 学习趋势分析</p>
                            <p>最近${data.length}天数据已记录</p>
                            <p>图表加载失败，请刷新页面重试</p>
                        </div>
                    `;
                    ctx.parentNode.replaceChild(fallbackText, ctx);
                }
            }

            // 加载历史数据列表
            async function loadHistoryData() {
                try {
                    const options = {
                        page: currentHistoryPage,
                        pageSize: historyPageSize,
                        sortBy: 'date',
                        sortOrder: 'desc'
                    };
                    
                    if (currentDateRange !== 'all') {
                        const endDate = new Date();
                        const startDate = new Date();
                        startDate.setDate(startDate.getDate() - parseInt(currentDateRange));
                        
                        options.startDate = startDate.toISOString().split('T')[0];
                        options.endDate = endDate.toISOString().split('T')[0];
                    }
                    
                    const result = await historyDataManager.getSnapshotList(options);
                    
                    renderHistoryTable(result.snapshots);
                    updateHistoryPagination(result.pagination);
                    
                } catch (error) {
                    console.error('加载历史数据失败:', error);
                    showHistoryError('加载数据失败');
                }
            }

            // 渲染历史数据表格
            function renderHistoryTable(snapshots) {
                const tbody = document.getElementById('history-table-body');
                const emptyState = document.getElementById('empty-state');
                const table = document.getElementById('history-data-table');
                
                if (!snapshots || snapshots.length === 0) {
                    table.style.display = 'none';
                    emptyState.style.display = 'block';
                    return;
                }
                
                table.style.display = 'table';
                emptyState.style.display = 'none';
                
                tbody.innerHTML = '';
                
                snapshots.forEach(snapshot => {
                    const row = document.createElement('tr');
                    row.style.borderBottom = '1px solid var(--glass-border)';
                    row.style.transition = 'background-color 0.2s ease';
                    
                    // 格式化日期
                    const date = new Date(snapshot.date);
                    const formattedDate = `${date.getMonth() + 1}/${date.getDate()}`;
                    
                    // 任务完成率
                    const taskCompletion = snapshot.taskCompletion || 0;
                    const taskCompletionColor = taskCompletion >= 80 ? 'var(--success-color)' : 
                                               taskCompletion >= 60 ? 'var(--warning-color)' : 'var(--error-color)';
                    
                    // 专注度和积极性
                    const focus = snapshot.focus || 0;
                    const motivation = snapshot.motivation || 0;
                    
                    // 词汇打卡统计
                    const checkinStats = snapshot.checkinStats || { total: 0, review: 0, learn: 0 };
                    const checkinText = `${checkinStats.total}次 (复习${checkinStats.review}/学习${checkinStats.learn})`;
                    
                    row.innerHTML = `
                        <td class="p-12 text-color">${formattedDate}</td>
                        <td class="p-12">
                            <span style="color: ${taskCompletionColor}; font-weight: 600;">${taskCompletion}%</span>
                        </td>
                        <td class="p-12 text-color">${focus}/5</td>
                        <td class="p-12 text-color">${motivation}/5</td>
                        <td class="p-12 text-color-darker font-size-13">${checkinText}</td>
                        <td class="p-12">
                            <button onclick="viewHistoryDetail('${snapshot.date}')" 
                                    style="padding: 4px 8px; border-radius: 4px; background: rgba(255,255,255,0.1); 
                                           border: 1px solid var(--glass-border); color: var(--text-color); 
                                           cursor: pointer; font-size: 12px;">详情</button>
                        </td>
                    `;
                    
                    // 悬停效果
                    row.addEventListener('mouseenter', () => {
                        row.style.backgroundColor = 'rgba(255,255,255,0.05)';
                    });
                    
                    row.addEventListener('mouseleave', () => {
                        row.style.backgroundColor = 'transparent';
                    });
                    
                    tbody.appendChild(row);
                });
            }

            // 更新分页信息
            function updateHistoryPagination(pagination) {
                document.getElementById('data-count').textContent = `共 ${pagination.total} 条记录`;
                document.getElementById('page-info').textContent = `${pagination.currentPage}/${pagination.totalPages}`;
                
                const prevBtn = document.getElementById('prev-page');
                const nextBtn = document.getElementById('next-page');
                
                prevBtn.disabled = pagination.currentPage <= 1;
                nextBtn.disabled = pagination.currentPage >= pagination.totalPages;
                
                prevBtn.style.opacity = prevBtn.disabled ? '0.5' : '1';
                nextBtn.style.opacity = nextBtn.disabled ? '0.5' : '1';
            }

            // 查看历史详情
            window.viewHistoryDetail = async function(date) {
                try {
                    const snapshot = await historyDataManager.getSnapshot(date);
                    if (snapshot) {
                        showHistoryDetailModal(snapshot);
                    } else {
                        alert('未找到该日期的学习记录');
                    }
                } catch (error) {
                    console.error('获取历史详情失败:', error);
                    alert('获取详情失败，请重试');
                }
            };
            
            // 为全局访问提供别名
            window.viewHistoryDetailFromChart = window.viewHistoryDetail;

            // 显示历史详情模态框
            function showHistoryDetailModal(snapshot) {
                // 创建模态框HTML
                const modalHtml = `
                    <div id="history-detail-modal" class="modal d-flex z-1001">
                        <div class="modal-content w-min-600-90vw max-h-80vh overflow-auto">
                            <div class="modal-header">
                                <h3>📅 ${snapshot.date} 学习详情</h3>
                                <button onclick="closeHistoryDetailModal()">&times;</button>
                            </div>
                            <div class="modal-body p-20">
                                <div class="d-grid grid-cols-2 gap-30 mb-20">
                                    <div class="detail-card p-15 bg-white-05 border-radius-8">
                                        <h4 class="m-0 mb-10 text-accent">📋 任务完成情况</h4>
                                        <p class="my-5 text-color">完成率: <strong>${snapshot.taskCompletion || 0}%</strong></p>
                                        <p class="my-5 text-color-darker font-size-14">总任务: ${snapshot.tasks?.length || 0} 个</p>
                                        <p class="my-5 text-color-darker font-size-14">已完成: ${snapshot.tasks?.filter(t => t.completed).length || 0} 个</p>
                                    </div>
                                    <div class="detail-card p-15 bg-white-05 border-radius-8">
                                        <h4 class="m-0 mb-10 text-success">🎯 学习状态</h4>
                                        <p class="my-5 text-color">专注度: <strong>${snapshot.focus || 0}/5</strong></p>
                                        <p class="my-5 text-color">积极性: <strong>${snapshot.motivation || 0}/5</strong></p>
                                    </div>
                                </div>
                                
                                ${snapshot.tasks && snapshot.tasks.length > 0 ? `
                                    <div class="mb-20">
                                        <h4 class="m-0 mb-10 text-color">📝 任务列表</h4>
                                        <div class="max-h-200 overflow-y-auto">
                                            ${snapshot.tasks.map(task => `
                                                <div style="display: flex; align-items: center; gap: 10px; padding: 8px; 
                                                           background: rgba(0,0,0,0.2); border-radius: 6px; margin-bottom: 5px;">
                                                    <span style="color: ${task.completed ? 'var(--success-color)' : 'var(--text-color-darker)'}; font-size: 16px;">
                                                        ${task.completed ? '✅' : '⭕'}
                                                    </span>
                                                    <span style="color: var(--text-color); font-size: 14px; flex: 1;">${task.text}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                ${snapshot.checkinStats ? `
                                    <div>
                                        <h4 class="m-0 mb-10 text-warning">📚 词汇打卡</h4>
                                        <p class="my-5 text-color">总打卡: <strong>${snapshot.checkinStats.total || 0}</strong> 次</p>
                                        <p class="my-5 text-color">复习: <strong>${snapshot.checkinStats.review || 0}</strong> 次</p>
                                        <p class="my-5 text-color">学习: <strong>${snapshot.checkinStats.learn || 0}</strong> 次</p>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
                
                // 添加到页面
                document.body.insertAdjacentHTML('beforeend', modalHtml);
            }

            // 关闭历史详情模态框
            window.closeHistoryDetailModal = function() {
                const modal = document.getElementById('history-detail-modal');
                if (modal) {
                    modal.remove();
                }
            };
            


            // 显示错误信息
            function showHistoryError(message) {
                const emptyState = document.getElementById('empty-state');
                if (emptyState) {
                    emptyState.style.display = 'block';
                    emptyState.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-15 opacity-06 text-error"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                        <p class="m-0 font-size-16 text-error">${message}</p>
                        <button onclick="location.reload()" class="mt-10 p-8-16 border-radius-6 bg-accent border-none text-white cursor-pointer">重新加载</button>
                    `;
                }
            }

            // 历史回顾事件监听器
            document.addEventListener('DOMContentLoaded', () => {
                // 日期范围选择
                const dateRangeSelect = document.getElementById('date-range-select');
                if (dateRangeSelect) {
                    dateRangeSelect.addEventListener('change', async (e) => {
                        currentDateRange = e.target.value;
                        currentHistoryPage = 1;
                        await loadHistoryChart();
                        await loadHistoryData();
                        await loadHistoryStats();
                    });
                }
                
                // 数据类型选择
                const dataTypeSelect = document.getElementById('data-type-select');
                if (dataTypeSelect) {
                    dataTypeSelect.addEventListener('change', async (e) => {
                        currentDataType = e.target.value;
                        currentHistoryPage = 1;
                        await loadHistoryData();
                    });
                }
                
                // 刷新按钮
                const refreshBtn = document.getElementById('refresh-history');
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', async () => {
                        refreshBtn.textContent = '🔄 刷新中...';
                        refreshBtn.disabled = true;
                        
                        try {
                            await loadHistoryStats();
                            await loadHistoryChart();
                            await loadHistoryData();
                        } finally {
                            refreshBtn.textContent = '🔄 刷新';
                            refreshBtn.disabled = false;
                        }
                    });
                }
                
                // 导出按钮
                const exportBtn = document.getElementById('export-history');
                if (exportBtn) {
                    exportBtn.addEventListener('click', async () => {
                        try {
                            exportBtn.textContent = '📊 导出中...';
                            exportBtn.disabled = true;
                            
                            // 获取当前筛选条件
                            const startDate = document.getElementById('start-date')?.value;
                            const endDate = document.getElementById('end-date')?.value;
                            
                            // 检查是否支持Excel导出
                            const supportedFormats = historyDataManager.getSupportedExportFormats();
                            const hasExcel = supportedFormats.some(f => f.value === 'excel');
                            
                            let format = 'json'; // 默认格式
                            
                            // 如果支持Excel，询问用户选择格式
                            if (hasExcel) {
                                const choice = confirm('选择导出格式：\n确定 = Excel格式（推荐）\n取消 = JSON格式');
                                format = choice ? 'excel' : 'json';
                            }
                            
                            const exportOptions = {
                                format: format,
                                startDate: startDate,
                                endDate: endDate,
                                includeSummary: format === 'excel' // Excel格式包含摘要
                            };
                            
                            const result = await historyDataManager.exportData(exportOptions);
                            
                            if (result.success) {
                                if (format === 'excel') {
                                    // Excel导出由ExcelExporter直接处理下载
                                    alert(`✅ ${result.message}`);
                                } else {
                                    // JSON/CSV格式需要手动创建下载
                                    const blob = new Blob([result.data], { type: result.mimeType });
                                    const url = URL.createObjectURL(blob);
                                    const a = document.createElement('a');
                                    a.href = url;
                                    a.download = result.filename;
                                    document.body.appendChild(a);
                                    a.click();
                                    document.body.removeChild(a);
                                    URL.revokeObjectURL(url);
                                    
                                    alert(`✅ 成功导出 ${result.recordCount} 条记录`);
                                }
                            } else {
                                throw new Error(result.error || '导出失败');
                            }
                            
                        } catch (error) {
                            console.error('导出失败:', error);
                            alert(`❌ 导出失败: ${error.message}`);
                        } finally {
                            exportBtn.textContent = '📊 导出';
                            exportBtn.disabled = false;
                        }
                    });
                }
                
                // 测试按钮
                const testBtn = document.getElementById('test-history');
                if (testBtn) {
                    testBtn.addEventListener('click', async () => {
                        try {
                            testBtn.textContent = '🧪 测试中...';
                            testBtn.disabled = true;
                            
                            // 创建并运行集成测试
                            if (typeof HistoryIntegrationTest !== 'undefined') {
                                const test = new HistoryIntegrationTest();
                                const result = await test.runAllTests();
                                
                                // 显示测试结果摘要
                                const message = `🧪 集成测试完成\n\n` +
                                    `📊 总测试数: ${result.total}\n` +
                                    `✅ 通过: ${result.passed}\n` +
                                    `❌ 失败: ${result.failed}\n` +
                                    `📈 通过率: ${result.passRate}%\n\n` +
                                    `详细结果请查看浏览器控制台`;
                                
                                alert(message);
                            } else {
                                alert('❌ 测试模块未加载');
                            }
                            
                        } catch (error) {
                            console.error('测试执行失败:', error);
                            alert(`❌ 测试执行失败: ${error.message}`);
                        } finally {
                            testBtn.textContent = '🧪 测试';
                            testBtn.disabled = false;
                        }
                    });
                }
                
                // 分页按钮
                const prevBtn = document.getElementById('prev-page');
                const nextBtn = document.getElementById('next-page');
                
                if (prevBtn) {
                    prevBtn.addEventListener('click', async () => {
                        if (currentHistoryPage > 1) {
                            currentHistoryPage--;
                            await loadHistoryData();
                        }
                    });
                }
                
                if (nextBtn) {
                    nextBtn.addEventListener('click', async () => {
                        currentHistoryPage++;
                        await loadHistoryData();
                    });
                }
            });


            // --- 模块1: 页面/视图切换 ---
            const viewNavLinks = document.querySelectorAll('.nav-link');
            const views = document.querySelectorAll('.view');
            
            viewNavLinks.forEach(link => {
                link.addEventListener('click', async () => {
                    // 激活侧边栏样式
                    viewNavLinks.forEach(nav => nav.classList.remove('active'));
                    link.classList.add('active');
                    
                    // 显示对应的视图
                    const targetViewId = link.getAttribute('data-view');
                    views.forEach(view => {
                        view.classList.remove('active', 'active-grid');
                        if (view.id === targetViewId) {
                            if (view.classList.contains('dashboard-grid')) {
                                view.classList.add('active-grid');
                            } else {
                                view.classList.add('active');
                            }
                        }
                    });
                    
                    // 特殊处理历史回顾视图
                    if (targetViewId === 'history-view') {
                        if (!historyDataManager) {
                            await initHistoryView();
                        } else {
                            // 如果已经初始化，刷新数据
                            await loadHistoryStats();
                            await loadHistoryChart();
                            await loadHistoryData();
                        }
                    }
                    
                    // 特殊处理闪记卡视图
                    if (targetViewId === 'flashcard-view') {
                        // 延迟初始化，确保 DOM 元素已经存在
                        setTimeout(() => {
                            if (!flashcardManager) {
                                flashcardManager = new FlashcardManager();
                            } else {
                                // 如果已经初始化，刷新数据
                                flashcardManager.updateStats();
                                flashcardManager.renderCardList();
                            }
                        }, 100);
                    }
                    
                    // 特殊处理考试时间轴视图
                    if (targetViewId === 'timeline-view') {
                        // 延迟初始化，确保 DOM 元素已经存在
                        setTimeout(() => {
                            // 初始化周计划数据
                            updateWeeklyPlan();
                            renderWeeklyPlan();
                        }, 100);
                    }
                });
            });

            // --- 真题在线按钮事件监听器 ---
            const openZhentiBtn = document.getElementById('open-zhenti-external');
            if (openZhentiBtn) {
                openZhentiBtn.addEventListener('click', () => {
                    window.open('https://zhenti.burningvocabulary.cn/', '_blank');
                });
            }

            // --- 听力训练按钮事件监听器 ---
            const openListeningBtn = document.getElementById('open-listening-external');
            if (openListeningBtn) {
                openListeningBtn.addEventListener('click', () => {
                    window.open('https://www.21voa.com/special_english/', '_blank');
                });
            }

            // --- 写作训练按钮事件监听器 ---
            const openWritingBtn = document.getElementById('open-writing-external');
            if (openWritingBtn) {
                openWritingBtn.addEventListener('click', () => {
                    window.open('https://www.pigai.org/', '_blank');
                });
            }

            // --- 模块2: 可编辑的今日任务 ---
            const taskForm = document.getElementById('add-task-form');
            const taskInput = document.getElementById('new-task-input');
            const taskListUl = document.getElementById('task-list-ul');
            
            // 从本地存储加载任务
            let tasks = [];
            try {
                const storedTasks = localStorage.getItem('tasks');
                console.log('从localStorage读取的原始数据:', storedTasks);
                tasks = JSON.parse(storedTasks) || [];
                console.log('解析后的tasks数组:', tasks);
            } catch (e) {
                console.log('localStorage读取失败:', e);
                tasks = [];
            }
            
            // 保存任务到本地存储
            function saveTasks() {
                try {
                    console.log('保存tasks到localStorage:', tasks);
                    localStorage.setItem('tasks', JSON.stringify(tasks));
                    console.log('保存成功');
                } catch (e) {
                    console.error('保存失败:', e);
                }
            }
            
            // 渲染任务列表
            function renderTasks() {
                console.log('renderTasks 被调用，tasks数组:', tasks);
                console.log('taskListUl元素:', taskListUl);
                
                if (!taskListUl) {
                    console.error('taskListUl元素不存在！');
                    return;
                }
                
                taskListUl.innerHTML = '';
                
                if (tasks.length === 0) {
                    console.log('任务数组为空，显示暂无任务');
                    taskListUl.innerHTML = '<div class="empty-state">暂无任务</div>';
                    return;
                }
                
                tasks.forEach((task, index) => {
                    const li = document.createElement('li');
                    li.className = 'task-item';
                    
                    // 创建复选框
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `task-${index}`;
                    checkbox.checked = !!task.completed;
                    checkbox.addEventListener('change', () => {
                        tasks[index].completed = checkbox.checked;
                        saveTasks();
                        console.log('任务状态更新:', tasks[index]);
                    });
                    
                    // 创建标签
                    const label = document.createElement('label');
                    label.htmlFor = `task-${index}`;
                    label.textContent = task.text;
                    if (task.completed) {
                        label.style.textDecoration = 'line-through';
                    }
                    
                    // 创建删除按钮
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-task-btn';
                    deleteBtn.textContent = '×';
                    deleteBtn.addEventListener('click', () => {
                        tasks.splice(index, 1);
                        saveTasks();
                        renderTasks();
                        console.log('任务删除成功');
                    });
                    
                    // 组装元素
                    li.appendChild(checkbox);
                    li.appendChild(label);
                    li.appendChild(deleteBtn);
                    taskListUl.appendChild(li);
                });
            }
            
            // 添加新任务（完整版本）
            function addNewTask() {
                const text = taskInput.value.trim();
                console.log('addNewTask被调用，输入内容:', text);
                
                if (!text) {
                    console.warn('任务内容为空');
                    return;
                }
                
                console.log('添加任务前的tasks数组:', tasks);
                
                // 添加新任务到数组
                const newTask = { text: text, completed: false };
                tasks.push(newTask);
                console.log('添加任务后的tasks数组:', tasks);
                
                // 保存到本地存储
                saveTasks();
                
                // 重新渲染任务列表
                renderTasks();
                
                // 清空输入框
                taskInput.value = '';
                
                console.log('任务添加成功:', text);
            }
            
            // 绑定表单提交事件
            if (taskForm) {
                console.log('绑定表单提交事件');
                taskForm.addEventListener('submit', (e) => {
                    console.log('表单提交事件触发');
                    e.preventDefault(); // 阻止表单默认提交行为
                    e.stopPropagation(); // 阻止事件冒泡
                    addNewTask();
                    return false; // 额外的保险措施
                });
            } else {
                console.error('找不到表单元素 add-task-form');
            }
            
            // 首次渲染
            renderTasks();

            // --- 模块4: 每日学习反馈 ---
            const feedbackBtn = document.getElementById('feedback-btn');
            const feedbackModal = document.getElementById('feedback-modal');
            const closeFeedbackBtn = document.querySelector('.close-feedback');
            const feedbackForm = document.getElementById('feedback-form');
            const feedbackBefore = document.getElementById('feedback-before');
            const feedbackAfter = document.getElementById('feedback-after');
            const feedbackBtnText = document.getElementById('feedback-btn-text');
            const feedbackStats = document.getElementById('feedback-stats');

            // 滑块实时显示值
            const focusSlider = document.getElementById('focus-slider');
            const motivationSlider = document.getElementById('motivation-slider');
            const focusValue = document.getElementById('focus-value');
            const motivationValue = document.getElementById('motivation-value');

            // 检查今日是否已完成反馈
            function checkTodayFeedback() {
                const today = new Date().toISOString().split('T')[0];
                const feedbackData = JSON.parse(localStorage.getItem('dailyFeedbackData')) || {};
                return feedbackData[today] || null;
            }

            // 初始化反馈卡片状态
            function initFeedbackCard() {
                const todayFeedback = checkTodayFeedback();
                if (todayFeedback) {
                    // 已完成反馈 - 显示"after"状态
                    feedbackBefore.classList.remove('active');
                    feedbackAfter.classList.add('active');
                    feedbackBtnText.textContent = '查看反馈';
                    feedbackStats.style.display = 'block';
                    
                    // 显示今日统计
                    document.getElementById('stat-focus').textContent = todayFeedback.focus;
                    document.getElementById('stat-motivation').textContent = todayFeedback.motivation;
                    document.getElementById('stat-task-completion').textContent = todayFeedback.taskCompletion;
                } else {
                    // 未完成反馈 - 显示"before"状态
                    feedbackBefore.classList.add('active');
                    feedbackAfter.classList.remove('active');
                    feedbackBtnText.textContent = '开始反馈';
                    feedbackStats.style.display = 'none';
                }
            }

            // 计算任务完成率
            function calculateTaskCompletion() {
                const tasks = JSON.parse(localStorage.getItem('tasks')) || [];
                if (tasks.length === 0) return 0;
                const completedTasks = tasks.filter(task => task.completed).length;
                return Math.round((completedTasks / tasks.length) * 100);
            }

            // 生成任务完成列表
            function generateTaskCompletionArea() {
                const tasks = JSON.parse(localStorage.getItem('tasks')) || [];
                const taskArea = document.getElementById('task-completion-area');
                taskArea.innerHTML = '';
                
                tasks.forEach((task, index) => {
                    const taskItem = document.createElement('div');
                    taskItem.className = 'task-completion-item';
                    taskItem.innerHTML = `
                        <input type="checkbox" id="feedback-task-${index}" ${task.completed ? 'checked' : ''}>
                        <label for="feedback-task-${index}">
                            <span class="custom-checkbox">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                            </span>
                            <span class="task-text">${task.text}</span>
                        </label>
                    `;
                    taskArea.appendChild(taskItem);
                });
            }

            // 滑块值实时更新
            focusSlider.addEventListener('input', () => {
                focusValue.textContent = focusSlider.value;
            });
            
            motivationSlider.addEventListener('input', () => {
                motivationValue.textContent = motivationSlider.value;
            });

            // 打开反馈模态框
            feedbackBtn.addEventListener('click', () => {
                generateTaskCompletionArea();
                const todayFeedback = checkTodayFeedback();
                
                if (todayFeedback) {
                    // 查看模式：填充已有数据
                    fillFormWithData(todayFeedback);
                } else {
                    // 填写模式：重置表单
                    feedbackForm.reset();
                    focusValue.textContent = '3';
                    motivationValue.textContent = '3';
                }
                
                feedbackModal.classList.add('open');
            });

            // 关闭模态框
            function closeFeedbackModal() {
                feedbackModal.classList.remove('open');
            }

            closeFeedbackBtn.addEventListener('click', closeFeedbackModal);
            feedbackModal.addEventListener('click', (e) => {
                if (e.target === feedbackModal) {
                    closeFeedbackModal();
                }
            });

            // 用已有数据填充表单
            function fillFormWithData(data) {
                focusSlider.value = data.focus;
                motivationSlider.value = data.motivation;
                focusValue.textContent = data.focus;
                motivationValue.textContent = data.motivation;
                
                document.getElementById('highlight').value = data.highlight || '';
                document.getElementById('challenge').value = data.challenge || '';
                document.getElementById('action').value = data.action || '';
                
                if (data.cause) {
                    const causeRadio = document.querySelector(`input[name="cause"][value="${data.cause}"]`);
                    if (causeRadio) causeRadio.checked = true;
                    if (data.cause === 'other' && data.causeOther) {
                        document.getElementById('cause-other').value = data.causeOther;
                    }
                }
                
                if (data.startup) {
                    const startupRadio = document.querySelector(`input[name="startup"][value="${data.startup}"]`);
                    if (startupRadio) startupRadio.checked = true;
                    if (data.startup === 'other' && data.startupOther) {
                        document.getElementById('startup-other').value = data.startupOther;
                    }
                }
            }

            // 提交反馈表单
            feedbackForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                // 同步“任务完成情况”到今日任务数据
                try {
                    const tasks = JSON.parse(localStorage.getItem('tasks')) || [];
                    if (tasks.length > 0) {
                        tasks.forEach((task, index) => {
                            const cb = document.getElementById(`feedback-task-${index}`);
                            if (cb) task.completed = cb.checked === true;
                        });
                        localStorage.setItem('tasks', JSON.stringify(tasks));
                        // 如果渲染函数存在，刷新任务区
                        if (typeof renderTasks === 'function') {
                            try { renderTasks(); } catch (_) {}
                        }
                    }
                } catch (_) {}

                // 重新计算完成率（基于同步后的任务状态）
                const completion = calculateTaskCompletion();
                
                // 收集表单数据
                const formData = {
                    date: new Date().toISOString().split('T')[0],
                    taskCompletion: completion,
                    focus: parseInt(focusSlider.value),
                    motivation: parseInt(motivationSlider.value),
                    highlight: document.getElementById('highlight').value.trim(),
                    challenge: document.getElementById('challenge').value.trim(),
                    action: document.getElementById('action').value.trim(),
                    cause: document.querySelector('input[name="cause"]:checked')?.value || '',
                    causeOther: document.getElementById('cause-other').value.trim(),
                    startup: document.querySelector('input[name="startup"]:checked')?.value || '',
                    startupOther: document.getElementById('startup-other').value.trim(),
                    timestamp: new Date().toISOString()
                };

                // 保存到localStorage
                const feedbackData = JSON.parse(localStorage.getItem('dailyFeedbackData')) || {};
                feedbackData[formData.date] = formData;
                localStorage.setItem('dailyFeedbackData', JSON.stringify(feedbackData));

                // 关闭模态框并更新卡片状态
                closeFeedbackModal();
                initFeedbackCard();
                updateFeedbackChart();
                
                // 显示成功提示（简单的alert，后续可以用更优雅的toast）
                alert('✅ 反馈已保存！明天继续加油～');
            });

            // 更新反馈趋势图
            function updateFeedbackChart() {
                const feedbackData = JSON.parse(localStorage.getItem('dailyFeedbackData')) || {};
                const ctx = document.getElementById('feedback-chart');
                if (!ctx) return;

                // 获取最近7天的数据
                const last7Days = [];
                const focusData = [];
                const motivationData = [];
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    const dayData = feedbackData[dateStr];
                    
                    last7Days.push(date.toLocaleDateString('zh-CN', { month: 'numeric', day: 'numeric' }));
                    focusData.push(dayData ? dayData.focus : null);
                    motivationData.push(dayData ? dayData.motivation : null);
                }

                // 计算平均值
                const validFocus = focusData.filter(val => val !== null);
                const validMotivation = motivationData.filter(val => val !== null);
                const avgFocus = validFocus.length > 0 ? (validFocus.reduce((a, b) => a + b, 0) / validFocus.length).toFixed(1) : '-';
                const avgMotivation = validMotivation.length > 0 ? (validMotivation.reduce((a, b) => a + b, 0) / validMotivation.length).toFixed(1) : '-';
                
                document.getElementById('avg-focus').textContent = avgFocus;
                document.getElementById('avg-motivation').textContent = avgMotivation;

                // 创建或更新图表
                if (!window._feedbackChart) {
                    window._feedbackChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: last7Days,
                            datasets: [
                                {
                                    label: '专注度',
                                    data: focusData,
                                    borderColor: 'rgb(59, 130, 246)',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    tension: 0.4,
                                    fill: true,
                                    pointRadius: 4,
                                    pointHoverRadius: 6,
                                    spanGaps: true
                                },
                                {
                                    label: '积极性',
                                    data: motivationData,
                                    borderColor: 'rgb(16, 185, 129)',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    tension: 0.4,
                                    fill: true,
                                    pointRadius: 4,
                                    pointHoverRadius: 6,
                                    spanGaps: true
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    labels: {
                                        color: 'rgba(224, 230, 241, 0.8)',
                                        font: { size: 12 }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    ticks: {
                                        color: 'rgba(165, 175, 198, 0.8)',
                                        font: { size: 11 }
                                    },
                                    grid: { color: 'rgba(255,255,255,0.08)' }
                                },
                                y: {
                                    beginAtZero: true,
                                    min: 1,
                                    max: 5,
                                    ticks: {
                                        stepSize: 1,
                                        color: 'rgba(165, 175, 198, 0.8)',
                                        font: { size: 11 }
                                    },
                                    grid: { color: 'rgba(255,255,255,0.08)' }
                                }
                            }
                        }
                    });
                } else {
                    window._feedbackChart.data.labels = last7Days;
                    window._feedbackChart.data.datasets[0].data = focusData;
                    window._feedbackChart.data.datasets[1].data = motivationData;
                    window._feedbackChart.update();
                }
            }

            // 初始化反馈模块
            initFeedbackCard();
            updateFeedbackChart();
            
            // 初始化四六级考试倒计时
            initCETCountdown();
        });
        
        // 四六级考试倒计时功能（增强移动端兼容性）
        function initCETCountdown() {
            try {
                // 使用时间戳方式，避免时区和解析问题
                const cetExams = [
                    {
                        name: '2025年6月四六级',
                        date: new Date(Date.UTC(2025, 5, 14, 1, 0, 0)) // UTC时间，转换为北京时间9点
                    },
                    {
                        name: '2025年12月四六级',
                        date: new Date(Date.UTC(2025, 11, 13, 1, 0, 0))
                    },
                    {
                        name: '2026年6月四六级',
                        date: new Date(Date.UTC(2026, 5, 14, 1, 0, 0))
                    },
                    {
                        name: '2026年12月四六级',
                        date: new Date(Date.UTC(2026, 11, 13, 1, 0, 0))
                    }
                ];
                
                function updateCountdown() {
                    try {
                        const now = new Date();
                        let nextExam = null;
                        
                        // 找到下一次考试
                        for (let i = 0; i < cetExams.length; i++) {
                            if (cetExams[i].date.getTime() > now.getTime()) {
                                nextExam = cetExams[i];
                                break;
                            }
                        }
                        
                        // 添加调试信息
                        console.log('当前时间:', now.toString());
                        console.log('下次考试:', nextExam ? nextExam.date.toString() : 'null');
                        
                        const countdownElement = document.getElementById('cet-countdown');
                        const titleElement = document.getElementById('cet-title');
                        const daysElement = document.getElementById('cet-days');
                        
                        if (!countdownElement || !titleElement || !daysElement) {
                            console.log('倒计时元素未找到');
                            return;
                        }
                        
                        if (nextExam) {
                            // 使用更精确的计算方式
                            const timeDiff = nextExam.date.getTime() - now.getTime();
                            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                            
                            titleElement.textContent = nextExam.name;
                            daysElement.textContent = days > 0 ? days.toString() : '0';
                            
                            // 根据剩余天数设置不同的颜色
                            if (days <= 30) {
                                daysElement.style.color = '#ff4757';
                            } else if (days <= 60) {
                                daysElement.style.color = '#ffa502';
                            } else {
                                daysElement.style.color = '#00d2d3';
                            }
                            
                            countdownElement.style.display = 'inline';
                        }
                    } catch (error) {
                        console.error('倒计时更新错误:', error);
                        // 降级处理
                        const daysElement = document.getElementById('cet-days');
                        if (daysElement) {
                            daysElement.textContent = '计算中';
                        }
                    }
                }
                
                // 使用更可靠的DOM加载检测
                function initWhenReady() {
                    if (document.getElementById('cet-countdown')) {
                        updateCountdown();
                    } else {
                        // 如果元素还未加载，延迟重试
                        setTimeout(initWhenReady, 100);
                    }
                }
                
                // 确保DOM加载完成后再执行
                if (document.readyState === 'complete' || document.readyState === 'interactive') {
                    setTimeout(initWhenReady, 0);
                } else {
                    document.addEventListener('DOMContentLoaded', initWhenReady);
                }
                
                // 每小时更新一次倒计时
                setInterval(updateCountdown, 3600000);
                
            } catch (error) {
                console.error('倒计时初始化错误:', error);
            }
        }



        // 编辑模态框功能已移除

        // ======================= 闪记卡功能 =======================
        
        // 闪记卡数据管理
        class FlashcardManager {
            constructor() {
                this.cards = this.loadCards();
                this.currentCardIndex = 0;
                this.isShowingBack = false;
                this.currentFilter = 'all';
                this.filteredCards = [];
                // 新的会话状态（按日）
                this.session = { active: false, queue: [], currentCardId: null, statusMap: {}, baseIds: [], todayKey: null };
                this.init();
            }

            init() {
                this.bindEvents();
                this.updateStats();
                this.renderCardList();
                // 初始状态不显示卡片网格，等待用户点击开始学习
                this.showInitialState();
            }

            // 数据持久化
            loadCards() {
                const saved = localStorage.getItem('flashcards');
                return saved ? JSON.parse(saved) : [];
            }

            saveCards() {
                localStorage.setItem('flashcards', JSON.stringify(this.cards));
                this.updateStats();
                this.renderCardList();
                // 卡片网格已移除，用户直接点击开始学习进入全屏模式
            }

            // 事件绑定
            bindEvents() {
                // 新建卡片按钮
                const addCardBtn = document.getElementById('add-card-btn');
                if (addCardBtn) {
                    addCardBtn.addEventListener('click', () => {
                        this.openNewCardModal();
                    });
                }

                // 开始学习按钮（直接进入全屏背诵模式）
                const startBtn = document.getElementById('start-study-btn');
                if (startBtn) {
                    startBtn.addEventListener('click', () => {
                        // 直接进入全屏学习模式，跳过中间步骤
                        this.enterStudyOverlay();
                        this.startRecitationFromUnlearned();
                    });
                }

                // 学习覆盖层事件绑定
                const exitStudy = document.getElementById('btn-exit-study');
                if (exitStudy) exitStudy.addEventListener('click', () => this.exitStudyOverlay());

                const resetToday = document.getElementById('btn-reset-today');
                if (resetToday) resetToday.addEventListener('click', () => this.resetTodayStatuses());

                const overlayFlip = document.getElementById('study-overlay-flip');
                if (overlayFlip) overlayFlip.addEventListener('click', (e) => {
                    console.log('Flip container clicked');
                    this.flipOverlayCard();
                });
                const overlayCard = document.getElementById('study-overlay-card');
                if (overlayCard) overlayCard.addEventListener('click', (e) => {
                    console.log('Card clicked');
                    this.flipOverlayCard();
                });
                
                // 为卡片内容区域也添加点击事件
                const cardFront = document.getElementById('study-card-front');
                const cardBack = document.getElementById('study-card-back');
                if (cardFront) cardFront.addEventListener('click', (e) => {
                    console.log('Front content clicked');
                    e.stopPropagation();
                    this.flipOverlayCard();
                });
                if (cardBack) cardBack.addEventListener('click', (e) => {
                    console.log('Back content clicked');
                    e.stopPropagation();
                    this.flipOverlayCard();
                });

                document.querySelectorAll('#study-overlay .btn-result').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const result = e.currentTarget.dataset.result;
                        console.log('Rating button clicked:', result);
                        this.handleOverlayMark(result);
                    });
                });

                const restartBtn = document.getElementById('btn-restart-today');
                if (restartBtn) restartBtn.addEventListener('click', () => {
                    this.resetTodayStatuses();
                    this.startRecitationFromUnlearned();
                });

                // 学习模式：主卡片与按钮支持点击翻转
                const flipStudyBtn = document.getElementById('flip-card-btn');
                if (flipStudyBtn) flipStudyBtn.addEventListener('click', () => this.flipCard());
                const main3d = document.getElementById('flashcard-3d');
                if (main3d) main3d.addEventListener('click', () => this.flipCard());

                const addMoreBtn = document.getElementById('btn-add-more');
                if (addMoreBtn) addMoreBtn.addEventListener('click', () => {
                    this.exitStudyOverlay();
                    this.openNewCardModal();
                });

                // 模态框关闭按钮
                const closeBtn = document.querySelector('.close-flashcard-modal');
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        this.closeNewCardModal();
                    });
                }

                const cancelBtn = document.querySelector('.btn-cancel');
                if (cancelBtn) {
                    cancelBtn.addEventListener('click', () => {
                        this.closeNewCardModal();
                    });
                }

                // 表单提交
                const form = document.getElementById('flashcard-form');
                if (form) {
                    form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveNewCard();
                    });
                }

                // 复习模式切换
                const reviewModeRadios = document.querySelectorAll('input[name="review-mode"]');
                reviewModeRadios.forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        const dateGroup = document.getElementById('schedule-date-group');
                        if (dateGroup) {
                            if (e.target.value === 'scheduled') {
                                dateGroup.style.display = 'block';
                            } else {
                                dateGroup.style.display = 'none';
                            }
                        }
                    });
                });

                // 筛选器（下拉选择）
                const filterSelect = document.getElementById('card-filter');
                if (filterSelect) {
                    filterSelect.addEventListener('change', (e) => {
                        this.setFilter(e.target.value);
                    });
                }

                // 卡片翻转（点击卡片或按钮）
                const card3d = document.querySelector('.flashcard-3d');
                if (card3d) {
                    card3d.addEventListener('click', () => {
                        this.flipCard();
                    });
                }
                const flipBtn = document.getElementById('flip-card-btn');
                if (flipBtn) {
                    flipBtn.addEventListener('click', () => this.flipCard());
                }

                // 难度选择
                const difficultyBtns = document.querySelectorAll('.btn-difficulty');
                difficultyBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const difficulty = e.currentTarget.dataset.difficulty;
                        if (difficulty) {
                            this.markDifficulty(difficulty);
                        }
                    });
                });

                // 模态框外部点击关闭
                const modal = document.getElementById('flashcard-modal');
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target.id === 'flashcard-modal') {
                            this.closeNewCardModal();
                        }
                    });
                }
            }

            // 新建卡片模态框
            openNewCardModal() {
                document.getElementById('flashcard-modal').style.display = 'block';
                document.getElementById('card-front').focus();
            }

            closeNewCardModal() {
                document.getElementById('flashcard-modal').style.display = 'none';
                document.getElementById('flashcard-form').reset();
                document.getElementById('schedule-date-group').style.display = 'none';
            }

            // 保存新卡片
            saveNewCard() {
                console.log('开始保存新卡片...');
                const front = document.getElementById('card-front').value.trim();
                const back = document.getElementById('card-back').value.trim();
                const category = document.getElementById('card-category').value;
                const difficulty = document.getElementById('card-difficulty').value;
                const reviewMode = document.querySelector('input[name="review-mode"]:checked').value;
                const scheduleDate = document.getElementById('schedule-date').value;

                console.log('表单数据:', { front, back, category, difficulty, reviewMode, scheduleDate });

                if (!front || !back) {
                    alert('请填写卡片正面和背面内容');
                    return;
                }

                const newCard = {
                    id: Date.now(),
                    front,
                    back,
                    category,
                    difficulty,
                    reviewMode,
                    scheduleDate: reviewMode === 'scheduled' ? scheduleDate : null,
                    createdAt: new Date().toISOString(),
                    lastReviewed: null,
                    reviewCount: 0,
                    masteryLevel: 0
                };

                console.log('创建新卡片:', newCard);
                this.cards.push(newCard);
                console.log('当前卡片总数:', this.cards.length);
                this.saveCards();
                this.closeNewCardModal();
                
                // 显示初始状态，不自动开始学习
                this.showInitialState();
                
                // 显示成功提示
                this.showToast('卡片创建成功！');
                console.log('卡片保存完成');
            }

            // 筛选功能
            setFilter(filter) {
                this.currentFilter = filter;
                
                // 更新下拉选择框状态
                const filterSelect = document.getElementById('card-filter');
                if (filterSelect) {
                    filterSelect.value = filter;
                }
                
                this.renderCardList();
                // 卡片网格已移除，用户直接点击开始学习进入全屏模式
            }

            getFilteredCards() {
                if (this.currentFilter === 'all') {
                    return this.cards;
                } else if (this.currentFilter === 'mastered') {
                    return this.cards.filter(card => card.masteryLevel >= 4);
                }
                return this.cards.filter(card => card.category === this.currentFilter);
            }

            // 渲染卡片列表
            renderCardList() {
                const container = document.querySelector('.card-list');
                if (!container) {
                    console.error('找不到卡片列表容器');
                    return;
                }
                
                const filteredCards = this.getFilteredCards();
                
                if (filteredCards.length === 0) {
                    container.innerHTML = '<div class="empty-list">暂无卡片</div>';
                    this.showEmptyState();
                    return;
                }

                container.innerHTML = filteredCards.map(card => {
                    const masteryStatus = card.masteryLevel >= 4 ? 'mastered' : 
                                         card.masteryLevel >= 2 ? 'learning' : 'new';
                    const statusText = masteryStatus === 'mastered' ? '已掌握' : 
                                      masteryStatus === 'learning' ? '学习中' : '新卡片';
                    
                    return `
                        <div class="card-item" data-id="${card.id}" onclick="flashcardManager.studyCard(${card.id})">
                            <div class="card-preview">
                                <div class="card-front-preview">${this.truncateText(card.front, 30)}</div>
                                <div class="card-meta">
                                    <span class="card-category">${this.getCategoryName(card.category)}</span>
                                    <span class="card-status ${masteryStatus}">${statusText}</span>
                                </div>
                            </div>
                            <div class="card-actions" onclick="event.stopPropagation()">
                                <button class="btn-study" onclick="flashcardManager.studyCard(${card.id})">学习</button>
                                <button class="btn-delete" onclick="flashcardManager.deleteCard(${card.id})">删除</button>
                            </div>
                        </div>
                    `;
                }).join('');
                
                this.filteredCards = filteredCards;
            }

            // 学习卡片
            studyCard(cardId) {
                const cardIndex = this.cards.findIndex(card => card.id === cardId);
                if (cardIndex === -1) return;
                
                this.currentCardIndex = cardIndex;
                this.isShowingBack = false;
                this.showLearningArea();
                this.displayCurrentCard();
            }

            // 开始学习会话（基于当前筛选结果）
            startStudySession() {
                const filtered = this.getFilteredCards();
                if (!filtered || filtered.length === 0) {
                    this.showToast('暂无可学习卡片');
                    this.showEmptyState();
                    return;
                }
                // 找到第一张需要复习的卡片，否则从第一张开始
                let target = filtered.find(c => this.shouldReviewCard(c));
                if (!target) target = filtered[0];
                const idx = this.cards.findIndex(c => c.id === target.id);
                if (idx === -1) return;
                this.currentCardIndex = idx;
                this.isShowingBack = false;
                this.showLearningArea();
                this.displayCurrentCard();
            }

            // 显示学习区域
            showLearningArea() {
                // 使用类选择器定位闪记卡区域的元素
                const empty = document.querySelector('.flashcard-study-area .empty-state');
                const study = document.querySelector('.study-mode');
                const cardContainer = document.querySelector('.card-3d-container');
                const studyControls = document.querySelector('.study-controls');
                const startLearningPrompt = document.querySelector('.start-learning-prompt');
                
                if (empty) {
                    empty.style.display = 'none';
                    empty.classList.add('d-none');
                }
                if (study) {
                    study.style.display = 'block';
                    study.classList.remove('d-none');
                }
                // 隐藏开始学习提示
                if (startLearningPrompt) {
                    startLearningPrompt.style.display = 'none';
                }
                // 显示卡片和控制按钮
                if (cardContainer) cardContainer.style.display = 'block';
                if (studyControls) studyControls.style.display = 'flex';
            }

            showEmptyState() {
                // 使用类选择器定位闪记卡区域的元素
                const empty = document.querySelector('.flashcard-study-area .empty-state');
                const study = document.querySelector('.study-mode');
                if (study) study.style.display = 'none';
                if ((this.cards || []).length === 0) {
                    if (empty) {
                        empty.style.display = 'flex';
                        empty.classList.remove('d-none');
                    }
                } else {
                    if (empty) {
                        empty.style.display = 'none';
                        empty.classList.add('d-none');
                    }
                    // 卡片网格已移除，用户直接点击开始学习进入全屏模式
                }
            }

            // 显示初始状态（等待用户点击开始学习）
            showInitialState() {
                const empty = document.querySelector('.flashcard-study-area .empty-state');
                const study = document.querySelector('.study-mode');
                const cardContainer = document.querySelector('.card-3d-container');
                const studyControls = document.querySelector('.study-controls');
                
                // 隐藏学习模式
                if (study) {
                    study.style.display = 'none';
                    study.classList.add('d-none');
                }
                
                // 根据是否有卡片显示不同的初始状态
                if ((this.cards || []).length === 0) {
                    // 没有卡片时显示创建提示
                    if (empty) {
                        empty.style.display = 'flex';
                        empty.classList.remove('d-none');
                    }
                    // 隐藏卡片和控制按钮
                    if (cardContainer) cardContainer.style.display = 'none';
                    if (studyControls) studyControls.style.display = 'none';
                } else {
                    // 有卡片时显示开始学习提示
                    if (empty) {
                        empty.style.display = 'none';
                        empty.classList.add('d-none');
                    }
                    // 隐藏卡片和控制按钮，只显示开始学习提示
                    if (cardContainer) cardContainer.style.display = 'none';
                    if (studyControls) studyControls.style.display = 'none';
                    this.showStartLearningPrompt();
                }
            }

            // 显示开始学习提示
            showStartLearningPrompt() {
                const studyArea = document.querySelector('.flashcard-study-area');
                if (!studyArea) return;
                
                // 创建开始学习提示界面
                let promptDiv = studyArea.querySelector('.start-learning-prompt');
                if (!promptDiv) {
                    promptDiv = document.createElement('div');
                    promptDiv.className = 'start-learning-prompt';
                    promptDiv.innerHTML = `
                        <div class="empty-content glass-effect">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                                <line x1="8" y1="21" x2="16" y2="21"/>
                                <line x1="12" y1="17" x2="12" y2="21"/>
                            </svg>
                            <h3>准备开始学习</h3>
                            <p>你有 ${this.cards.length} 张闪记卡等待学习</p>
                            <button class="btn btn-primary" onclick="document.getElementById('start-study-btn').click()">
                                开始学习
                            </button>
                        </div>
                    `;
                    studyArea.appendChild(promptDiv);
                }
                promptDiv.style.display = 'flex';
            }

            // 隐藏开始学习提示
            hideStartLearningPrompt() {
                const promptDiv = document.querySelector('.start-learning-prompt');
                if (promptDiv) {
                    promptDiv.style.display = 'none';
                }
            }

            // renderCardsGrid方法已移除，用户直接点击开始学习进入全屏模式

            // 显示当前卡片
            displayCurrentCard() {
                const card = this.cards[this.currentCardIndex];
                if (!card) return;

                const cardElement = document.getElementById('flashcard-3d');
                const frontContent = document.getElementById('card-front-content');
                const backContent = document.getElementById('card-back-content');
                
                if (frontContent) frontContent.textContent = card.front;
                if (backContent) backContent.textContent = card.back;
                
                // 重置卡片状态
                if (cardElement) cardElement.classList.remove('flipped');
                this.isShowingBack = false;
                
                // 重置按钮状态
                const difficultyButtons = document.getElementById('difficulty-buttons');
                const flipBtn = document.getElementById('flip-card-btn');
                
                if (difficultyButtons) difficultyButtons.style.display = 'none';
                if (flipBtn) flipBtn.style.display = 'inline-flex';
                
                // 更新进度
                this.updateProgress();
            }

            // 翻转卡片
            flipCard() {
                const cardElement = document.querySelector('.flashcard-3d');
                if (!cardElement) return;
                
                cardElement.classList.toggle('flipped');
                this.isShowingBack = !this.isShowingBack;
                
                // 显示或隐藏雾度按钮
                const difficultyButtons = document.getElementById('difficulty-buttons');
                const flipBtn = document.getElementById('flip-card-btn');
                
                if (this.isShowingBack) {
                    // 显示背面时，显示雾度按钮，隐藏翻转按钮
                    if (difficultyButtons) difficultyButtons.style.display = 'flex';
                    if (flipBtn) flipBtn.style.display = 'none';
                } else {
                    // 显示正面时，隐藏雾度按钮，显示翻转按钮
                    if (difficultyButtons) difficultyButtons.style.display = 'none';
                    if (flipBtn) flipBtn.style.display = 'inline-flex';
                }
            }

            // 标记难度
            markDifficulty(difficulty) {
                const card = this.cards[this.currentCardIndex];
                if (!card) return;

                // 更新复习统计
                card.lastReviewed = new Date().toISOString();
                card.reviewCount++;
                
                // 根据难度调整掌握度
                switch(difficulty) {
                    case 'easy':
                        card.masteryLevel = Math.min(card.masteryLevel + 2, 5);
                        break;
                    case 'medium':
                        card.masteryLevel = Math.min(card.masteryLevel + 1, 5);
                        break;
                    case 'hard':
                        card.masteryLevel = Math.max(card.masteryLevel - 1, 0);
                        break;
                }
                
                this.saveCards();
                this.nextCard();
                
                // 显示反馈
                this.showToast(`标记为${this.getDifficultyName(difficulty)}`);
            }

            // 下一张卡片
            nextCard() {
                const filtered = this.getFilteredCards();
                if (!filtered.length) {
                    this.showEmptyState();
                    return;
                }
                const currentId = this.cards[this.currentCardIndex]?.id;
                let idxInFiltered = filtered.findIndex(c => c.id === currentId);
                if (idxInFiltered === -1) idxInFiltered = 0;
                const total = filtered.length;
                // 优先寻找需要复习的卡片
                for (let step = 1; step <= total; step++) {
                    const candidate = filtered[(idxInFiltered + step) % total];
                    if (this.shouldReviewCard(candidate)) {
                        const gidx = this.cards.findIndex(c => c.id === candidate.id);
                        this.currentCardIndex = gidx;
                        this.displayCurrentCard();
                        return;
                    }
                }
                // 若都不需要复习，则顺序前进
                const next = filtered[(idxInFiltered + 1) % total];
                const gidx = this.cards.findIndex(c => c.id === next.id);
                this.currentCardIndex = gidx;
                this.displayCurrentCard();
            }

            // 判断是否需要复习
            shouldReviewCard(card) {
                if (!card.lastReviewed) return true;
                
                const lastReview = new Date(card.lastReviewed);
                const now = new Date();
                const daysSinceReview = (now - lastReview) / (1000 * 60 * 60 * 24);
                
                // 根据掌握度决定复习间隔
                const intervals = [1, 2, 4, 7, 14, 30]; // 天数
                const interval = intervals[card.masteryLevel] || 30;
                
                return daysSinceReview >= interval;
            }

            // 删除卡片
            deleteCard(cardId) {
                if (!confirm('确定要删除这张卡片吗？')) return;
                
                this.cards = this.cards.filter(card => card.id !== cardId);
                this.saveCards();
                this.showToast('卡片已删除');
                
                // 如果删除的是当前学习的卡片，重置学习状态
                if (this.cards.length === 0) {
                    // 清理开始学习提示
                    const startLearningPrompt = document.querySelector('.start-learning-prompt');
                    if (startLearningPrompt) {
                        startLearningPrompt.remove();
                    }
                    this.showEmptyState();
                } else {
                    // 如果还有卡片，显示初始状态
                    this.showInitialState();
                }
            }

            // 更新统计信息
            updateStats() {
                const totalCards = this.cards.length;
                const todayStudied = this.cards.filter(card => {
                    if (!card.lastReviewed) return false;
                    const today = new Date().toDateString();
                    const reviewDate = new Date(card.lastReviewed).toDateString();
                    return today === reviewDate;
                }).length;
                
                const masteredCards = this.cards.filter(card => card.masteryLevel >= 4).length;
                const masteryRate = totalCards > 0 ? Math.round((masteredCards / totalCards) * 100) : 0;
                
                const todayEl = document.getElementById('today-studied');
                const totalEl = document.getElementById('total-cards');
                const masteryEl = document.getElementById('mastery-rate');
                if (todayEl) todayEl.textContent = todayStudied;
                if (totalEl) totalEl.textContent = totalCards;
                if (masteryEl) masteryEl.textContent = masteryRate + '%';
            }

            // 更新学习进度
            updateProgress() {
                const filteredCards = this.getFilteredCards();
                if (filteredCards.length === 0) return;
                
                const currentIndex = filteredCards.findIndex(card => card.id === this.cards[this.currentCardIndex].id);
                const progress = ((currentIndex + 1) / filteredCards.length) * 100;
                
                const fill = document.getElementById('progress-fill');
                const text = document.getElementById('progress-text');
                if (fill) fill.style.width = progress + '%';
                if (text) text.textContent = `${currentIndex + 1}/${filteredCards.length}`;
            }

            /**
             * 获取 YYYY-MM-DD 格式的今天日期字符串
             * @returns {string} 今日日期字符串
             */
            getTodayKey() {
                const d = new Date();
                const y = d.getFullYear();
                const m = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                return `${y}-${m}-${day}`;
            }

            /**
             * 加载今天的学习会话状态（本地存储）
             * @returns {{statusMap: Object, baseIds: number[]}}
             */
            loadSessionState() {
                const key = `flashcardSession_${this.getTodayKey()}`;
                try {
                    const raw = localStorage.getItem(key);
                    if (!raw) return { statusMap: {}, baseIds: [] };
                    const obj = JSON.parse(raw);
                    return { statusMap: obj.status || {}, baseIds: obj.baseIds || [] };
                } catch (e) {
                    console.warn('加载会话状态失败:', e);
                    return { statusMap: {}, baseIds: [] };
                }
            }

            /**
             * 保存今天的学习会话状态到本地存储
             * @param {{statusMap:Object, baseIds:number[]}} payload 状态映射与今日基准卡片ID集合
             * @returns {void}
             */
            saveSessionState(payload) {
                const key = `flashcardSession_${this.getTodayKey()}`;
                const data = {
                    status: payload.statusMap || {},
                    baseIds: payload.baseIds || []
                };
                localStorage.setItem(key, JSON.stringify(data));
            }

            /**
             * 根据当前筛选结果构建今日学习基准卡片ID集合
             * @returns {number[]} 今日基准卡片ID数组
             */
            buildSessionBaseIds() {
                return this.getFilteredCards().map(c => c.id);
            }

            /**
             * 进入全屏学习覆盖层
             * @returns {void}
             */
            enterStudyOverlay() {
                const overlay = document.getElementById('study-overlay');
                if (overlay) {
                    overlay.classList.remove('d-none');
                    overlay.style.display = 'flex';
                    overlay.classList.add('active');
                }
                this.session.active = true;
            }

            /**
             * 退出全屏学习覆盖层
             * @returns {void}
             */
            exitStudyOverlay() {
                const overlay = document.getElementById('study-overlay');
                if (overlay) {
                    overlay.style.display = 'none';
                    overlay.classList.remove('active');
                    overlay.classList.add('d-none');
                }
                this.session.active = false;
                // 回到初始状态
                this.showInitialState();
            }

            /**
             * 从未学卡片开始背诵会话：构建队列并展示第一张
             * 需求：每次“开始背诵”优先以未学卡片为学习集合
             * @returns {void}
             */
            startRecitationFromUnlearned() {
                this.session.todayKey = this.getTodayKey();
                const state = this.loadSessionState();
                // 今日基准卡片集合以当前筛选结果为准
                const baseIds = this.buildSessionBaseIds();
                // 初始化未学状态
                baseIds.forEach(id => {
                    if (!state.statusMap[id]) state.statusMap[id] = 'unlearned';
                });
                this.session.statusMap = state.statusMap;
                this.session.baseIds = baseIds;
                this.saveSessionState(this.session);

                // 仅选择未学卡片作为队列开端
                const deck = baseIds.filter(id => this.session.statusMap[id] === 'unlearned');
                if (deck.length === 0) {
                    this.showCompletionView();
                    return;
                }
                this.session.queue = this.shuffle(deck);
                this.presentOverlayCard();

                // 运行态可见，完成态隐藏
                const running = document.getElementById('study-running');
                const complete = document.getElementById('study-complete');
                if (running) {
                    running.classList.remove('d-none');
                    running.style.display = 'block';
                }
                if (complete) complete.style.display = 'none';
            }

            /**
             * 在覆盖层展示当前队列的首张卡片
             * @returns {void}
             */
            presentOverlayCard() {
                console.log('presentOverlayCard called, queue length:', this.session.queue.length);
                if (!this.session.queue.length) {
                    console.log('Queue is empty, showing completion view');
                    this.showCompletionView();
                    return;
                }
                const currentId = this.session.queue[0];
                const card = this.cards.find(c => c.id === currentId);
                this.session.currentCardId = currentId;
                if (!card) {
                    // 若数据异常，弹出该卡片并继续
                    this.session.queue.shift();
                    this.presentOverlayCard();
                    return;
                }
                const cardBox = document.getElementById('study-overlay-card');
                const f = document.getElementById('study-card-front');
                const b = document.getElementById('study-card-back');
                if (f) f.textContent = card.front || '';
                if (b) b.textContent = card.back || '';
                if (cardBox) cardBox.classList.remove('flipped');
            }

            /**
             * 覆盖层中翻转卡片
             * @returns {void}
             */
            flipOverlayCard() {
                const cardBox = document.getElementById('study-overlay-card');
                if (cardBox) cardBox.classList.toggle('flipped');
            }

            /**
             * 处理覆盖层学习标记：忘记/模糊/已会
             * 规则：忘记、模糊将被随机插队回队列；已会则从集合排除
             * 当所有卡片均为已会时，显示完成页
             * @param {'forgot'|'fuzzy'|'known'} result 学习结果
             * @returns {void}
             */
            handleOverlayMark(result) {
                console.log('handleOverlayMark called with result:', result);
                const currentId = this.session.currentCardId;
                console.log('Current card ID:', currentId);
                if (!currentId) {
                    console.log('No current card ID, returning');
                    return;
                }

                // 更新今日状态映射
                this.session.statusMap[currentId] = result === 'known' ? 'known' : result;
                this.saveSessionState(this.session);

                // 更新原卡片的统计（可选）
                const card = this.cards.find(c => c.id === currentId);
                if (card) {
                    card.lastReviewed = new Date().toISOString();
                    card.reviewCount = (card.reviewCount || 0) + 1;
                    if (result === 'known') {
                        card.masteryLevel = Math.min((card.masteryLevel || 0) + 1, 5);
                    }
                }
                this.saveCards();

                // 出队当前卡片
                this.session.queue.shift();

                // 忘记或模糊：随机回插
                if (result === 'forgot' || result === 'fuzzy') {
                    const minOffset = result === 'forgot' ? 2 : 1;
                    const maxOffset = Math.max(this.session.queue.length, 1);
                    const offset = Math.min(
                        minOffset + Math.floor(Math.random() * (maxOffset - minOffset + 1)),
                        this.session.queue.length
                    );
                    const insertIndex = Math.min(offset, this.session.queue.length);
                    this.session.queue.splice(insertIndex, 0, currentId);
                }

                // 若队列耗尽，检查是否所有卡片都已会；若仍有未掌握，重建队列继续
                if (!this.session.queue.length) {
                    const allKnown = this.session.baseIds.every(id => this.session.statusMap[id] === 'known');
                    if (allKnown) {
                        this.showCompletionView();
                        return;
                    } else {
                        const remaining = this.session.baseIds.filter(id => this.session.statusMap[id] !== 'known');
                        this.session.queue = this.shuffle(remaining);
                    }
                }

                console.log('About to call presentOverlayCard, queue length:', this.session.queue.length);
                this.presentOverlayCard();
            }

            /**
             * 展示学习完成视图
             * @returns {void}
             */
            showCompletionView() {
                console.log('showCompletionView called');
                const running = document.getElementById('study-running');
                const complete = document.getElementById('study-complete');
                console.log('Running element:', running);
                console.log('Complete element:', complete);
                if (running) {
                    running.style.display = 'none';
                    running.classList.add('d-none');
                    console.log('Hidden running element');
                }
                if (complete) {
                    complete.style.display = 'flex';
                    complete.classList.remove('d-none');
                    console.log('Showed complete element');
                }
                this.showToast('今日闪记卡记忆已完成');
            }

            /**
             * 重置今天所有已学卡片为未学
             * @returns {void}
             */
            resetTodayStatuses() {
                const baseIds = this.buildSessionBaseIds();
                const state = this.loadSessionState();
                baseIds.forEach(id => {
                    state.statusMap[id] = 'unlearned';
                });
                this.session.statusMap = state.statusMap;
                this.session.baseIds = baseIds;
                this.saveSessionState(this.session);
                this.showToast('已重置为未学');
            }

            /**
             * 洗牌工具
             * @param {any[]} arr 待打乱数组
             * @returns {any[]} 打乱后的新数组
             */
            shuffle(arr) {
                const a = [...arr];
                for (let i = a.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [a[i], a[j]] = [a[j], a[i]];
                }
                return a;
            }

            // 工具方法
            truncateText(text, maxLength) {
                return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
            }

            getCategoryName(category) {
                const names = {
                    vocabulary: '词汇',
                    grammar: '语法',
                    reading: '阅读',
                    listening: '听力',
                    writing: '写作',
                    other: '其他'
                };
                return names[category] || category;
            }

            getDifficultyName(difficulty) {
                const names = {
                    easy: '简单',
                    medium: '中等',
                    hard: '困难'
                };
                return names[difficulty] || difficulty;
            }

            // 显示提示消息
            showToast(message) {
                // 创建临时提示元素
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.textContent = message;
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--accent-color);
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    z-index: 10000;
                    animation: slideInRight 0.3s ease-out;
                `;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'slideOutRight 0.3s ease-in';
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 300);
                }, 2000);
            }
        }

        // 初始化闪记卡管理器
        let flashcardManager;
        
        // 在页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 如果当前视图是闪记卡视图，初始化管理器
            if (document.querySelector('.view.active')?.id === 'flashcard-view') {
                flashcardManager = new FlashcardManager();
            }
        });

        // CSS动画已移至样式区域
    </script>

    <!-- 页面版权水印 -->
    <div class="watermark">
        <p>本网站由Agora工作组提供技术支持</p>
    </div>

    <!-- 学习覆盖层：全屏背诵模式 -->
    <div id="study-overlay" class="d-none position-fixed inset-0 z-1000 bg-overlay backdrop-blur align-items-center justify-content-center">
      <div id="study-running" class="glass-effect d-none w-min-920 p-16 border-radius-16">
        <!-- 顶部操作栏 -->
        <div class="d-flex align-items-center justify-content-space-between mb-16">
          <div class="d-flex gap-8 align-items-center">
            <button id="btn-exit-study" class="btn btn-secondary">退出</button>
            <button id="btn-reset-today" class="btn btn-warning">重置今天</button>
          </div>
          <div class="opacity-08 font-size-14">今日背诵</div>
        </div>

        <!-- 卡片区域 -->
        <div id="study-overlay-flip" class="card-3d-container min-h-360">
          <div id="study-overlay-card" class="flashcard-3d">
            <div class="card-face card-front">
              <div class="card-content" id="study-card-front"> </div>
            </div>
            <div class="card-face card-back">
              <div class="card-content" id="study-card-back"> </div>
            </div>
          </div>
        </div>

        <!-- 行为按钮 -->
        <div class="d-flex gap-12 justify-content-center mt-18">
          <button class="btn btn-danger btn-result" data-result="forgot">忘记</button>
          <button class="btn btn-secondary btn-result" data-result="fuzzy">模糊</button>
          <button class="btn btn-success btn-result" data-result="known">已会</button>
        </div>
      </div>

      <!-- 完成视图 -->
      <div id="study-complete" class="glass-effect d-none w-min-720 text-align-center p-20 border-radius-16">
        <h2 class="mb-8">今日闪记卡记忆已完成</h2>
        <p class="opacity-085 mb-20">你可以选择再学一次或增加卡片。</p>
        <div class="d-flex gap-12 justify-content-center">
          <button id="btn-restart-today" class="btn btn-primary">再学一次</button>
          <button id="btn-add-more" class="btn btn-success">增加卡片</button>
          <button id="btn-exit-study-2" class="btn btn-secondary" onclick="document.getElementById('btn-exit-study')?.click()">返回</button>
        </div>
      </div>
    </div>
    
    <!-- 时间轴相关JavaScript文件 -->
    <script>
// 全局变量
let currentExamType = 'cet4';
let currentTargetScore = 425;
let currentExamDate = new Date('2024-12-14');
let selectedMilestone = null;
let currentView = 'timeline';
let taskData = {};
let milestoneData = {};

// 考试配置
const examConfig = {
    cet4: {
        name: '英语四级',
        passingScore: 425,
        fullScore: 710,
        modules: {
            listening: { name: '听力理解', weight: 35, color: '#3b82f6' },
            reading: { name: '阅读理解', weight: 35, color: '#10b981' },
            writing: { name: '写作', weight: 15, color: '#f59e0b' },
            translation: { name: '翻译', weight: 15, color: '#8b5cf6' }
        }
    },
    cet6: {
        name: '英语六级',
        passingScore: 425,
        fullScore: 710,
        modules: {
            listening: { name: '听力理解', weight: 35, color: '#3b82f6' },
            reading: { name: '阅读理解', weight: 35, color: '#10b981' },
            writing: { name: '写作', weight: 15, color: '#f59e0b' },
            translation: { name: '翻译', weight: 15, color: '#8b5cf6' }
        }
    }
};

// 13周总时间线配置（9/12-12/13）
const milestoneConfig = {
    cet4: {
        425: [ // CET-4 425+ 过线档
            { id: 'diagnosis', name: '建档与诊断', icon: '📋', weeks: 1, startDate: '2024-09-12', endDate: '2024-09-15', description: '选定目标，全真摸底测试' },
            { id: 'foundation', name: '打基础期', icon: '📚', weeks: 4, startDate: '2024-09-16', endDate: '2024-10-13', description: '词汇语法打底，建立阅读听力习惯' },
            { id: 'intensive', name: '强化期', icon: '💪', weeks: 5, startDate: '2024-10-14', endDate: '2024-11-17', description: '真题成套+分项专项双轨推进' },
            { id: 'sprint', name: '冲刺期', icon: '🚀', weeks: 3, startDate: '2024-11-18', endDate: '2024-12-08', description: '真题二刷，限时训练，输出提速' },
            { id: 'final', name: '考前调整', icon: '🎯', weeks: 1, startDate: '2024-12-09', endDate: '2024-12-12', description: '模板巩固，状态调整' }
        ],
        500: [ // CET-4 500+ 优秀档
            { id: 'diagnosis', name: '建档与诊断', icon: '📋', weeks: 1, startDate: '2024-09-12', endDate: '2024-09-15', description: '选定目标，全真摸底测试' },
            { id: 'foundation', name: '打基础期', icon: '📚', weeks: 4, startDate: '2024-09-16', endDate: '2024-10-13', description: '词汇语法打底，建立阅读听力习惯' },
            { id: 'intensive', name: '强化期', icon: '💪', weeks: 5, startDate: '2024-10-14', endDate: '2024-11-17', description: '真题成套+分项专项双轨推进' },
            { id: 'sprint', name: '冲刺期', icon: '🚀', weeks: 3, startDate: '2024-11-18', endDate: '2024-12-08', description: '真题二刷，限时训练，输出提速' },
            { id: 'final', name: '考前调整', icon: '🎯', weeks: 1, startDate: '2024-12-09', endDate: '2024-12-12', description: '模板巩固，状态调整' }
        ],
        600: [ // CET-4 600+ 高分档
            { id: 'diagnosis', name: '建档与诊断', icon: '📋', weeks: 1, startDate: '2024-09-12', endDate: '2024-09-15', description: '选定目标，全真摸底测试' },
            { id: 'foundation', name: '打基础期', icon: '📚', weeks: 4, startDate: '2024-09-16', endDate: '2024-10-13', description: '词汇语法打底，建立阅读听力习惯' },
            { id: 'intensive', name: '强化期', icon: '💪', weeks: 5, startDate: '2024-10-14', endDate: '2024-11-17', description: '真题成套+分项专项双轨推进' },
            { id: 'sprint', name: '冲刺期', icon: '🚀', weeks: 3, startDate: '2024-11-18', endDate: '2024-12-08', description: '真题二刷，限时训练，输出提速' },
            { id: 'final', name: '考前调整', icon: '🎯', weeks: 1, startDate: '2024-12-09', endDate: '2024-12-12', description: '模板巩固，状态调整' }
        ]
    },
    cet6: {
        425: [ // CET-6 425+ 过线档
            { id: 'diagnosis', name: '建档与诊断', icon: '📋', weeks: 1, startDate: '2024-09-12', endDate: '2024-09-15', description: '选定目标，全真摸底测试' },
            { id: 'foundation', name: '打基础期', icon: '📚', weeks: 4, startDate: '2024-09-16', endDate: '2024-10-13', description: '词汇语法打底，建立阅读听力习惯' },
            { id: 'intensive', name: '强化期', icon: '💪', weeks: 5, startDate: '2024-10-14', endDate: '2024-11-17', description: '真题成套+分项专项双轨推进' },
            { id: 'sprint', name: '冲刺期', icon: '🚀', weeks: 3, startDate: '2024-11-18', endDate: '2024-12-08', description: '真题二刷，限时训练，输出提速' },
            { id: 'final', name: '考前调整', icon: '🎯', weeks: 1, startDate: '2024-12-09', endDate: '2024-12-12', description: '模板巩固，状态调整' }
        ],
        500: [ // CET-6 500+ 优秀档
            { id: 'diagnosis', name: '建档与诊断', icon: '📋', weeks: 1, startDate: '2024-09-12', endDate: '2024-09-15', description: '选定目标，全真摸底测试' },
            { id: 'foundation', name: '打基础期', icon: '📚', weeks: 4, startDate: '2024-09-16', endDate: '2024-10-13', description: '词汇语法打底，建立阅读听力习惯' },
            { id: 'intensive', name: '强化期', icon: '💪', weeks: 5, startDate: '2024-10-14', endDate: '2024-11-17', description: '真题成套+分项专项双轨推进' },
            { id: 'sprint', name: '冲刺期', icon: '🚀', weeks: 3, startDate: '2024-11-18', endDate: '2024-12-08', description: '真题二刷，限时训练，输出提速' },
            { id: 'final', name: '考前调整', icon: '🎯', weeks: 1, startDate: '2024-12-09', endDate: '2024-12-12', description: '模板巩固，状态调整' }
        ],
        600: [ // CET-6 600+ 高分档
            { id: 'diagnosis', name: '建档与诊断', icon: '📋', weeks: 1, startDate: '2024-09-12', endDate: '2024-09-15', description: '选定目标，全真摸底测试' },
            { id: 'foundation', name: '打基础期', icon: '📚', weeks: 4, startDate: '2024-09-16', endDate: '2024-10-13', description: '词汇语法打底，建立阅读听力习惯' },
            { id: 'intensive', name: '强化期', icon: '💪', weeks: 5, startDate: '2024-10-14', endDate: '2024-11-17', description: '真题成套+分项专项双轨推进' },
            { id: 'sprint', name: '冲刺期', icon: '🚀', weeks: 3, startDate: '2024-11-18', endDate: '2024-12-08', description: '真题二刷，限时训练，输出提速' },
            { id: 'final', name: '考前调整', icon: '🎯', weeks: 1, startDate: '2024-12-09', endDate: '2024-12-12', description: '模板巩固，状态调整' }
        ]
    }
};

// 6类学生分层计划配置
const studentPlans = {
    cet4: {
        425: {
            name: 'CET-4 425+ 过线档',
            strategy: '性价比优先',
            timeAllocation: {
                reading: 40,
                vocabulary: 20,
                listening: 25,
                writing: 15
            },
            dailyTime: '60-90分钟',
            weeklyGoals: {
                realTests: 1,
                readingExtra: 5,
                listeningExtra: 3,
                writing: 1,
                translation: 2,
                vocabulary: 300
            },
            milestones: {
                week2: '完成2套真题；阅读正确率≥60%；听力对话题型正确率≥50%',
                week6: '累计6-7套；阅读≥65-70%；写作能产出120-150词无重大语法错误',
                week10: '累计10套；翻译常见句式基本正确；听力主旨题不丢大分'
            },
            totalRequirement: {
                realTests: '10-12套',
                readingExtra: '30-40篇',
                listeningExtra: '30段左右',
                vocabulary: '≥3000新词'
            }
        },
        500: {
            name: 'CET-4 500+ 优秀档',
            strategy: '均衡提升、听力不可短板',
            timeAllocation: {
                listening: 30,
                reading: 35,
                writing: 15,
                translation: 20
            },
            dailyTime: '120-150分钟',
            weeklyGoals: {
                realTests: 2,
                listeningExtra: 5,
                readingExtra: 6,
                writing: 2,
                translation: 3,
                vocabulary: 500
            },
            milestones: {
                week4: '听力主旨/细节题稳定≥60%；写作能输出亮点句',
                week8: '成套≥12套；阅读≥75%；翻译错误集中在词汇替换而非语法',
                week12: '全真模拟≥8次；各分项稳定线≥目标要求'
            },
            totalRequirement: {
                realTests: '14-16套',
                readingExtra: '50-60篇',
                listeningExtra: '60段+',
                vocabulary: '≥4500新词'
            }
        },
        600: {
            name: 'CET-4 600+ 高分档',
            strategy: '提升稳定性与速度，难点攻坚',
            timeAllocation: {
                listening: 35,
                reading: 35,
                writing: 15,
                translation: 15
            },
            dailyTime: '150-180分钟',
            weeklyGoals: {
                realTests: 3,
                listeningExtra: 7,
                readingExtra: 8,
                writing: 2,
                translation: 3,
                vocabulary: 700
            },
            milestones: {
                week4: '听力精听摘要基本完整；阅读正确率≥80%',
                week8: '全真≥14套；写作用词多样且连贯；翻译达到地道表达',
                week12: '套题速度与正确率双稳定，错题集中在难点干扰项'
            },
            totalRequirement: {
                realTests: '18-20套',
                readingExtra: '70-80篇',
                listeningExtra: '80-100段',
                vocabulary: '≥6000新词'
            }
        }
    },
    cet6: {
        425: {
            name: 'CET-6 425+ 过线档',
            strategy: '稳扎稳打，难度上调但依然抓性价比',
            timeAllocation: {
                reading: 40,
                vocabulary: 20,
                listening: 25,
                writing: 15
            },
            dailyTime: '90-120分钟',
            weeklyGoals: {
                realTests: 1,
                readingExtra: 5,
                listeningExtra: 3,
                writing: 1,
                translation: 1,
                vocabulary: 490
            },
            milestones: {
                week4: '完成4-5套；阅读≥60%；听力关键词能跟上',
                week8: '累计8-9套；翻译错误率下降（句法清晰）',
                week12: '累计12-14套；写作结构稳定无大错'
            },
            totalRequirement: {
                realTests: '12-14套',
                readingExtra: '40-50篇',
                listeningExtra: '30-40段',
                vocabulary: '≥4000新词'
            }
        },
        500: {
            name: 'CET-6 500+ 优秀档',
            strategy: '听力与阅读双轮驱动',
            timeAllocation: {
                listening: 30,
                reading: 35,
                writing: 15,
                translation: 20
            },
            dailyTime: '150-180分钟',
            weeklyGoals: {
                realTests: 2,
                listeningExtra: 5,
                readingExtra: 6,
                writing: 2,
                translation: 3,
                vocabulary: 630
            },
            milestones: {
                week4: '听力主旨/细节≥60%；阅读≥70%',
                week8: '成套≥12套；写作有亮点句群；翻译表达自然',
                week12: '全真≥10次；整体节奏稳定'
            },
            totalRequirement: {
                realTests: '16-18套',
                readingExtra: '60-70篇',
                listeningExtra: '60-80段',
                vocabulary: '≥5500新词'
            }
        },
        600: {
            name: 'CET-6 600+ 高分档',
            strategy: '难素材、强输出、稳定速度',
            timeAllocation: {
                listening: 35,
                reading: 35,
                writing: 15,
                translation: 15
            },
            dailyTime: '180-210分钟',
            weeklyGoals: {
                realTests: 3,
                listeningExtra: 7,
                readingExtra: 8,
                writing: 2,
                translation: 3,
                vocabulary: 840
            },
            milestones: {
                week4: '听力难度适应，复述完整度≥70%',
                week8: '成套≥14套；阅读≥80%；翻译逻辑自然',
                week12: '全真≥12次；各分项波动小、速度稳'
            },
            totalRequirement: {
                realTests: '18-22套',
                readingExtra: '80-100篇',
                listeningExtra: '90-120段',
                vocabulary: '≥7000新词'
            }
        }
    }
};

// 每周样例课表模板
const weeklyScheduleTemplate = {
    monday: {
        name: '周一',
        tasks: ['阅读限时2篇（解析+错因）', '词汇', '听力精听1段（听写+跟读）']
    },
    tuesday: {
        name: '周二',
        tasks: ['成套半套（听力+写作）计时', '翻译1段', '词汇']
    },
    wednesday: {
        name: '周三',
        tasks: ['阅读题型专项（推断/主旨）2篇', '听力讲座1段', '词汇']
    },
    thursday: {
        name: '周四',
        tasks: ['写作1篇（模板运用+自查）', '长难句10-15句', '词汇']
    },
    friday: {
        name: '周五',
        tasks: ['成套半套（阅读+翻译）计时', '听力对话1段', '词汇']
    },
    saturday: {
        name: '周六',
        tasks: ['全真模拟1套（强化/冲刺期执行）', '完整纠错与错题本']
    },
    sunday: {
        name: '周日',
        tasks: ['机动复盘（查漏补缺/补休/轻量口语复述）']
    }
};

// 关键方法细节
const keyMethods = {
    listening: {
        name: '听力提速法',
        methods: [
            '先泛听定位主题，再精听做听写',
            '跟读模仿重音与信息组块',
            '记"信号词清单"（however, in contrast, for example, as a result等）'
        ]
    },
    reading: {
        name: '阅读拿分法',
        methods: [
            '先读题干再浏览文章',
            '段落首尾句与转折处高权重',
            '同义替换字典（提升-boost/enhance; 影响-impact/influence; 导致-lead to/bring about）'
        ]
    },
    translation: {
        name: '翻译稳分法',
        methods: [
            '先定主干SVO，长修饰前置或拆分',
            '文化词先意译再补充解释（必要时括号）'
        ]
    },
    writing: {
        name: '写作模板与亮点',
        methods: [
            '模板不生搬硬套，至少2-3处"自定义信息"',
            '亮点句式（非谓语/强调/分词/名词化/It is universally acknowledged that…）'
        ]
    }
};

// 任务模板
const taskTemplates = {
    foundation: {
        listening: [
            {
                title: '基础语音训练',
                description: '学习英语音标，掌握基本发音规律',
                estimatedTime: 30,
                difficulty: 'easy',
                tasks: [
                    '学习48个国际音标',
                    '练习单词发音',
                    '听写基础词汇',
                    '跟读简单对话'
                ]
            },
            {
                title: '听力基础练习',
                description: '从慢速英语开始，培养听力感觉',
                estimatedTime: 45,
                difficulty: 'easy',
                tasks: [
                    '听VOA慢速英语',
                    '练习数字听写',
                    '听写简单句子',
                    '完成基础听力题'
                ]
            }
        ],
        reading: [
            {
                title: '语法基础复习',
                description: '复习基本语法知识，为阅读打基础',
                estimatedTime: 60,
                difficulty: 'easy',
                tasks: [
                    '复习时态语态',
                    '学习从句结构',
                    '掌握非谓语动词',
                    '练习语法填空'
                ]
            },
            {
                title: '阅读技巧入门',
                description: '学习基本阅读技巧和方法',
                estimatedTime: 45,
                difficulty: 'easy',
                tasks: [
                    '学习快速阅读技巧',
                    '练习关键词定位',
                    '掌握段落大意',
                    '完成简单阅读题'
                ]
            }
        ],
        writing: [
            {
                title: '写作基础训练',
                description: '掌握基本写作结构和表达',
                estimatedTime: 60,
                difficulty: 'easy',
                tasks: [
                    '学习段落结构',
                    '掌握连接词使用',
                    '练习简单句写作',
                    '完成基础作文'
                ]
            }
        ]
    },
    vocabulary: {
        listening: [
            {
                title: '听力词汇专项',
                description: '重点掌握听力常考词汇',
                estimatedTime: 45,
                difficulty: 'medium',
                tasks: [
                    '背诵听力高频词汇',
                    '练习词汇听写',
                    '掌握同义词替换',
                    '完成词汇听力题'
                ]
            }
        ],
        reading: [
            {
                title: '阅读词汇突破',
                description: '扩大阅读词汇量，提高理解能力',
                estimatedTime: 60,
                difficulty: 'medium',
                tasks: [
                    '背诵核心词汇',
                    '学习词根词缀',
                    '练习词汇题',
                    '阅读词汇文章'
                ]
            }
        ],
        writing: [
            {
                title: '写作词汇积累',
                description: '积累写作常用词汇和表达',
                estimatedTime: 45,
                difficulty: 'medium',
                tasks: [
                    '学习写作高级词汇',
                    '掌握同义词替换',
                    '练习词汇运用',
                    '完成词汇作文'
                ]
            }
        ]
    },
    listening: {
        listening: [
            {
                title: '短对话专项训练',
                description: '重点练习短对话听力技巧',
                estimatedTime: 45,
                difficulty: 'medium',
                tasks: [
                    '练习日常对话',
                    '掌握对话技巧',
                    '完成短对话题',
                    '分析错题原因'
                ]
            },
            {
                title: '长对话强化练习',
                description: '提高长对话理解能力',
                estimatedTime: 60,
                difficulty: 'medium',
                tasks: [
                    '练习长对话',
                    '学习笔记技巧',
                    '掌握关键信息',
                    '完成长对话题'
                ]
            },
            {
                title: '听力篇章训练',
                description: '提升篇章听力理解能力',
                estimatedTime: 60,
                difficulty: 'hard',
                tasks: [
                    '练习新闻听力',
                    '掌握篇章结构',
                    '提高理解速度',
                    '完成篇章题目'
                ]
            }
        ]
    },
    reading: {
        reading: [
            {
                title: '仔细阅读专项',
                description: '提高仔细阅读的准确率',
                estimatedTime: 60,
                difficulty: 'medium',
                tasks: [
                    '练习细节理解',
                    '掌握推理判断',
                    '学习主旨大意',
                    '完成仔细阅读'
                ]
            },
            {
                title: '快速阅读训练',
                description: '提升阅读速度和效率',
                estimatedTime: 45,
                difficulty: 'medium',
                tasks: [
                    '练习快速浏览',
                    '掌握关键词定位',
                    '提高阅读速度',
                    '完成快速阅读'
                ]
            },
            {
                title: '选词填空专项',
                description: '掌握选词填空解题技巧',
                estimatedTime: 30,
                difficulty: 'hard',
                tasks: [
                    '学习词性分析',
                    '掌握语法知识',
                    '练习逻辑推理',
                    '完成选词填空'
                ]
            }
        ]
    },
    writing: {
        writing: [
            {
                title: '议论文写作',
                description: '掌握议论文写作结构和技巧',
                estimatedTime: 90,
                difficulty: 'medium',
                tasks: [
                    '学习议论文结构',
                    '掌握论证方法',
                    '练习开头结尾',
                    '完成议论文写作'
                ]
            },
            {
                title: '应用文写作',
                description: '练习各类应用文写作',
                estimatedTime: 60,
                difficulty: 'medium',
                tasks: [
                    '学习书信格式',
                    '掌握通知写法',
                    '练习邀请函',
                    '完成应用文写作'
                ]
            },
            {
                title: '翻译专项训练',
                description: '提高中英文翻译能力',
                estimatedTime: 60,
                difficulty: 'hard',
                tasks: [
                    '学习翻译技巧',
                    '练习句子翻译',
                    '掌握文化表达',
                    '完成段落翻译'
                ]
            }
        ]
    },
    mock: {
        listening: [
            {
                title: '听力模拟测试',
                description: '完整听力模拟考试',
                estimatedTime: 30,
                difficulty: 'hard',
                tasks: [
                    '完成模拟听力',
                    '分析错题原因',
                    '总结解题技巧',
                    '制定改进计划'
                ]
            }
        ],
        reading: [
            {
                title: '阅读模拟测试',
                description: '完整阅读模拟考试',
                estimatedTime: 40,
                difficulty: 'hard',
                tasks: [
                    '完成模拟阅读',
                    '控制答题时间',
                    '分析错题类型',
                    '优化解题策略'
                ]
            }
        ],
        writing: [
            {
                title: '写作模拟测试',
                description: '完整写作模拟考试',
                estimatedTime: 30,
                difficulty: 'hard',
                tasks: [
                    '完成模拟写作',
                    '控制写作时间',
                    '检查语法错误',
                    '提升表达质量'
                ]
            }
        ]
    }
};

// 周度备考计划数据 - 静态数据
const weeklyPlanData = {
    "四级": {
        "425": {
            weeks: [
                {
                    id: 1,
                    title: "Week 1 (9/16–9/22) 启动与基础1",
                    theme: "建档与诊断",
                    goal: "建立学习基础，熟悉考试结构",
                    tasks: {
                        "四级425+": [
                            "套题: 1套",
                            "阅读: 4篇（限时10'/篇，先题干后文）",
                            "听力: 2段长对话/讲座（精听+关键词）",
                            "写作: 1篇（套用基础模板）",
                            "翻译: 1段（句子主干提取）",
                            "词汇: 50/天（总≥300），旧词复习"
                        ]
                    },
                    checkpoint: "近年真题1套（严格计时），分项打分；四级核心词表过一遍，建立生词本；写作自测1篇（现状模板），翻译1段；建立错题本与复盘表"
                },
                {
                    id: 2,
                    title: "Week 2 (9/23–9/29) 基础2",
                    theme: "基础巩固",
                    goal: "提升基础技能",
                    tasks: {
                        "四级425+": [
                            "套题: 1套",
                            "阅读: 4–5篇",
                            "听力: 2段",
                            "写作: 1篇",
                            "翻译: 1段",
                            "词汇: 50/天"
                        ]
                    },
                    checkpoint: "阅读正确率目标 ≥60%，听力主旨题命中 ≥50%"
                },
                {
                    id: 3,
                    title: "Week 3 (9/30–10/6) 基础3",
                    theme: "技能提升",
                    goal: "巩固基础技能",
                    tasks: {
                        "四级425+": [
                            "套题: 1套",
                            "阅读: 4篇",
                            "听力: 2段",
                            "写作: 1篇",
                            "翻译: 1段",
                            "词汇: 50/天"
                        ]
                    },
                    checkpoint: "继续巩固基础，保持学习节奏"
                },
                {
                    id: 4,
                    title: "Week 4 (10/7–10/13) 基础4",
                    theme: "基础完善",
                    goal: "完善基础技能",
                    tasks: {
                        "四级425+": [
                            "套题: 1套",
                            "阅读: 5篇",
                            "听力: 2–3段",
                            "写作: 1篇",
                            "翻译: 1段",
                            "词汇: 50/天"
                        ]
                    },
                    checkpoint: "套题累计 ≥4，写作结构完整、无大错；保留1套'自改+他评'稿"
                },
                {
                    id: 5,
                    title: "Week 5 (10/14–10/20) 强化1",
                    theme: "技能强化",
                    goal: "提升解题技巧",
                    tasks: {
                        "四级425+": [
                            "套题: 1套",
                            "阅读: 5篇（推断/同义改写强化）",
                            "听力: 3段",
                            "写作: 1篇",
                            "翻译: 2段",
                            "词汇: 50/天"
                        ]
                    },
                    checkpoint: "强化推断和同义改写技巧"
                },
                {
                    id: 6,
                    title: "Week 6 (10/21–10/27) 强化2",
                    theme: "技能巩固",
                    goal: "巩固强化成果",
                    tasks: {
                        "四级425+": [
                            "套题: 1套",
                            "阅读: 5篇",
                            "听力: 3段",
                            "写作: 1篇",
                            "翻译: 2段",
                            "词汇: 50/天"
                        ]
                    },
                    checkpoint: "阅读正确率 ≥65%，写作能输出2–3个亮点句型（非谓语/强调/倒装）"
                },
                {
                    id: 7,
                    title: "Week 7 (10/28–11/3) 强化3",
                    theme: "持续强化",
                    goal: "保持强化训练",
                    tasks: {
                        "四级425+": [
                            "套题: 1套",
                            "阅读: 5篇",
                            "听力: 3段",
                            "写作: 1篇",
                            "翻译: 2段",
                            "词汇: 50/天"
                        ]
                    },
                    checkpoint: "继续保持强化训练节奏"
                },
                {
                    id: 8,
                    title: "Week 8 (11/4–11/10) 强化4",
                    theme: "强化收尾",
                    goal: "完成强化阶段",
                    tasks: {
                        "四级425+": [
                            "套题: 1套",
                            "阅读: 5篇",
                            "听力: 3段",
                            "写作: 1篇",
                            "翻译: 2段",
                            "词汇: 50/天"
                        ]
                    },
                    checkpoint: "套题累计 ≥8"
                },
                {
                    id: 9,
                    title: "Week 9 (11/11–11/17) 强化5",
                    theme: "错因分析",
                    goal: "分析错误原因",
                    tasks: {
                        "四级425+": [
                            "套题: 1套",
                            "阅读: 5篇",
                            "听力: 3段",
                            "写作: 1篇",
                            "翻译: 2段",
                            "词汇: 50/天"
                        ]
                    },
                    checkpoint: "整理'高频错因清单'（逻辑词、同义替换、易混搭配）"
                },
                {
                    id: 10,
                    title: "Week 10 (11/18–11/24) 冲刺1",
                    theme: "冲刺准备",
                    goal: "进入冲刺状态",
                    tasks: {
                        "四级425+": [
                            "套题: 1套（限时收口）",
                            "阅读: 5篇",
                            "听力: 3段（精听错题段）",
                            "写作: 1篇",
                            "翻译: 2段",
                            "词汇: 50/天"
                        ]
                    },
                    checkpoint: "阅读速度（10分钟/篇内完成）与正确率双达标"
                },
                {
                    id: 11,
                    title: "Week 11 (11/25–12/1) 冲刺2",
                    theme: "冲刺强化",
                    goal: "强化冲刺训练",
                    tasks: {
                        "四级425+": [
                            "套题: 1套",
                            "阅读: 5篇",
                            "听力: 3段",
                            "写作: 1篇",
                            "翻译: 2段",
                            "词汇: 50/天"
                        ]
                    },
                    checkpoint: "写作与翻译: 按题库主题轮换（文化/教育/科技/社会）"
                },
                {
                    id: 12,
                    title: "Week 12 (12/2–12/8) 冲刺3",
                    theme: "最后冲刺",
                    goal: "最后准备",
                    tasks: {
                        "四级425+": [
                            "套题: 1套（轻量）",
                            "阅读: 4篇（错题型）",
                            "听力: 2段（错段）",
                            "写作: 1篇",
                            "翻译: 1段",
                            "词汇: 50/天"
                        ]
                    },
                    checkpoint: "套题累计目标 10–12"
                },
                {
                    id: 13,
                    title: "Exam Week (12/9–12/13) 考前维稳",
                    theme: "考前调整",
                    goal: "保持最佳状态",
                    tasks: {
                        "四级425+": [
                            "每日: 轻量综合1小时（模板/高频词/错题清单）",
                            "模拟: 1次小型联测（不追求满负荷）",
                            "作息: 前移，物品清单检查，熟悉流程与时间分配"
                        ]
                    },
                    checkpoint: "调整作息，准备考试用品，保持最佳状态"
                }
            ]
        },
        "500": {
            weeks: [
                {
                    id: 1,
                    title: "Week 1 (9/16–9/22) 启动与基础1",
                    theme: "启动与基础",
                    goal: "建档与诊断，建立学习体系",
                    tasks: {
                        "四级500+": [
                            "建档与诊断: 近年真题1套（严格计时），分项打分",
                            "套题: 2套（1套计时）",
                            "阅读: 5–6篇（细节/主旨各半）",
                            "听力: 4段（精听2+跟读2）",
                            "写作: 2篇（议论文+应用文）",
                            "翻译: 2段",
                            "词汇: 70–80/天"
                        ]
                    },
                    checkpoint: "建立错题本与复盘表，完成诊断测试"
                },
                {
                    id: 2,
                    title: "Week 2 (9/23–9/29) 基础2",
                    theme: "基础强化",
                    goal: "提升基础能力",
                    tasks: {
                        "四级500+": [
                            "套题: 2套",
                            "阅读: 6篇",
                            "听力: 4–5段",
                            "写作: 2篇",
                            "翻译: 2段",
                            "词汇: 70–80/天"
                        ]
                    },
                    checkpoint: "阅读正确率目标 ≥68%，听力主旨题命中 ≥60%"
                },
                {
                    id: 3,
                    title: "Week 3 (9/30–10/6) 基础3",
                    theme: "基础巩固",
                    goal: "巩固基础知识",
                    tasks: {
                        "四级500+": [
                            "套题: 2套",
                            "阅读: 5–6篇",
                            "听力: 4段",
                            "写作: 2篇",
                            "翻译: 2段",
                            "词汇: 70/天"
                        ]
                    },
                    checkpoint: "基础知识巩固，准备进入强化阶段"
                },
                {
                    id: 4,
                    title: "Week 4 (10/7–10/13) 基础4",
                    theme: "基础完善",
                    goal: "完善基础体系",
                    tasks: {
                        "四级500+": [
                            "套题: 2套",
                            "阅读: 6篇",
                            "听力: 5段",
                            "写作: 2篇",
                            "翻译: 2段",
                            "词汇: 70–80/天"
                        ]
                    },
                    checkpoint: "套题累计 ≥8，写作保留1套'自改+他评'稿"
                },
                {
                    id: 5,
                    title: "Week 5 (10/14–10/20) 强化1",
                    theme: "强化训练",
                    goal: "开始强化训练",
                    tasks: {
                        "四级500+": [
                            "套题: 2套",
                            "阅读: 6篇（题型分块）",
                            "听力: 5段（跟读2）",
                            "写作: 2篇",
                            "翻译: 2–3段",
                            "词汇: 80/天"
                        ]
                    },
                    checkpoint: "强化训练开始，提升训练强度"
                },
                {
                    id: 6,
                    title: "Week 6 (10/21–10/27) 强化2",
                    theme: "强化提升",
                    goal: "持续强化训练",
                    tasks: {
                        "四级500+": [
                            "套题: 2套",
                            "阅读: 6篇",
                            "听力: 5段",
                            "写作: 2篇",
                            "翻译: 2–3段",
                            "词汇: 80/天"
                        ]
                    },
                    checkpoint: "阅读正确率 ≥72%，写作能输出2–3个亮点句型"
                },
                {
                    id: 7,
                    title: "Week 7 (10/28–11/3) 强化3",
                    theme: "强化深化",
                    goal: "深化强化训练",
                    tasks: {
                        "四级500+": [
                            "套题: 2套",
                            "阅读: 6篇",
                            "听力: 5段",
                            "写作: 2篇",
                            "翻译: 2–3段",
                            "词汇: 80/天"
                        ]
                    },
                    checkpoint: "强化训练深化，各项能力稳步提升"
                },
                {
                    id: 8,
                    title: "Week 8 (11/4–11/10) 强化4",
                    theme: "强化完善",
                    goal: "完善强化阶段",
                    tasks: {
                        "四级500+": [
                            "套题: 2套（1套全真）",
                            "阅读: 6篇",
                            "听力: 5段",
                            "写作: 2篇",
                            "翻译: 2–3段",
                            "词汇: 80/天"
                        ]
                    },
                    checkpoint: "套题累计 ≥12，听力讲座题 ≥65%"
                },
                {
                    id: 9,
                    title: "Week 9 (11/11–11/17) 强化5",
                    theme: "强化总结",
                    goal: "强化阶段总结",
                    tasks: {
                        "四级500+": [
                            "套题: 2套",
                            "阅读: 6篇",
                            "听力: 5段",
                            "写作: 2篇",
                            "翻译: 2–3段",
                            "词汇: 80/天",
                            "任务: 整理'高频错因清单'"
                        ]
                    },
                    checkpoint: "整理高频错因清单，准备冲刺阶段"
                },
                {
                    id: 10,
                    title: "Week 10 (11/18–11/24) 冲刺1",
                    theme: "冲刺开始",
                    goal: "开始冲刺训练",
                    tasks: {
                        "四级500+": [
                            "套题: 2套（1全真）",
                            "阅读: 6篇",
                            "听力: 5段（复述）",
                            "写作: 2篇",
                            "翻译: 2–3段",
                            "词汇: 80/天"
                        ]
                    },
                    checkpoint: "阅读速度与正确率双达标，听力记要框架完整度 ≥70%"
                },
                {
                    id: 11,
                    title: "Week 11 (11/25–12/1) 冲刺2",
                    theme: "冲刺强化",
                    goal: "强化冲刺训练",
                    tasks: {
                        "四级500+": [
                            "套题: 2套",
                            "阅读: 6篇",
                            "听力: 5段",
                            "写作: 2篇",
                            "翻译: 2–3段",
                            "词汇: 80/天",
                            "写作与翻译: 按题库主题轮换"
                        ]
                    },
                    checkpoint: "按题库主题轮换训练，提升应试能力"
                },
                {
                    id: 12,
                    title: "Week 12 (12/2–12/8) 冲刺3",
                    theme: "冲刺收尾",
                    goal: "冲刺阶段收尾",
                    tasks: {
                        "四级500+": [
                            "套题: 1–2套（以错点为主）",
                            "阅读: 5篇",
                            "听力: 4段",
                            "写作: 2篇",
                            "翻译: 2段",
                            "词汇: 70–80/天"
                        ]
                    },
                    checkpoint: "套题累计目标 14–16"
                },
                {
                    id: 13,
                    title: "Exam Week (12/9–12/13) 考前维稳",
                    theme: "考前调整",
                    goal: "保持最佳状态",
                    tasks: {
                        "四级500+": [
                            "每日: 轻量综合1小时",
                            "模拟: 1次小型联测",
                            "作息: 前移，物品清单检查"
                        ]
                    },
                    checkpoint: "调整作息，准备考试用品，保持最佳状态"
                }
            ]
        },
        "600": {
            weeks: [
                {
                    id: 1,
                    title: "Week 1 (9/16–9/22) 启动与基础1",
                    theme: "启动与基础",
                    goal: "建档与诊断，建立学习体系",
                    tasks: {
                        "四级600+": [
                            "建档与诊断: 近年真题1套（严格计时），分项打分",
                            "套题: 2–3套（1套全真）",
                            "阅读: 6–8篇（含长难句拆分）",
                            "听力: 6段（精听+复述要点）",
                            "写作: 2篇（控制错误率）",
                            "翻译: 2–3段",
                            "词汇: 100/天"
                        ]
                    },
                    checkpoint: "建立错题本与复盘表，完成诊断测试"
                },
                {
                    id: 2,
                    title: "Week 2 (9/23–9/29) 基础2",
                    theme: "基础强化",
                    goal: "提升基础能力",
                    tasks: {
                        "四级600+": [
                            "套题: 2–3套",
                            "阅读: 6–8篇",
                            "听力: 6–7段",
                            "写作: 2篇",
                            "翻译: 3段",
                            "词汇: 100/天"
                        ]
                    },
                    checkpoint: "阅读正确率目标 ≥75%，听力主旨题命中 ≥65%"
                },
                {
                    id: 3,
                    title: "Week 3 (9/30–10/6) 基础3",
                    theme: "基础巩固",
                    goal: "巩固基础知识",
                    tasks: {
                        "四级600+": [
                            "套题: 2–3套",
                            "阅读: 6–8篇",
                            "听力: 6段",
                            "写作: 2篇",
                            "翻译: 3段",
                            "词汇: 100/天"
                        ]
                    },
                    checkpoint: "基础知识巩固，准备进入强化阶段"
                },
                {
                    id: 4,
                    title: "Week 4 (10/7–10/13) 基础4",
                    theme: "基础完善",
                    goal: "完善基础体系",
                    tasks: {
                        "四级600+": [
                            "套题: 2–3套",
                            "阅读: 8篇",
                            "听力: 6–7段",
                            "写作: 2篇",
                            "翻译: 3段",
                            "词汇: 100/天"
                        ]
                    },
                    checkpoint: "套题累计 ≥9，写作保留1套'自改+他评'稿"
                },
                {
                    id: 5,
                    title: "Week 5 (10/14–10/20) 强化1",
                    theme: "强化训练",
                    goal: "开始强化训练",
                    tasks: {
                        "四级600+": [
                            "套题: 2–3套",
                            "阅读: 8篇（难文）",
                            "听力: 6–7段（做摘要）",
                            "写作: 2篇",
                            "翻译: 3段",
                            "词汇: 100/天"
                        ]
                    },
                    checkpoint: "强化训练开始，提升训练强度"
                },
                {
                    id: 6,
                    title: "Week 6 (10/21–10/27) 强化2",
                    theme: "强化提升",
                    goal: "持续强化训练",
                    tasks: {
                        "四级600+": [
                            "套题: 2–3套",
                            "阅读: 8篇",
                            "听力: 6–7段",
                            "写作: 2篇",
                            "翻译: 3段",
                            "词汇: 100/天"
                        ]
                    },
                    checkpoint: "阅读正确率 ≥80%，写作能输出2–3个亮点句型"
                },
                {
                    id: 7,
                    title: "Week 7 (10/28–11/3) 强化3",
                    theme: "强化深化",
                    goal: "深化强化训练",
                    tasks: {
                        "四级600+": [
                            "套题: 2–3套",
                            "阅读: 8篇",
                            "听力: 6–7段",
                            "写作: 2篇",
                            "翻译: 3段",
                            "词汇: 100/天"
                        ]
                    },
                    checkpoint: "强化训练深化，各项能力稳步提升"
                },
                {
                    id: 8,
                    title: "Week 8 (11/4–11/10) 强化4",
                    theme: "强化完善",
                    goal: "完善强化阶段",
                    tasks: {
                        "四级600+": [
                            "套题: 2–3套（至少1套全真）",
                            "阅读: 8篇",
                            "听力: 6–7段",
                            "写作: 2篇",
                            "翻译: 3段",
                            "词汇: 100/天"
                        ]
                    },
                    checkpoint: "套题累计 ≥14，听力讲座题 ≥70%"
                },
                {
                    id: 9,
                    title: "Week 9 (11/11–11/17) 强化5",
                    theme: "强化总结",
                    goal: "强化阶段总结",
                    tasks: {
                        "四级600+": [
                            "套题: 2–3套",
                            "阅读: 8篇",
                            "听力: 6–7段",
                            "写作: 2篇",
                            "翻译: 3段",
                            "词汇: 100/天",
                            "任务: 整理'高频错因清单'"
                        ]
                    },
                    checkpoint: "整理高频错因清单，准备冲刺阶段"
                },
                {
                    id: 10,
                    title: "Week 10 (11/18–11/24) 冲刺1",
                    theme: "冲刺开始",
                    goal: "开始冲刺训练",
                    tasks: {
                        "四级600+": [
                            "套题: 2–3套（1全真）",
                            "阅读: 8篇",
                            "听力: 6–7段（速记框架）",
                            "写作: 2篇",
                            "翻译: 3段",
                            "词汇: 100/天"
                        ]
                    },
                    checkpoint: "阅读速度与正确率双达标，听力记要框架完整度 ≥80%"
                },
                {
                    id: 11,
                    title: "Week 11 (11/25–12/1) 冲刺2",
                    theme: "冲刺强化",
                    goal: "强化冲刺训练",
                    tasks: {
                        "四级600+": [
                            "套题: 2–3套",
                            "阅读: 8篇",
                            "听力: 6–7段",
                            "写作: 2篇",
                            "翻译: 3段",
                            "词汇: 100/天",
                            "写作与翻译: 按题库主题轮换"
                        ]
                    },
                    checkpoint: "按题库主题轮换训练，提升应试能力"
                },
                {
                    id: 12,
                    title: "Week 12 (12/2–12/8) 冲刺3",
                    theme: "冲刺收尾",
                    goal: "冲刺阶段收尾",
                    tasks: {
                        "四级600+": [
                            "套题: 2套（重难点回炉）",
                            "阅读: 6篇",
                            "听力: 5–6段",
                            "写作: 2篇",
                            "翻译: 2–3段",
                            "词汇: 90–100/天"
                        ]
                    },
                    checkpoint: "套题累计目标 18–20"
                },
                {
                    id: 13,
                    title: "Exam Week (12/9–12/13) 考前维稳",
                    theme: "考前调整",
                    goal: "保持最佳状态",
                    tasks: {
                        "四级600+": [
                            "每日: 轻量综合1小时",
                            "模拟: 1次小型联测",
                            "作息: 前移，物品清单检查"
                        ]
                    },
                    checkpoint: "调整作息，准备考试用品，保持最佳状态"
                }
            ]
        }
    },
    "六级": {
        "425": {
            weeks: [
                {
                    id: 1,
                    title: "Week 1 (9/16–9/22) 启动与基础1",
                    theme: "启动与基础",
                    goal: "建档与诊断，建立学习体系",
                    tasks: {
                        "六级425+": [
                            "建档与诊断: 六级或临近年份1套（严格计时）；六级核心词表过一遍，建生词本；写作1篇、翻译1段；错题本与时间规划",
                            "套题: 1套（如基础弱，先做1套四级）",
                            "阅读: 5篇（同义改写/推断）",
                            "听力: 2–3段（讲座/新闻，精听）",
                            "写作: 1篇",
                            "翻译: 1段",
                            "词汇: 70/天"
                        ]
                    },
                    checkpoint: "建立错题本与复盘表，完成诊断测试"
                },
                {
                    id: 2,
                    title: "Week 2 (9/23–9/29) 基础2",
                    theme: "基础强化",
                    goal: "提升基础能力",
                    tasks: {
                        "六级425+": [
                            "套题: 1套",
                            "阅读: 5篇",
                            "听力: 3段",
                            "写作: 1篇",
                            "翻译: 1段",
                            "词汇: 70/天"
                        ]
                    },
                    checkpoint: "阅读正确率 ≥60%"
                },
                {
                    id: 3,
                    title: "Week 3 (9/30–10/6) 基础3",
                    theme: "基础巩固",
                    goal: "巩固基础知识",
                    tasks: {
                        "六级425+": [
                            "套题: 1套",
                            "阅读: 5篇",
                            "听力: 3段",
                            "写作: 1篇",
                            "翻译: 1段",
                            "词汇: 70/天"
                        ]
                    },
                    checkpoint: "基础知识巩固，准备进入强化阶段"
                },
                {
                    id: 4,
                    title: "Week 4 (10/7–10/13) 基础4",
                    theme: "基础完善",
                    goal: "完善基础体系",
                    tasks: {
                        "六级425+": [
                            "套题: 1套（六级真题）",
                            "阅读: 5篇",
                            "听力: 3段",
                            "写作: 1篇",
                            "翻译: 1段",
                            "词汇: 70/天"
                        ]
                    },
                    checkpoint: "套题累计 ≥4"
                },
                {
                    id: 5,
                    title: "Week 5 (10/14–10/20) 强化1",
                    theme: "强化训练",
                    goal: "开始强化训练",
                    tasks: {
                        "六级425+": [
                            "套题: 1套",
                            "阅读: 5篇（同义替换）",
                            "听力: 3段",
                            "写作: 1篇",
                            "翻译: 1段",
                            "词汇: 70/天"
                        ]
                    },
                    checkpoint: "强化训练开始，提升训练强度"
                },
                {
                    id: 6,
                    title: "Week 6 (10/21–10/27) 强化2",
                    theme: "强化提升",
                    goal: "持续强化训练",
                    tasks: {
                        "六级425+": [
                            "套题: 1套",
                            "阅读: 5篇",
                            "听力: 3段",
                            "写作: 1篇",
                            "翻译: 1段",
                            "词汇: 70/天"
                        ]
                    },
                    checkpoint: "阅读 ≥65%"
                },
                {
                    id: 7,
                    title: "Week 7 (10/28–11/3) 强化3",
                    theme: "强化深化",
                    goal: "深化强化训练",
                    tasks: {
                        "六级425+": [
                            "套题: 1套",
                            "阅读: 5篇",
                            "听力: 3段",
                            "写作: 1篇",
                            "翻译: 1段",
                            "词汇: 70/天"
                        ]
                    },
                    checkpoint: "强化训练深化，各项能力稳步提升"
                },
                {
                    id: 8,
                    title: "Week 8 (11/4–11/10) 强化4",
                    theme: "强化完善",
                    goal: "完善强化阶段",
                    tasks: {
                        "六级425+": [
                            "套题: 1套（六级）",
                            "阅读: 5篇",
                            "听力: 3段",
                            "写作: 1篇",
                            "翻译: 1段",
                            "词汇: 70/天"
                        ]
                    },
                    checkpoint: "套题累计 ≥8"
                },
                {
                    id: 9,
                    title: "Week 9 (11/11–11/17) 强化5",
                    theme: "强化总结",
                    goal: "强化阶段总结",
                    tasks: {
                        "六级425+": [
                            "套题: 1套",
                            "阅读: 5篇",
                            "听力: 3段",
                            "写作: 1篇",
                            "翻译: 1段",
                            "词汇: 70/天",
                            "任务: 同义改写与逻辑衔接错误专清"
                        ]
                    },
                    checkpoint: "整理高频错因清单，准备冲刺阶段"
                },
                {
                    id: 10,
                    title: "Week 10 (11/18–11/24) 冲刺1",
                    theme: "冲刺开始",
                    goal: "开始冲刺训练",
                    tasks: {
                        "六级425+": [
                            "套题: 1套（限时）",
                            "阅读: 5篇",
                            "听力: 3段（重错段）",
                            "写作: 1篇",
                            "翻译: 1段",
                            "词汇: 70/天"
                        ]
                    },
                    checkpoint: "六级文章限时控制（≤9'/篇）"
                },
                {
                    id: 11,
                    title: "Week 11 (11/25–12/1) 冲刺2",
                    theme: "冲刺强化",
                    goal: "强化冲刺训练",
                    tasks: {
                        "六级425+": [
                            "套题: 1套",
                            "阅读: 5篇",
                            "听力: 3段",
                            "写作: 1篇",
                            "翻译: 1段",
                            "词汇: 70/天"
                        ]
                    },
                    checkpoint: "按题库主题轮换训练，提升应试能力"
                },
                {
                    id: 12,
                    title: "Week 12 (12/2–12/8) 冲刺3",
                    theme: "冲刺收尾",
                    goal: "冲刺阶段收尾",
                    tasks: {
                        "六级425+": [
                            "套题: 1套（轻量）",
                            "阅读: 4篇",
                            "听力: 2–3段",
                            "写作: 1篇",
                            "翻译: 1段",
                            "词汇: 60–70/天"
                        ]
                    },
                    checkpoint: "套题累计 12–14"
                },
                {
                    id: 13,
                    title: "Exam Week (12/9–12/13) 考前维稳",
                    theme: "考前调整",
                    goal: "保持最佳状态",
                    tasks: {
                        "六级425+": [
                            "每日: 轻量维持手感",
                            "作息: 模板复盘、睡眠管理"
                        ]
                    },
                    checkpoint: "调整作息，准备考试用品，保持最佳状态"
                }
            ]
        },
        "500": {
            weeks: [
                {
                    id: 1,
                    title: "Week 1",
                    theme: "启动与基础1",
                    goal: "建档与诊断",
                    tasks: {
                        "六级500+": [
                            "建档与诊断: 六级或临近年份1套（严格计时）；六级核心词表过一遍，建生词本；写作1篇、翻译1段；错题本与时间规划",
                            "套题: 2套（1计时）",
                            "阅读: 6篇（难文）",
                            "听力: 4–5段（摘要+复述）",
                            "写作: 2",
                            "翻译: 2–3",
                            "词汇: 90/天"
                        ]
                    },
                    checkpoint: "完成建档诊断，建立学习基础"
                },
                {
                    id: 2,
                    title: "Week 2",
                    theme: "基础2",
                    goal: "巩固基础能力",
                    tasks: {
                        "六级500+": [
                            "套题: 2",
                            "阅读: 6",
                            "听力: 5",
                            "写作: 2",
                            "翻译: 2–3",
                            "词汇: 90/天"
                        ]
                    },
                    checkpoint: "阅读正确率 ≥70%"
                },
                {
                    id: 3,
                    title: "Week 3",
                    theme: "基础3",
                    goal: "持续基础训练",
                    tasks: {
                        "六级500+": [
                            "套题: 2",
                            "阅读: 6",
                            "听力: 5",
                            "写作: 2",
                            "翻译: 2–3",
                            "词汇: 90/天"
                        ]
                    },
                    checkpoint: "保持训练节奏"
                },
                {
                    id: 4,
                    title: "Week 4",
                    theme: "基础4",
                    goal: "完成基础阶段",
                    tasks: {
                        "六级500+": [
                            "套题: 2",
                            "阅读: 6",
                            "听力: 5",
                            "写作: 2",
                            "翻译: 2–3",
                            "词汇: 90/天"
                        ]
                    },
                    checkpoint: "套题累计 ≥8，听力主旨题 ≥60%"
                },
                {
                    id: 5,
                    title: "Week 5",
                    theme: "强化1",
                    goal: "开始强化训练",
                    tasks: {
                        "六级500+": [
                            "套题: 2",
                            "阅读: 6（题型专项）",
                            "听力: 5（摘要/复述）",
                            "写作: 2",
                            "翻译: 2–3",
                            "词汇: 90/天"
                        ]
                    },
                    checkpoint: "题型专项训练启动"
                },
                {
                    id: 6,
                    title: "Week 6",
                    theme: "强化2",
                    goal: "深化强化训练",
                    tasks: {
                        "六级500+": [
                            "套题: 2",
                            "阅读: 6",
                            "听力: 5",
                            "写作: 2",
                            "翻译: 2–3",
                            "词汇: 90/天"
                        ]
                    },
                    checkpoint: "阅读 ≥72%，写作亮点句群成型"
                },
                {
                    id: 7,
                    title: "Week 7",
                    theme: "强化3",
                    goal: "持续强化提升",
                    tasks: {
                        "六级500+": [
                            "套题: 2",
                            "阅读: 6",
                            "听力: 5",
                            "写作: 2",
                            "翻译: 2–3",
                            "词汇: 90/天"
                        ]
                    },
                    checkpoint: "保持强化训练节奏"
                },
                {
                    id: 8,
                    title: "Week 8",
                    theme: "强化4",
                    goal: "完成强化阶段",
                    tasks: {
                        "六级500+": [
                            "套题: 2（≥1全真）",
                            "阅读: 6",
                            "听力: 5",
                            "写作: 2",
                            "翻译: 2–3",
                            "词汇: 90/天"
                        ]
                    },
                    checkpoint: "套题累计 ≥12，听力难段复述 ≥70%"
                },
                {
                    id: 9,
                    title: "Week 9",
                    theme: "强化5",
                    goal: "巩固强化成果",
                    tasks: {
                        "六级500+": [
                            "套题: 2",
                            "阅读: 6",
                            "听力: 5",
                            "写作: 2",
                            "翻译: 2–3",
                            "词汇: 90/天",
                            "任务: 口头复述要点训练"
                        ]
                    },
                    checkpoint: "口头复述能力提升"
                },
                {
                    id: 10,
                    title: "Week 10",
                    theme: "冲刺1",
                    goal: "开始冲刺阶段",
                    tasks: {
                        "六级500+": [
                            "套题: 2（1全真）",
                            "阅读: 6",
                            "听力: 5（速记+复述）",
                            "写作: 2",
                            "翻译: 2–3",
                            "词汇: 90/天"
                        ]
                    },
                    checkpoint: "冲刺训练启动"
                },
                {
                    id: 11,
                    title: "Week 11",
                    theme: "冲刺2",
                    goal: "深化冲刺训练",
                    tasks: {
                        "六级500+": [
                            "套题: 2",
                            "阅读: 6",
                            "听力: 5",
                            "写作: 2",
                            "翻译: 2–3",
                            "词汇: 90/天"
                        ]
                    },
                    checkpoint: "保持冲刺节奏"
                },
                {
                    id: 12,
                    title: "Week 12",
                    theme: "冲刺3",
                    goal: "完成冲刺准备",
                    tasks: {
                        "六级500+": [
                            "套题: 1–2（以错点为主）",
                            "阅读: 5",
                            "听力: 4–5",
                            "写作: 2",
                            "翻译: 2",
                            "词汇: 80–90/天"
                        ]
                    },
                    checkpoint: "套题累计 16–18"
                },
                {
                    id: 13,
                    title: "Exam Week",
                    theme: "考前维稳",
                    goal: "保持最佳状态",
                    tasks: {
                        "六级500+": [
                            "每日: 轻量维持手感",
                            "作息: 模板复盘、睡眠管理"
                        ]
                    },
                    checkpoint: "考试状态调整完毕"
                }
            ]
        },
        "600": {
            weeks: [
                {
                    id: 1,
                    title: "Week 1",
                    theme: "启动与基础1",
                    goal: "建档与诊断",
                    tasks: {
                        "六级600+": [
                            "建档与诊断: 六级或临近年份1套（严格计时）；六级核心词表过一遍，建生词本；写作1篇、翻译1段；错题本与时间规划",
                            "套题: 2–3套（≥1全真）",
                            "阅读: 8篇（长难句与结构抓取）",
                            "听力: 6–7段（做逻辑框架笔记）",
                            "写作: 2",
                            "翻译: 3",
                            "词汇: 100–120/天"
                        ]
                    },
                    checkpoint: "完成建档诊断，建立学习基础"
                },
                {
                    id: 2,
                    title: "Week 2",
                    theme: "基础2",
                    goal: "巩固基础能力",
                    tasks: {
                        "六级600+": [
                            "套题: 2–3",
                            "阅读: 8",
                            "听力: 6–7",
                            "写作: 2",
                            "翻译: 3",
                            "词汇: 100–120/天"
                        ]
                    },
                    checkpoint: "阅读正确率 ≥78%"
                },
                {
                    id: 3,
                    title: "Week 3",
                    theme: "基础3",
                    goal: "持续基础训练",
                    tasks: {
                        "六级600+": [
                            "套题: 2–3",
                            "阅读: 8",
                            "听力: 6–7",
                            "写作: 2",
                            "翻译: 3",
                            "词汇: 110/天"
                        ]
                    },
                    checkpoint: "保持训练节奏"
                },
                {
                    id: 4,
                    title: "Week 4",
                    theme: "基础4",
                    goal: "完成基础阶段",
                    tasks: {
                        "六级600+": [
                            "套题: 2–3",
                            "阅读: 8",
                            "听力: 6–7",
                            "写作: 2",
                            "翻译: 3",
                            "词汇: 110/天"
                        ]
                    },
                    checkpoint: "套题累计 ≥9，听力主旨题 ≥68%"
                },
                {
                    id: 5,
                    title: "Week 5",
                    theme: "强化1",
                    goal: "开始强化训练",
                    tasks: {
                        "六级600+": [
                            "套题: 2–3",
                            "阅读: 8（议论文/说明文并重）",
                            "听力: 6–7（框架笔记）",
                            "写作: 2",
                            "翻译: 3",
                            "词汇: 110/天"
                        ]
                    },
                    checkpoint: "题型专项训练启动"
                },
                {
                    id: 6,
                    title: "Week 6",
                    theme: "强化2",
                    goal: "深化强化训练",
                    tasks: {
                        "六级600+": [
                            "套题: 2–3",
                            "阅读: 8",
                            "听力: 6–7",
                            "写作: 2",
                            "翻译: 3",
                            "词汇: 110/天"
                        ]
                    },
                    checkpoint: "阅读 ≥80%，写作亮点句群成型"
                },
                {
                    id: 7,
                    title: "Week 7",
                    theme: "强化3",
                    goal: "持续强化提升",
                    tasks: {
                        "六级600+": [
                            "套题: 2–3",
                            "阅读: 8",
                            "听力: 6–7",
                            "写作: 2",
                            "翻译: 3",
                            "词汇: 110/天"
                        ]
                    },
                    checkpoint: "保持强化训练节奏"
                },
                {
                    id: 8,
                    title: "Week 8",
                    theme: "强化4",
                    goal: "完成强化阶段",
                    tasks: {
                        "六级600+": [
                            "套题: 2–3（≥1全真）",
                            "阅读: 8",
                            "听力: 6–7",
                            "写作: 2",
                            "翻译: 3",
                            "词汇: 110/天"
                        ]
                    },
                    checkpoint: "套题累计 ≥14，听力难段复述 ≥80%"
                },
                {
                    id: 9,
                    title: "Week 9",
                    theme: "强化5",
                    goal: "巩固强化成果",
                    tasks: {
                        "六级600+": [
                            "套题: 2–3",
                            "阅读: 8",
                            "听力: 6–7",
                            "写作: 2",
                            "翻译: 3",
                            "词汇: 110/天",
                            "任务: 口头复述要点训练"
                        ]
                    },
                    checkpoint: "口头复述能力提升"
                },
                {
                    id: 10,
                    title: "Week 10",
                    theme: "冲刺1",
                    goal: "开始冲刺阶段",
                    tasks: {
                        "六级600+": [
                            "套题: 2–3（1全真）",
                            "阅读: 8",
                            "听力: 6–7（高强度速记）",
                            "写作: 2",
                            "翻译: 3",
                            "词汇: 110/天"
                        ]
                    },
                    checkpoint: "六级文章限时控制（≤9'/篇）与正确率并行"
                },
                {
                    id: 11,
                    title: "Week 11",
                    theme: "冲刺2",
                    goal: "深化冲刺训练",
                    tasks: {
                        "六级600+": [
                            "套题: 2–3",
                            "阅读: 8",
                            "听力: 6–7",
                            "写作: 2",
                            "翻译: 3",
                            "词汇: 110/天"
                        ]
                    },
                    checkpoint: "保持冲刺节奏"
                },
                {
                    id: 12,
                    title: "Week 12",
                    theme: "冲刺3",
                    goal: "完成冲刺准备",
                    tasks: {
                        "六级600+": [
                            "套题: 2（难点回炉）",
                            "阅读: 6",
                            "听力: 5–6",
                            "写作: 2",
                            "翻译: 2–3",
                            "词汇: 100/天"
                        ]
                    },
                    checkpoint: "套题累计 18–22"
                },
                {
                    id: 13,
                    title: "Exam Week",
                    theme: "考前维稳",
                    goal: "保持最佳状态",
                    tasks: {
                        "六级600+": [
                            "每日: 轻量维持手感",
                            "作息: 模板复盘、睡眠管理"
                        ]
                    },
                    checkpoint: "考试状态调整完毕"
                }
            ]
        }
    }
};

/**
 * 从要求.md动态解析周度备考计划
 * 解析逻辑：
 * 1. 按行读取，识别考试类型(四级/六级)与目标分数行，建立 data[exam][score]
 * 2. 当遇到 "Week" 开头行时开始新周记录，将后续非空行视为任务描述，直到遇到下一个 "Week" 或 "目标分数" 或文件结束
 * 3. 若行包含 "节点验收" 关键字则作为 checkpoint 保存，行本身不作任务
 * @returns {Promise<void>}
 */
async function loadMarkdownPlan() {
    try {
        const response = await fetch('要求.md');
        const mdText = await response.text();
        const lines = mdText.split(/\r?\n/);

        let currentExam = '';
        let currentScore = '';
        let weekObj = null;

        const examAlias = {
            '大学英语四级': 'cet4',
            '大学英语六级': 'cet6'
        };

        lines.forEach(line => {
            line = line.trim();
            if (!line) return; // 跳过空行

            // 识别考试类型
            if (line.startsWith('大学英语四级')) {
                currentExam = 'cet4';
                return;
            } else if (line.startsWith('大学英语六级')) {
                currentExam = 'cet6';
                return;
            }

            // 识别目标分数
            const scoreMatch = line.match(/^目标分数: (\d{3}\+?) */);
            if (scoreMatch) {
                currentScore = scoreMatch[1].replace('+', '');
                if (!weeklyPlanData[currentExam]) weeklyPlanData[currentExam] = {};
                weeklyPlanData[currentExam][currentScore] = { weeks: [] };
                weekObj = null; // 重置
                return;
            }

            // 识别周标题
            const weekMatch = line.match(/^Week (\d+|\w+) /);
            if (weekMatch && currentExam && currentScore) {
                // 推入上一周
                if (weekObj) {
                    weeklyPlanData[currentExam][currentScore].weeks.push(weekObj);
                }
                // 重新生成周对象，基于weeklyPlanStartDate计算正确的日期范围并重建标题
                const weekNumber = parseInt(weekMatch[1]);
                let rebuiltTitle = line; // 默认使用原行
                let themeText = line.replace(/Week \d+\s*\([^)]+\)\s*/, '') || '';
                if (!isNaN(weekNumber)) {
                    const startCalc = new Date('2024-09-15');
                    startCalc.setDate(startCalc.getDate() + (weekNumber - 1) * 7);
                    const endCalc = new Date(startCalc);
                    endCalc.setDate(endCalc.getDate() + 6);
                    rebuiltTitle = `Week ${weekNumber} (${formatDate(startCalc)}–${formatDate(endCalc)}) ${themeText}`.trim();
                }

                weekObj = {
                    id: weeklyPlanData[currentExam][currentScore].weeks.length,
                    title: rebuiltTitle,
                    theme: themeText,
                    goal: '',
                    tasks: { 综合: [] },
                    checkpoint: ''
                };
                return;
            }

            // 节点验收
            if (line.startsWith('节点验收')) {
                if (weekObj) weekObj.checkpoint = line.replace('节点验收: ', '');
                return;
            }

            // 普通任务行
            if (weekObj) {
                weekObj.tasks['综合'].push(line);
            }
        });

        // 推入最后一个周对象
        if (weekObj && currentExam && currentScore) {
            weeklyPlanData[currentExam][currentScore].weeks.push(weekObj);
        }
    } catch (e) {
        console.error('加载要求.md失败', e);
    }
}
/* ===== Legacy static weeklyPlanData (commented out) =====
    //cet4: {
        425: {
            weeks: [
                {
                    id: 0,
                    title: 'Week 0 (9/8–9/14) 预备周',
                    tasks: {
                        套题: ['完成1套真题，了解考试结构和题型分布'],
                        阅读: ['熟悉四级阅读题型（选词填空、长篇阅读、仔细阅读）', '掌握基本阅读技巧'],
                        听力: ['了解听力题型和评分标准', '练习基础听力技能'],
                        写作: ['学习四级写作基本要求和评分标准', '掌握基本写作结构'],
                        翻译: ['了解翻译题型和基本技巧'],
                        词汇: ['开始系统学习四级核心词汇']
                    },
                    checkpoint: '节点验收：能够在规定时间内完成一套完整真题，了解各部分基本要求'
                },
                {
                    id: 1,
                    title: 'Week 1 (9/15–9/21) 打基础1',
                    tasks: {
                        套题: ['完成2套真题，重点分析错题原因'],
                        阅读: ['练习选词填空10篇，掌握词性分析技巧', '练习长篇阅读5篇，提高信息定位能力'],
                        听力: ['新闻听力专项训练，每天2篇', '短对话听力技巧学习和练习'],
                        写作: ['学习议论文写作模板', '练习写作开头和结尾段'],
                        翻译: ['练习基础句型翻译', '学习翻译常用词汇和表达'],
                        词汇: ['掌握200个四级核心词汇', '每天复习和巩固']
                    },
                    checkpoint: '节点验收：阅读正确率达到60%，听力能听懂基本内容，写作能完成基本结构'
                },
                {
                    id: 2,
                    title: 'Week 2 (9/22–9/28) 打基础2',
                    tasks: {
                        套题: ['完成2套真题，提高答题速度'],
                        阅读: ['仔细阅读专项训练10篇', '提高阅读速度和理解准确性'],
                        听力: ['长对话听力训练', '听力笔记技巧学习'],
                        写作: ['练习主体段落写作', '学习论证方法和例证技巧'],
                        翻译: ['练习段落翻译', '掌握常见翻译技巧'],
                        词汇: ['新增200个词汇', '复习前期词汇']
                    },
                    checkpoint: '节点验收：阅读正确率达到65%，听力理解能力有明显提升，写作逻辑更清晰'
                },
                {
                    id: 3,
                    title: 'Week 3 (9/29–10/5) 专项突破1',
                    tasks: {
                        套题: ['完成3套真题，模拟考试环境'],
                        阅读: ['综合阅读训练，提高整体正确率', '重点攻克难题类型'],
                        听力: ['听力篇章训练', '提高听力理解和记忆能力'],
                        写作: ['完整写作练习', '时间控制训练'],
                        翻译: ['文化类翻译专项练习', '提高翻译准确性'],
                        词汇: ['词汇应用练习', '在语境中掌握词汇']
                    },
                    checkpoint: '节点验收：各项技能均有提升，能够在限定时间内完成各部分题目'
                },
                {
                    id: 4,
                    title: 'Week 4 (10/6–10/12) 专项突破2',
                    tasks: {
                        套题: ['完成3套真题，重点提高薄弱环节'],
                        阅读: ['阅读技巧综合运用', '提高阅读效率'],
                        听力: ['听力综合训练', '模拟考试听力环境'],
                        写作: ['写作技巧提升', '语言表达优化'],
                        翻译: ['翻译技巧综合运用', '提高翻译流畅度'],
                        词汇: ['词汇巩固和拓展', '同义词辨析']
                    },
                    checkpoint: '节点验收：阅读正确率达到70%，听力、写作、翻译能力显著提升'
                },
                {
                    id: 5,
                    title: 'Week 5 (10/13–10/19) 强化训练1',
                    tasks: {
                        套题: ['每天1套真题，严格按时间完成'],
                        阅读: ['阅读速度和准确性双重提升', '错题深度分析'],
                        听力: ['听力技巧熟练运用', '提高听力反应速度'],
                        写作: ['写作模板灵活运用', '个性化表达训练'],
                        翻译: ['翻译速度和质量并重', '常见错误避免'],
                        词汇: ['高频词汇重点掌握', '词汇运用能力提升']
                    },
                    checkpoint: '节点验收：整体水平稳定提升，各项正确率达到目标要求的80%'
                },
                {
                    id: 6,
                    title: 'Week 6 (10/20–10/26) 强化训练2',
                    tasks: {
                        套题: ['继续每天1套真题，保持考试状态'],
                        阅读: ['阅读技巧完全掌握', '难题攻克能力提升'],
                        听力: ['听力水平稳定发挥', '细节把握能力强化'],
                        写作: ['写作水平全面提升', '语言表达更加地道'],
                        翻译: ['翻译技能熟练运用', '文化背景知识运用'],
                        词汇: ['词汇掌握达到考试要求', '在各题型中灵活运用']
                    },
                    checkpoint: '节点验收：模拟考试成绩稳定在目标分数线上，各项技能全面达标'
                },
                {
                    id: 7,
                    title: 'Week 7 (10/27–11/2) 冲刺准备1',
                    tasks: {
                        套题: ['精选高质量真题，每天1套'],
                        阅读: ['保持阅读敏感度', '重点题型强化'],
                        听力: ['听力状态保持', '考试技巧运用'],
                        写作: ['写作思路清晰化', '常用表达熟练化'],
                        翻译: ['翻译技巧巩固', '时间分配优化'],
                        词汇: ['核心词汇最后巩固', '易错词汇重点记忆']
                    },
                    checkpoint: '节点验收：考试技巧全面掌握，心理状态调整到最佳'
                },
                {
                    id: 8,
                    title: 'Week 8 (11/3–11/9) 冲刺准备2',
                    tasks: {
                        套题: ['模拟考试环境，完成最后冲刺'],
                        阅读: ['阅读技巧最后检验', '保持最佳状态'],
                        听力: ['听力技能最后调整', '考试心态培养'],
                        写作: ['写作能力最后提升', '模板运用熟练'],
                        翻译: ['翻译水平最后检验', '细节处理完善'],
                        词汇: ['词汇知识最后梳理', '考试词汇重点掌握']
                    },
                    checkpoint: '节点验收：全面准备就绪，具备通过考试的实力和信心'
                },
                {
                    id: 9,
                    title: 'Exam Week (11/11–11/17) 考试周',
                    tasks: {
                        考前准备: ['调整作息，保证充足睡眠', '准备考试用品', '熟悉考场环境'],
                        心态调整: ['保持平和心态', '适度复习，避免过度紧张', '相信自己的准备'],
                        考试发挥: ['按照平时训练的节奏答题', '合理分配时间', '保持冷静和专注'],
                        考后总结: ['客观评估考试表现', '总结经验教训', '为未来学习做准备']
                    },
                    checkpoint: '成功完成四级考试，发挥出应有水平'
                }
            ]
        },
        500: {
            weeks: [
                {
                    id: 0,
                    title: 'Week 0 (9/8–9/14) 预备周',
                    tasks: {
                        套题: ['完成2套真题，全面了解考试要求'],
                        阅读: ['深入分析阅读题型和高分技巧', '建立系统的阅读方法'],
                        听力: ['分析听力高分要求', '制定听力提升计划'],
                        写作: ['学习高分写作标准', '分析优秀范文'],
                        翻译: ['了解翻译高分要求', '学习翻译评分标准'],
                        词汇: ['建立高级词汇学习体系', '制定词汇学习计划']
                    },
                    checkpoint: '节点验收：明确高分目标，制定详细学习计划，具备冲击高分的基础'
                }
            ]
        }
    },
    cet6: {
        425: {
            weeks: [
                {
                    id: 0,
                    title: 'Week 0 (9/8–9/14) 预备周',
                    tasks: {
                        套题: ['完成1套六级真题，了解六级考试难度和特点'],
                        阅读: ['熟悉六级阅读题型特点', '掌握六级阅读基本策略'],
                        听力: ['了解六级听力题型和难度', '建立六级听力学习方法'],
                        写作: ['学习六级写作要求', '了解六级写作评分标准'],
                        翻译: ['掌握六级翻译基本要求', '学习翻译基本技巧'],
                        词汇: ['开始系统学习六级核心词汇', '建立词汇学习体系']
                    },
                    checkpoint: '节点验收：了解六级考试特点，建立学习基础，制定合理学习计划'
                }
            ]
        }
    }
};
*/

// 当前周度计划状态
let currentWeeklyExamType = 'cet4';
let currentWeeklyTargetScore = '425';
let currentWeekIndex = 0;
let weeklyPlanStartDate = new Date('2024-09-15');

// DOM 加载完成后初始化
document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
});

// 初始化应用
function initializeApp() {
    setupEventListeners();
    loadUserPreferences();
    generateMilestones();
    renderTimeline();
    selectFirstMilestone();
    checkExamReminder();
}

// 设置事件监听器
function setupEventListeners() {
    // 考试类型切换
    document.querySelectorAll('.switch-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            switchExamType(this.dataset.type);
        });
    });

    // 目标分数选择
    const scoreSelect = document.getElementById('targetScore');
    if (scoreSelect) {
        scoreSelect.addEventListener('change', function() {
            updateTargetScore(parseInt(this.value));
        });
    }

    // 考试日期选择
    const examDateInput = document.getElementById('examDate');
    if (examDateInput) {
        examDateInput.addEventListener('change', function() {
            updateExamDate(new Date(this.value));
        });
    }

    // 视图切换
    document.querySelectorAll('.view-switch-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            switchView(this.dataset.view);
        });
    });

    // 模块标签切换
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('tab-btn')) {
            switchModule(e.target.dataset.module);
        }
    });

    // 导航链接切换
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('nav-link') && e.target.dataset.view) {
            e.preventDefault();
            switchToView(e.target.dataset.view);
        }
    });

    // 任务复选框
    document.addEventListener('change', function(e) {
        if (e.target.classList.contains('task-checkbox')) {
            toggleTask(e.target);
        }
    });

    // 提醒关闭
    const reminderClose = document.querySelector('.reminder-close');
    if (reminderClose) {
        reminderClose.addEventListener('click', function() {
            hideReminder();
        });
    }

    // 周度备考计划事件监听器
    setupWeeklyPlanListeners();
}

// 加载用户偏好设置
function loadUserPreferences() {
    const savedExamType = localStorage.getItem('examType');
    const savedTargetScore = localStorage.getItem('targetScore');
    const savedExamDate = localStorage.getItem('examDate');
    const savedTaskData = localStorage.getItem('taskData');

    if (savedExamType) {
        currentExamType = savedExamType;
    }
    if (savedTargetScore) {
        currentTargetScore = parseInt(savedTargetScore);
    }
    if (savedExamDate) {
        currentExamDate = new Date(savedExamDate);
    }
    if (savedTaskData) {
        taskData = JSON.parse(savedTaskData);
    }

    updateUI();
}

// 保存用户偏好设置
function saveUserPreferences() {
    localStorage.setItem('examType', currentExamType);
    localStorage.setItem('targetScore', currentTargetScore.toString());
    localStorage.setItem('examDate', currentExamDate.toISOString());
    localStorage.setItem('taskData', JSON.stringify(taskData));
}

// 更新UI显示
function updateUI() {
    // 更新考试类型按钮
    document.querySelectorAll('.switch-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.type === currentExamType);
    });

    // 更新目标分数选择
    const scoreSelect = document.getElementById('targetScore');
    if (scoreSelect) {
        scoreSelect.value = currentTargetScore;
    }

    // 更新考试日期
    const examDateInput = document.getElementById('examDate');
    if (examDateInput) {
        examDateInput.value = currentExamDate.toISOString().split('T')[0];
    }
}

// 切换考试类型
function switchExamType(type) {
    if (currentExamType !== type) {
        currentExamType = type;
        generateMilestones();
        renderTimeline();
        selectFirstMilestone();
        saveUserPreferences();
        updateUI();
    }
}

// 更新目标分数
function updateTargetScore(score) {
    if (currentTargetScore !== score) {
        currentTargetScore = score;
        generateMilestones();
        renderTimeline();
        selectFirstMilestone();
        saveUserPreferences();
    }
}

// 更新考试日期
function updateExamDate(date) {
    currentExamDate = date;
    generateMilestones();
    renderTimeline();
    saveUserPreferences();
    checkExamReminder();
}

// 生成里程碑数据
function generateMilestones() {
    const milestones = milestoneConfig[currentExamType][currentTargetScore];
    if (!milestones) return;

    const totalWeeks = milestones.reduce((sum, milestone) => sum + milestone.weeks, 0);
    const startDate = new Date(currentExamDate);
    startDate.setDate(startDate.getDate() - totalWeeks * 7);

    let currentDate = new Date(startDate);
    milestoneData = {};

    milestones.forEach((milestone, index) => {
        const endDate = new Date(currentDate);
        endDate.setDate(endDate.getDate() + milestone.weeks * 7);

        milestoneData[milestone.id] = {
            ...milestone,
            startDate: new Date(currentDate),
            endDate: new Date(endDate),
            isCompleted: false,
            isCurrent: false
        };

        currentDate = new Date(endDate);
    });

    // 确定当前里程碑
    const now = new Date();
    let foundCurrent = false;
    Object.keys(milestoneData).forEach(id => {
        const milestone = milestoneData[id];
        if (!foundCurrent && now >= milestone.startDate && now <= milestone.endDate) {
            milestone.isCurrent = true;
            foundCurrent = true;
        } else if (now > milestone.endDate) {
            milestone.isCompleted = true;
        }
    });
}

// 渲染时间轴
function renderTimeline() {
    const container = document.querySelector('.milestone-nodes');
    if (!container) return;

    container.innerHTML = '';

    Object.keys(milestoneData).forEach(id => {
        const milestone = milestoneData[id];
        const node = createMilestoneNode(milestone);
        container.appendChild(node);
    });
}

// 创建里程碑节点
function createMilestoneNode(milestone) {
    const node = document.createElement('div');
    node.className = 'milestone-node';
    node.dataset.milestoneId = milestone.id;
    
    if (milestone.isCurrent) {
        node.classList.add('current');
    }
    if (milestone.isCompleted) {
        node.classList.add('completed');
    }

    const circle = document.createElement('div');
    circle.className = 'node-circle';
    circle.textContent = milestone.icon;

    const label = document.createElement('div');
    label.className = 'node-label';
    label.textContent = milestone.name;

    const date = document.createElement('div');
    date.className = 'node-date';
    date.textContent = formatDateRange(milestone.startDate, milestone.endDate);

    node.appendChild(circle);
    node.appendChild(label);
    node.appendChild(date);

    node.addEventListener('click', () => selectMilestone(milestone.id));

    return node;
}

// 格式化日期范围
function formatDateRange(startDate, endDate) {
    const options = { month: 'short', day: 'numeric' };
    const start = startDate.toLocaleDateString('zh-CN', options);
    const end = endDate.toLocaleDateString('zh-CN', options);
    return `${start} - ${end}`;
}

// 选择里程碑
function selectMilestone(milestoneId) {
    selectedMilestone = milestoneId;
    
    // 更新节点选中状态
    document.querySelectorAll('.milestone-node').forEach(node => {
        node.classList.toggle('selected', node.dataset.milestoneId === milestoneId);
    });

    // 更新任务面板
    updateTaskPanel();
}

// 选择第一个里程碑
function selectFirstMilestone() {
    const firstMilestone = Object.keys(milestoneData)[0];
    if (firstMilestone) {
        selectMilestone(firstMilestone);
    }
}

// 更新里程碑数据
function updateMilestoneData() {
    const examType = currentExamType;
    const targetScore = currentTargetScore;
    
    if (milestoneConfig[examType] && milestoneConfig[examType][targetScore]) {
        const milestones = milestoneConfig[examType][targetScore];
        milestoneData = {};
        
        milestones.forEach(milestone => {
            milestoneData[milestone.id] = {
                ...milestone,
                startDate: new Date(milestone.startDate),
                endDate: new Date(milestone.endDate),
                isCurrent: false,
                isCompleted: false
            };
        });
        
        // 设置当前里程碑
        const today = new Date();
        Object.keys(milestoneData).forEach(id => {
            const milestone = milestoneData[id];
            if (today >= milestone.startDate && today <= milestone.endDate) {
                milestone.isCurrent = true;
            } else if (today > milestone.endDate) {
                milestone.isCompleted = true;
            }
        });
    }
}

// 更新学生计划展示
// 获取当前学习阶段
function getCurrentStage() {
    const examDate = new Date('2025-12-13');
    const currentDate = new Date();
    const daysUntilExam = Math.ceil((examDate - currentDate) / (1000 * 60 * 60 * 24));
    
    if (daysUntilExam > 120) {
        return {
            name: '基础阶段',
            description: '建立扎实的语言基础，掌握核心词汇和语法'
        };
    } else if (daysUntilExam > 60) {
        return {
            name: '强化阶段',
            description: '专项训练，提升各模块解题技巧和速度'
        };
    } else if (daysUntilExam > 30) {
        return {
            name: '冲刺阶段',
            description: '模拟考试，查漏补缺，调整考试状态'
        };
    } else {
        return {
            name: '考前冲刺',
            description: '最后复习，保持状态，准备考试'
        };
    }
}

// 更新当前阶段显示
function updateCurrentStage() {
    const stage = getCurrentStage();
    const stageNameElement = document.getElementById('stage-name');
    const stageDescElement = document.getElementById('stage-description');
    
    if (stageNameElement) stageNameElement.textContent = stage.name;
    if (stageDescElement) stageDescElement.textContent = stage.description;
}

function updateStudentPlan() {
    const examType = currentExamType;
    const targetScore = currentTargetScore;
    
    if (studentPlans[examType] && studentPlans[examType][targetScore]) {
        const plan = studentPlans[examType][targetScore];
        const currentStage = getCurrentStage();
        
        // 更新计划展示面板
        const planDisplayElement = document.getElementById('plan-display');
        if (planDisplayElement) {
            planDisplayElement.innerHTML = `
                <div class="plan-overview">
                    <div class="plan-header">
                        <h3 class="plan-name">${plan.name}</h3>
                        <div class="plan-strategy">${plan.strategy}</div>
                    </div>
                    
                    <div class="plan-details">
                        <div class="time-info">
                            <div class="daily-time">
                                <h4>每日学习时间</h4>
                                <span class="time-value">${plan.dailyTime}</span>
                            </div>
                            <div class="weekly-goal">
                                <h4>每周目标</h4>
                                <span class="goal-value">${plan.weeklyGoal}</span>
                            </div>
                        </div>
                        
                        <div class="time-allocation">
                            <h4>时间分配</h4>
                            <div class="allocation-chart">
                                ${Object.entries(plan.timeAllocation).map(([skill, percent]) => `
                                    <div class="allocation-item">
                                        <span class="skill-name">${getSkillName(skill)}</span>
                                        <div class="allocation-bar">
                                            <div class="allocation-fill" style="width: ${percent}%"></div>
                                        </div>
                                        <span class="allocation-percentage">${percent}%</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="current-tasks">
                            <h4>当前阶段任务（${currentStage.name}）</h4>
                            <div class="task-list">
                                ${plan.milestones ? plan.milestones.filter(milestone => 
                                    milestone.stage && milestone.stage.includes(currentStage.name.replace('阶段', '').replace('考前', ''))
                                ).map(milestone => `
                                    <div class="milestone-item">
                                        <h5>${milestone.title}</h5>
                                        <p>${milestone.description}</p>
                                    </div>
                                `).join('') || '<p>暂无当前阶段的具体任务，请根据整体计划安排学习</p>' : '<p>暂无当前阶段的具体任务，请根据整体计划安排学习</p>'}
                            </div>
                        </div>
                        
                        <div class="overall-requirements">
                            <h4>总体要求</h4>
                            <p>${plan.overallRequirements}</p>
                        </div>
                    </div>
                </div>
            `;
        }
    }
    
    // 更新当前阶段显示
    updateCurrentStage();
}

// 获取技能中文名称
function getSkillName(skill) {
    const skillNames = {
        reading: '阅读',
        listening: '听力',
        writing: '写作',
        translation: '翻译',
        vocabulary: '词汇语法'
    };
    return skillNames[skill] || skill;
}

// 更新任务面板
function updateTaskPanel() {
    if (!selectedMilestone || !milestoneData[selectedMilestone]) return;

    const milestone = milestoneData[selectedMilestone];
    
    // 更新标题
    const titleElement = document.querySelector('.selected-milestone');
    if (titleElement) {
        titleElement.textContent = `${milestone.icon} ${milestone.name}`;
    }
    
    // 更新描述
    const descElement = document.querySelector('.milestone-description');
    if (descElement) {
        descElement.textContent = milestone.description || '';
    }

    // 更新进度
    updateProgress();

    // 更新模块标签
    updateModuleTabs();

    // 更新任务列表
    updateTaskList();
}

// 更新进度
function updateProgress() {
    if (!selectedMilestone) return;

    const milestoneKey = `${currentExamType}_${currentTargetScore}_${selectedMilestone}`;
    const milestoneTaskData = taskData[milestoneKey] || {};
    
    let totalTasks = 0;
    let completedTasks = 0;

    Object.keys(milestoneTaskData).forEach(moduleId => {
        const moduleTasks = milestoneTaskData[moduleId] || {};
        Object.keys(moduleTasks).forEach(taskId => {
            const tasks = moduleTasks[taskId] || [];
            totalTasks += tasks.length;
            completedTasks += tasks.filter(task => task.completed).length;
        });
    });

    const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
    
    const progressFill = document.querySelector('.progress-fill');
    const progressText = document.querySelector('.progress-text');
    
    if (progressFill) {
        progressFill.style.width = `${percentage}%`;
    }
    if (progressText) {
        progressText.textContent = `${completedTasks}/${totalTasks} 任务完成 (${percentage}%)`;
    }
}

// 更新模块标签
function updateModuleTabs() {
    const tabsContainer = document.querySelector('.module-tabs');
    if (!tabsContainer) return;

    tabsContainer.innerHTML = '';
    
    const modules = examConfig[currentExamType].modules;
    Object.keys(modules).forEach((moduleId, index) => {
        const module = modules[moduleId];
        const tab = document.createElement('button');
        tab.className = 'tab-btn';
        tab.dataset.module = moduleId;
        
        if (index === 0) {
            tab.classList.add('active');
        }

        tab.innerHTML = `
            ${module.name}
            <span class="weight">${module.weight}%</span>
        `;

        tabsContainer.appendChild(tab);
    });
}

// 切换模块
function switchModule(moduleId) {
    // 更新标签状态
    document.querySelectorAll('.tab-btn').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.module === moduleId);
    });

    // 更新任务列表
    updateTaskList(moduleId);
}

// 更新任务列表
function updateTaskList(activeModule = null) {
    // 只操作学习计划中的任务列表，不影响今日任务
    const taskList = document.querySelector('.milestone-tasks .task-list');
    if (!taskList || !selectedMilestone) return;

    // 如果没有指定模块，使用第一个激活的模块
    if (!activeModule) {
        const activeTab = document.querySelector('.tab-btn.active');
        activeModule = activeTab ? activeTab.dataset.module : Object.keys(examConfig[currentExamType].modules)[0];
    }

    const tasks = getTasksForMilestone(selectedMilestone, activeModule);
    
    if (tasks.length === 0) {
        taskList.innerHTML = '<div class="empty-state">暂无任务</div>';
        return;
    }

    taskList.innerHTML = '';
    
    tasks.forEach((taskGroup, groupIndex) => {
        const group = document.createElement('div');
        group.className = 'task-group';
        
        const groupTitle = document.createElement('div');
        groupTitle.className = 'task-group-title';
        groupTitle.textContent = taskGroup.title;
        group.appendChild(groupTitle);

        taskGroup.tasks.forEach((task, taskIndex) => {
            const taskItem = createTaskItem(task, groupIndex, taskIndex, activeModule);
            group.appendChild(taskItem);
        });

        taskList.appendChild(group);
    });
}

// 获取里程碑任务
function getTasksForMilestone(milestoneId, moduleId) {
    const templates = taskTemplates[milestoneId];
    if (!templates || !templates[moduleId]) return [];

    return templates[moduleId].map(template => {
        const milestoneKey = `${currentExamType}_${currentTargetScore}_${milestoneId}`;
        const moduleKey = `${moduleId}_${template.title}`;
        const savedTasks = taskData[milestoneKey]?.[moduleId]?.[moduleKey] || [];
        
        // 如果没有保存的任务数据，创建默认任务
        if (savedTasks.length === 0) {
            template.tasks.forEach((taskTitle, index) => {
                savedTasks.push({
                    id: `${moduleKey}_${index}`,
                    title: taskTitle,
                    completed: false
                });
            });
            
            // 保存到taskData
            if (!taskData[milestoneKey]) taskData[milestoneKey] = {};
            if (!taskData[milestoneKey][moduleId]) taskData[milestoneKey][moduleId] = {};
            taskData[milestoneKey][moduleId][moduleKey] = savedTasks;
        }

        return {
            ...template,
            tasks: savedTasks
        };
    });
}

// 创建任务项
function createTaskItem(task, groupIndex, taskIndex, moduleId) {
    const item = document.createElement('div');
    item.className = 'task-item';

    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.className = 'task-checkbox';
    checkbox.dataset.milestoneId = selectedMilestone;
    checkbox.dataset.moduleId = moduleId;
    checkbox.dataset.groupIndex = groupIndex;
    checkbox.dataset.taskIndex = taskIndex;

    const content = document.createElement('div');
    content.className = 'task-content';

    const title = document.createElement('div');
    title.className = 'task-title';
    title.textContent = task.title;

    const description = document.createElement('div');
    description.className = 'task-description';
    description.textContent = task.description;

    const meta = document.createElement('div');
    meta.className = 'task-meta';
    
    const time = document.createElement('span');
    time.innerHTML = `⏱️ ${task.estimatedTime}分钟`;
    
    const difficulty = document.createElement('span');
    const difficultyMap = { easy: '简单', medium: '中等', hard: '困难' };
    difficulty.innerHTML = `📊 ${difficultyMap[task.difficulty]}`;
    
    meta.appendChild(time);
    meta.appendChild(difficulty);

    content.appendChild(title);
    content.appendChild(description);
    content.appendChild(meta);

    // 添加子任务列表
    if (task.tasks && task.tasks.length > 0) {
        const subtasks = document.createElement('div');
        subtasks.className = 'subtasks';
        
        task.tasks.forEach((subtask, index) => {
            const subtaskItem = document.createElement('div');
            subtaskItem.className = 'subtask-item';
            
            const subtaskCheckbox = document.createElement('input');
            subtaskCheckbox.type = 'checkbox';
            subtaskCheckbox.className = 'task-checkbox';
            subtaskCheckbox.checked = subtask.completed;
            subtaskCheckbox.dataset.milestoneId = selectedMilestone;
            subtaskCheckbox.dataset.moduleId = moduleId;
            subtaskCheckbox.dataset.groupIndex = groupIndex;
            subtaskCheckbox.dataset.taskIndex = index;
            subtaskCheckbox.dataset.isSubtask = 'true';
            
            const subtaskLabel = document.createElement('label');
            subtaskLabel.textContent = subtask.title;
            
            subtaskItem.appendChild(subtaskCheckbox);
            subtaskItem.appendChild(subtaskLabel);
            subtasks.appendChild(subtaskItem);
        });
        
        content.appendChild(subtasks);
    }

    item.appendChild(checkbox);
    item.appendChild(content);

    return item;
}

// 切换任务状态
function toggleTask(checkbox) {
    const milestoneId = checkbox.dataset.milestoneId;
    const moduleId = checkbox.dataset.moduleId;
    const groupIndex = parseInt(checkbox.dataset.groupIndex);
    const taskIndex = parseInt(checkbox.dataset.taskIndex);
    const isSubtask = checkbox.dataset.isSubtask === 'true';
    
    const milestoneKey = `${currentExamType}_${currentTargetScore}_${milestoneId}`;
    
    if (!taskData[milestoneKey]) taskData[milestoneKey] = {};
    if (!taskData[milestoneKey][moduleId]) taskData[milestoneKey][moduleId] = {};
    
    const tasks = getTasksForMilestone(milestoneId, moduleId);
    if (tasks[groupIndex] && tasks[groupIndex].tasks[taskIndex]) {
        tasks[groupIndex].tasks[taskIndex].completed = checkbox.checked;
        
        // 更新taskData
        const moduleKey = `${moduleId}_${tasks[groupIndex].title}`;
        if (!taskData[milestoneKey][moduleId][moduleKey]) {
            taskData[milestoneKey][moduleId][moduleKey] = [];
        }
        taskData[milestoneKey][moduleId][moduleKey] = tasks[groupIndex].tasks;
    }
    
    // 保存数据并更新进度
    saveUserPreferences();
    updateProgress();
}

// 切换视图
function switchView(view) {
    currentView = view;
    
    // 更新按钮状态
    document.querySelectorAll('.view-switch-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.view === view);
    });
    
    // 显示/隐藏相应面板
    const timelinePanel = document.querySelector('.milestone-timeline');
    const overviewPanel = document.querySelector('.overview-panel');
    
    if (view === 'timeline') {
        if (timelinePanel) timelinePanel.style.display = 'block';
        if (overviewPanel) overviewPanel.style.display = 'none';
    } else {
        if (timelinePanel) timelinePanel.style.display = 'none';
        if (overviewPanel) overviewPanel.style.display = 'block';
        renderOverview();
    }
}

/**
 * 切换到指定视图
 * @param {string} viewName - 视图名称
 */
function switchToView(viewName) {
    console.log('切换到视图:', viewName);
    
    // 隐藏所有视图
    document.querySelectorAll('.view').forEach(view => {
        view.style.display = 'none';
    });
    
    // 更新导航链接状态
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.toggle('active', link.dataset.view === viewName);
    });
    
    // 显示目标视图
    const targetView = document.getElementById(viewName);
    if (targetView) {
        targetView.style.display = 'block';
        
        // 特殊处理考试时间轴视图
        if (viewName === 'timeline-view') {
            console.log('初始化考试时间轴视图');
            // 确保周度备考计划正确初始化
            if (typeof initializeWeeklyPlan === 'function') {
                initializeWeeklyPlan();
            }
            if (typeof renderWeeklyPlan === 'function') {
                renderWeeklyPlan();
            }
        }
    } else {
        console.error('未找到视图:', viewName);
    }
}

// 渲染总览视图
function renderOverview() {
    const container = document.querySelector('.weeks-overview');
    if (!container) return;
    
    container.innerHTML = '';
    
    Object.keys(milestoneData).forEach(milestoneId => {
        const milestone = milestoneData[milestoneId];
        const card = createWeekCard(milestone);
        container.appendChild(card);
    });
}

// 创建周卡片
function createWeekCard(milestone) {
    const card = document.createElement('div');
    card.className = 'week-card';
    
    const header = document.createElement('div');
    header.className = 'week-header';
    
    const title = document.createElement('div');
    title.className = 'week-title';
    title.textContent = `${milestone.icon} ${milestone.name}`;
    
    const date = document.createElement('div');
    date.className = 'week-date';
    date.textContent = formatDateRange(milestone.startDate, milestone.endDate);
    
    header.appendChild(title);
    header.appendChild(date);
    
    const modules = document.createElement('div');
    modules.className = 'week-modules';
    
    Object.keys(examConfig[currentExamType].modules).forEach(moduleId => {
        const module = examConfig[currentExamType].modules[moduleId];
        const tag = document.createElement('span');
        tag.className = 'module-tag';
        tag.textContent = module.name;
        tag.style.backgroundColor = module.color;
        modules.appendChild(tag);
    });
    
    card.appendChild(header);
    card.appendChild(modules);
    
    return card;
}

// 检查考试提醒
function checkExamReminder() {
    const now = new Date();
    const timeDiff = currentExamDate.getTime() - now.getTime();
    const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
    
    if (daysDiff <= 30 && daysDiff > 0) {
        showReminder(`距离${examConfig[currentExamType].name}考试还有 ${daysDiff} 天！`);
    }
}

// 显示提醒
function showReminder(message) {
    const reminderBar = document.querySelector('.reminder-bar');
    const reminderText = document.querySelector('.reminder-text');
    
    if (reminderBar && reminderText) {
        reminderText.textContent = message;
        reminderBar.classList.add('show');
    }
}

// 隐藏提醒
function hideReminder() {
    const reminderBar = document.querySelector('.reminder-bar');
    if (reminderBar) {
        reminderBar.classList.remove('show');
    }
}

// 工具函数：防抖
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// 工具函数：节流
function throttle(func, limit) {
    let inThrottle;
    return function() {
        const args = arguments;
        const context = this;
        if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    };
}

// 导出数据
function exportData() {
    const data = {
        examType: currentExamType,
        targetScore: currentTargetScore,
        examDate: currentExamDate.toISOString(),
        taskData: taskData,
        exportDate: new Date().toISOString()
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `cet-study-plan-${currentExamType}-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// 导入数据
function importData(file) {
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            
            if (data.examType) currentExamType = data.examType;
            if (data.targetScore) currentTargetScore = data.targetScore;
            if (data.examDate) currentExamDate = new Date(data.examDate);
            if (data.taskData) taskData = data.taskData;
            
            saveUserPreferences();
            updateUI();
            generateMilestones();
            renderTimeline();
            selectFirstMilestone();
            
            alert('数据导入成功！');
        } catch (error) {
            alert('数据导入失败，请检查文件格式！');
        }
    };
    reader.readAsText(file);
}

// 重置数据
function resetData() {
    if (confirm('确定要重置所有数据吗？此操作不可撤销！')) {
        localStorage.clear();
        taskData = {};
        currentExamType = 'cet4';
        currentTargetScore = 425;
        currentExamDate = new Date('2024-12-14');
        
        updateUI();
        generateMilestones();
        renderTimeline();
        selectFirstMilestone();
        
        alert('数据重置成功！');
    }
}

// 获取学习统计
function getStudyStats() {
    let totalTasks = 0;
    let completedTasks = 0;
    let totalTime = 0;
    let completedTime = 0;
    
    Object.keys(taskData).forEach(milestoneKey => {
        const milestoneData = taskData[milestoneKey];
        Object.keys(milestoneData).forEach(moduleId => {
            const moduleData = milestoneData[moduleId];
            Object.keys(moduleData).forEach(taskGroupId => {
                const tasks = moduleData[taskGroupId];
                tasks.forEach(task => {
                    totalTasks++;
                    if (task.completed) {
                        completedTasks++;
                    }
                });
            });
        });
    });
    
    return {
        totalTasks,
        completedTasks,
        completionRate: totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0,
        totalTime,
        completedTime
    };
}

// 显示学习统计
function showStudyStats() {
    const stats = getStudyStats();
    const message = `
学习统计：
总任务数：${stats.totalTasks}
已完成：${stats.completedTasks}
完成率：${stats.completionRate}%
    `;
    alert(message);
}

// 显示每周课表
function showWeeklySchedule() {
    const examType = currentExamType;
    const targetScore = currentTargetScore;
    
    if (studentPlans[examType] && studentPlans[examType][targetScore]) {
        const plan = studentPlans[examType][targetScore];
        const schedule = weeklyScheduleTemplate;
        
        let scheduleHtml = `
            <div class="weekly-schedule">
                <h3>${plan.name} - 每周课表</h3>
                <div class="schedule-grid">
        `;
        
        Object.entries(schedule).forEach(([day, activities]) => {
            scheduleHtml += `
                <div class="day-schedule">
                    <h4>${day}</h4>
                    <ul>
            `;
            activities.forEach(activity => {
                scheduleHtml += `<li>${activity}</li>`;
            });
            scheduleHtml += `
                    </ul>
                </div>
            `;
        });
        
        scheduleHtml += `
                </div>
                <div class="schedule-note">
                    <p><strong>说明：</strong>每日总时长${plan.dailyTime}，可根据个人情况微调。</p>
                </div>
            </div>
        `;
        
        // 显示在模态框中
        showModal('每周学习安排', scheduleHtml);
    }
}

// 显示关键方法
function showKeyMethods() {
    let methodsHtml = `
        <div class="key-methods">
            <h3>关键学习方法</h3>
    `;
    
    Object.entries(keyMethods).forEach(([category, methods]) => {
        methodsHtml += `
            <div class="method-category">
                <h4>${category}</h4>
                <ul>
        `;
        methods.forEach(method => {
            methodsHtml += `<li>${method}</li>`;
        });
        methodsHtml += `
                </ul>
            </div>
        `;
    });
    
    methodsHtml += `</div>`;
    
    showModal('关键学习方法', methodsHtml);
}

// 显示模态框
function showModal(title, content) {
    // 创建模态框
    const modal = document.createElement('div');
    modal.className = 'modal-overlay';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <h2>${title}</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                ${content}
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // 点击背景关闭
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            closeModal();
        }
    });
}

// 关闭模态框
function closeModal() {
    const modal = document.querySelector('.modal-overlay');
    if (modal) {
        modal.remove();
    }
}

// 更新考试类型和目标分数
function updateExamSettings(examType, targetScore) {
    currentExamType = examType;
    currentTargetScore = targetScore;
    
    // 更新里程碑数据
    updateMilestoneData();
    
    // 重新渲染时间轴
    renderTimeline();
    
    // 更新学生计划
    updateStudentPlan();
    
    // 选择第一个里程碑
    selectFirstMilestone();
}

// 页面初始化
function initializePage() {
    // 设置默认值
    currentExamType = 'cet4';
    currentTargetScore = '425';
    
    // 初始化数据
    updateMilestoneData();
    
    // 渲染时间轴
    renderTimeline();
    
    // 更新学生计划
    updateStudentPlan();
    
    // 选择第一个里程碑
    selectFirstMilestone();
    
    // 绑定事件监听器
    bindEventListeners();
    
    // 初始化周度备考计划
    initializeWeeklyPlan();
}

// 绑定事件监听器
function bindEventListeners() {
    // 考试类型切换
    document.querySelectorAll('input[name="exam-type"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
            if (e.target.checked) {
                updateExamSettings(e.target.value, currentTargetScore);
            }
        });
    });
    
    // 目标分数切换
    document.querySelectorAll('select[name="target-score"]').forEach(select => {
        select.addEventListener('change', (e) => {
            updateExamSettings(currentExamType, e.target.value);
        });
    });
    
    // 模块标签切换
    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('tab-btn')) {
            switchModule(e.target.dataset.module);
        }
    });
}

// 周度备考计划功能函数

/**
 * 设置周度备考计划事件监听器
 */
function setupWeeklyPlanListeners() {
    // 考试类型选择
    const examTypeSelect = document.getElementById('weeklyExamType');
    if (examTypeSelect) {
        examTypeSelect.addEventListener('change', function() {
            currentWeeklyExamType = this.value;
            updateWeeklyPlan();
        });
    }

    // 目标分数选择
    const targetScoreSelect = document.getElementById('weeklyTargetScore');
    if (targetScoreSelect) {
        targetScoreSelect.addEventListener('change', function() {
            currentWeeklyTargetScore = this.value;
            updateWeeklyPlan();
        });
    }

    // 周导航按钮
    const prevWeekBtn = document.getElementById('prev-week-btn');
    const nextWeekBtn = document.getElementById('next-week-btn');
    
    if (prevWeekBtn) {
        prevWeekBtn.addEventListener('click', function() {
            if (currentWeekIndex > 0) {
                currentWeekIndex--;
                renderWeeklyPlan();
            }
        });
    }
    
    if (nextWeekBtn) {
        nextWeekBtn.addEventListener('click', function() {
            console.log('下一周按钮被点击');
            console.log('当前周索引:', currentWeekIndex);
            console.log('考试类型:', currentWeeklyExamType);
            console.log('目标分数:', currentWeeklyTargetScore);
            
            // 映射考试类型
            const examTypeMap = {
                'cet4': '四级',
                'cet6': '六级'
            };
            const mappedExamType = examTypeMap[currentWeeklyExamType] || '四级';
            console.log('映射后考试类型:', mappedExamType);
            
            const maxWeeks = weeklyPlanData[mappedExamType][currentWeeklyTargetScore].weeks.length;
            console.log('最大周数:', maxWeeks);
            console.log('条件检查:', currentWeekIndex < maxWeeks - 1);
            
            if (currentWeekIndex < maxWeeks - 1) {
                currentWeekIndex++;
                console.log('更新后周索引:', currentWeekIndex);
                renderWeeklyPlan();
            } else {
                console.log('已经是最后一周，无法继续');
            }
        });
    } else {
        console.log('未找到下一周按钮元素');
    }


}

/**
 * 更新周度备考计划
 */
function updateWeeklyPlan() {
    currentWeekIndex = 0;
    renderWeeklyPlan();
    saveWeeklyPlanPreferences();
}

/**
 * 渲染周度备考计划
 */
function renderWeeklyPlan() {
    // 映射考试类型
    const examTypeMap = {
        'cet4': '四级',
        'cet6': '六级'
    };
    const mappedExamType = examTypeMap[currentWeeklyExamType] || '四级';
    
    const planData = weeklyPlanData[mappedExamType][currentWeeklyTargetScore];
    if (!planData || !planData.weeks[currentWeekIndex]) return;

    const currentWeek = planData.weeks[currentWeekIndex];
    
    // 更新周导航
    updateWeekNavigation();
    
    // 更新周概览
    updateWeekOverview(currentWeek);
    
    // 更新周计划详情
    updateWeekPlanDetails(currentWeek);
    

}

/**
 * 更新周导航
 */
function updateWeekNavigation() {
    const currentWeekIndicator = document.getElementById('current-week-display');
    const prevBtn = document.getElementById('prev-week-btn');
    const nextBtn = document.getElementById('next-week-btn');
    
    if (currentWeekIndicator) {
        currentWeekIndicator.textContent = `第 ${currentWeekIndex + 1} 周`;
    }
    
    if (prevBtn) {
        prevBtn.disabled = currentWeekIndex === 0;
    }
    
    if (nextBtn) {
        // 映射考试类型
        const examTypeMap = {
            'cet4': '四级',
            'cet6': '六级'
        };
        const mappedExamType = examTypeMap[currentWeeklyExamType] || '四级';
        const maxWeeks = weeklyPlanData[mappedExamType][currentWeeklyTargetScore].weeks.length;
        nextBtn.disabled = currentWeekIndex >= maxWeeks - 1;
    }
}

/**
 * 更新周概览
 * @param {Object} weekData - 周数据
 */
function updateWeekOverview(weekData) {
    // 更新周信息
    const weekDates = document.querySelector('.week-dates');
    const weekTheme = document.querySelector('.week-theme');
    const weekGoal = document.querySelector('.week-goal');
    
    if (weekDates) {
        const startDate = new Date('2024-09-15');
        const endDate = new Date(startDate);
        endDate.setDate(endDate.getDate() + 6);
        weekDates.textContent = `${formatDate(startDate)} - ${formatDate(endDate)}`;
    }
    
    if (weekTheme) {
        weekTheme.textContent = `主题：${weekData.theme}`;
    }
    
    if (weekGoal) {
        weekGoal.textContent = `目标：${weekData.goal}`;
    }
}

/**
 * 更新周计划详情
 * @param {Object} weekData - 周数据
 */
function updateWeekPlanDetails(weekData) {
    const weekPlanContainer = document.querySelector('.week-plan-details');
    if (!weekPlanContainer) return;
    
    const planTitle = weekPlanContainer.querySelector('.plan-title');
    const tasksList = weekPlanContainer.querySelector('.week-tasks-list');
    const checkpointsList = weekPlanContainer.querySelector('.week-checkpoints-list');
    
    if (planTitle) {
        planTitle.textContent = weekData.title;
    }
    
    if (tasksList && weekData.tasks) {
        let tasksHTML = '';
         Object.keys(weekData.tasks).forEach(category => {
             tasksHTML += `<div class="task-category">
                 <h4 class="category-title">${category}</h4>
                 <ul class="category-tasks">`;
             weekData.tasks[category].forEach(task => {
                 tasksHTML += `<li class="task-item"><input type="checkbox" class="task-checkbox"> <span class="task-text">${task}</span></li>`;
             });
             tasksHTML += `</ul></div>`;
         });
         tasksList.innerHTML = tasksHTML;
    }
    
    if (checkpointsList && weekData.checkpoint) {
        checkpointsList.innerHTML = `
            <div class="checkpoint-item">
                <span class="checkpoint-text">${weekData.checkpoint}</span>
            </div>
        `;
    }
}




/**
 * 获取周开始日期
 * @param {number} weekIndex - 周索引
 * @returns {Date} 周开始日期
 */
function getWeekStartDate(weekIndex) {
    const startDate = new Date(weeklyPlanStartDate);
    startDate.setDate(startDate.getDate() + (weekIndex * 7));
    return startDate;
}

/**
 * 格式化日期
 * @param {Date} date - 日期对象
 * @returns {string} 格式化的日期字符串
 */
function formatDate(date) {
    const month = date.getMonth() + 1;
    const day = date.getDate();
    return `${month}/${day}`;
}

/**
 * 保存周度计划偏好设置
 */
function saveWeeklyPlanPreferences() {
    const preferences = {
        examType: currentWeeklyExamType,
        targetScore: currentWeeklyTargetScore,
        weekIndex: currentWeekIndex,
        startDate: weeklyPlanStartDate.toISOString(),
        planData: weeklyPlanData
    };
    
    localStorage.setItem('weeklyPlanPreferences', JSON.stringify(preferences));
}

/**
 * 加载周度计划偏好设置
 */
function loadWeeklyPlanPreferences() {
    const saved = localStorage.getItem('weeklyPlanPreferences');
    if (saved) {
        try {
            const preferences = JSON.parse(saved);
            currentWeeklyExamType = preferences.examType || 'cet4';
            currentWeeklyTargetScore = preferences.targetScore || '425';
            currentWeekIndex = preferences.weekIndex || 0;
            weeklyPlanStartDate = new Date(preferences.startDate || '2025-01-01');
            
            // 合并保存的计划数据
            if (preferences.planData) {
                Object.assign(weeklyPlanData, preferences.planData);
            }
        } catch (e) {
            console.error('加载周度计划偏好设置失败:', e);
        }
    }
}

/**
 * 初始化周度备考计划
 */
async function initializeWeeklyPlan() {
    loadWeeklyPlanPreferences();

    // 暂时设置为第一周（索引0）
    currentWeekIndex = 0;
    
    // 设置选择器默认值
    const examTypeSelect = document.getElementById('weeklyExamType');
    const targetScoreSelect = document.getElementById('weeklyTargetScore');
    
    if (examTypeSelect) {
        examTypeSelect.value = currentWeeklyExamType;
    }
    
    if (targetScoreSelect) {
        targetScoreSelect.value = currentWeeklyTargetScore;
    }
    
    // 加载要求.md 生成六种组合
    // await loadMarkdownPlan(); // 已改为使用静态任务数据
    // 渲染计划
    renderWeeklyPlan();
}

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', initializePage);

    </script>
    
    <!-- 模态框 -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">标题</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- 内容将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>
</body>
</html>
